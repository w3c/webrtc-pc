<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ns="http://www.w3.org/1999/xhtml">
  <head>
    <link href="getusermedia.css" rel="stylesheet" type="text/css" />

    <link href="ReSpec.js/css/respec.css" rel="stylesheet" type="text/css" />

    <title>getusermedia: Getting access to local devices that can generate
    multimedia streams</title>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

    <!--
    === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can
      check them out in the same tree and use relative links so that they'll
      work offline.

    To generate the dated version of the specification:

      Open this doc in Mozilla.

      Do a CTRL-ALT-SHIFT-S

      Select "XHMTL( source)" from dialog box. This will pop a new tab with
      genreated version of the document.

      This will open a new tab with generated html. Copy and paste this to
      a new file. Note if you use Chrome or Safari, this step will not
      work. What will happen is the paste will have th original document,
      not what was displayed in the window that you did the copy on.

      Rename the new file to the correct day such as
      getusermedia-20111003.html then search for and edit the links for
      "This version" and "Previos version". Add the new file into git and
      check in.

      Once everyone is happy, the getusermedia.html and
      getusermedia-20111003.html files can be coppied to
      getusermedia.html and getusermedia-20111003.html
      respectively in the ../editor/. W3C directory.
  -->

    <script class="remove" src="http://www.w3.org/Tools/respec/respec-w3c-common" type="text/javascript">
      <!-- keep this comment -->
    </script>

    <script class="remove" src="getusermedia.js" type="text/javascript">
      <!-- keep this comment -->
    </script>
  </head>

  <body>
    <section id="abstract">
      <p>This document defines a set of APIs that allow local media, including
      audio and video, to be requested from a platform.</p>
    </section>

    <section id="sotd">
      <p>This document is not complete. It is subject to major changes and,
      while early experimentations are encouraged, it is therefore not
      intended for implementation. The API is based on preliminary work done
      in the WHATWG. The Media Capture Task Force expects this specification
      to evolve significantly based on:</p>

      <ul>
        <li>Privacy issues that arise when exposing local capabilities and
        local streams.</li>

        <li>Technical discussions within the task force.</li>

        <li>Experience gained through early experimentations.</li>

        <li>Feedback received from other groups and individuals.</li>
      </ul>
    </section>

    <section class="informative" id="intro">
      <h2>Introduction</h2>

      <p>Access to multimedia streams (video, audio, or both) from local
      devices (video cameras, microphones, Web cams) can have a number of
      uses, such as real-time communication, recording, surveillance.</p>

      <p>This document defines the APIs used to get access to local devices
      (video cameras, microphones, Web cams) that can generate multimedia
      stream data. This document also defines the stream API by which
      JavaScript is able to manipulate the stream data or otherwise process
      it.</p>
    </section>

    <section id="stream-api">
      <h2>Stream API</h2>

      <section>
        <h3>Introduction</h3>

        <p>The <code>
            <a>MediaStream</a>
          </code> interface is used to represent streams of media data,
        typically (but not necessarily) of audio and/or video content, e.g.
        from a local camera. The data from a <code>
            <a>MediaStream</a>
          </code> object does not necessarily have a canonical binary form;
        for example, it could just be "the video currently coming from the
        user’s video camera". This allows user agents to manipulate media
        streams in whatever fashion is most suitable on the user’s
        platform.</p>

        <p>Each <code>
            <a>MediaStream</a>
          </code> object can contain zero or more tracks, in particular audio
        and video tracks. All tracks in a MediaStream are intended to be
        synchronized when rendered. Different MediaStreams do not need to be
        synchronized.</p>

        <p>Each track in a MediaStream object has a corresponding <code>
            <a>MediaStreamTrack</a>
          </code> object.</p>

        <p>A <code>
            <a>MediaStreamTrack</a>
          </code> represents content comprising one or more channels, where
        the channels have a defined well known relationship to each other
        (such as a stereo or 5.1 audio signal).</p>

        <p>A channel is the smallest unit considered in this API
        specification.</p>

        <p>A <code>
            <a>MediaStream</a>
          </code> object has an input and an output. The input depends on how
        the object was created: a <code>
            <a>LocalMediaStream</a>
          </code> object generated by a <code>
            <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          </code> call (which is described later in this document), for
        instance, might take its input from the user’s local camera. The
        output of the object controls how the object is used, e.g. what is
        saved if the object is written to a file, what is displayed if the
        object is used in a <code>video</code> element</p>

        <p>Each track in a <code>
            <a>MediaStream</a>
          </code> object can be disabled, meaning that it is muted in the
        object’s output. All tracks are initially enabled.</p>

        <p>A <code>
            <a>MediaStream</a>
          </code> can be <a>finished</a>, indicating that its inputs have
        forever stopped providing data.</p>

        <p>The output of a <code>
            <a>MediaStream</a>
          </code> object MUST correspond to the tracks in its input. Muted
        audio tracks MUST be replaced with silence. Muted video tracks MUST be
        replaced with blackness.</p>

        <p>A new <code>
            <a>MediaStream</a>
          </code> object can be created from existing <code>
            <a>MediaStreamTrack</a>
          </code> objects using the <code>
            <a href="#dom-mediastream">MediaStream()</a>
          </code> constructor. The constructor takes two lists of <code>
            <a>MediaStreamTrack</a>
          </code> objects as arguments; one for audio tracks and one for video
        tracks. The lists can either be the track lists of another stream,
        subsets of such lists, or compositions of <code>
            <a>MediaStreamTrack</a>
          </code> objects from different <code>
            <a>MediaStream</a>
          </code> objects.</p>

        <p>
          <img alt="" src="images/media-stream-1.png" />
        </p>

        <p>The ability to duplicate a <code>
            <a>MediaStream</a>
          </code>, i.e. create a new <code>
            <a>MediaStream</a>
          </code> object from the track lists of an existing stream, allows
        for greater control since separate <code>
            <a>MediaStream</a>
          </code> instances can be manipulated and <a
        title="consumer">consumed</a> individually.</p>

        <p>The <code>
            <a>LocalMediaStream</a>
          </code> interface is used when the user agent is generating the
        stream’s data (e.g. from a camera or streaming it from a local video
        file).</p>

        <p>When a <code>
            <a>LocalMediaStream</a>
          </code> object is being generated from a local file (as opposed to a
        live audio/video source), the user agent SHOULD stream the data from
        the file in real time, not all at once. The <code>MediaStream</code>
        object is also used in contexts outside <code>getUserMedia</code>,
        such as [[!WEBRTC10]]. Hence ensuring a realtime stream in both cases,
        reduces the ease with which pages can distinguish live video from
        pre-recorded video, which can help protect the user’s privacy.</p>
      </section>

      <section>
        <h4>MediaStream</h4>

        <p>The <dfn id="dom-mediastream">
            <code>MediaStream()</code>
          </dfn> constructor takes two arguments. The arguments are two lists
        with <code>
            <a>MediaStreamTrack</a>
          </code> objects which will be used to construct the audio and video
        track lists of the new <code>
            <a>MediaStream</a>
          </code> object. When the constructor is invoked, the UA must run the
        following steps:</p>

        <ol>
          <li>
            <p>Let <var>audioTracks</var> be the constructor’s first
            argument.</p>
          </li>

          <li>
            <p>Let <var>videoTracks</var> be the constructor’s second
            argument.</p>
          </li>

          <li>
            <p>Let <var>stream</var> be a newly constructed <code>
                <a>MediaStream</a>
              </code> object.</p>
          </li>

          <li>
            <p>Set <var>stream’s</var> label attribute to a newly generated
            value.</p>
          </li>

          <li>
            <p>If <var>audioTracks</var> is not null, then run the following
            sub steps for each element <var>track</var> in
            <var>audioTracks</var>:</p>

            <ol>
              <li>
                <p>If <var>track</var> is of any other kind than
                "<code>audio</code>", then throw a <code>SyntaxError</code>
                exception.</p>
              </li>

              <li>
                <p>If <var>track</var> has the same underlying source as
                another element in <var>stream’s</var> audio track list, then
                abort these steps.</p>
              </li>

              <li>
                <p>Add <var>track</var> to <var>stream’s</var> audio track
                list.</p>
              </li>
            </ol>
          </li>

          <li>
            <p>If <var>videoTracks</var> is not null, then run the following
            sub steps for each element <var>track</var> in
            <var>videoTracks</var>:</p>

            <ol>
              <li>
                <p>If <var>track</var> is of any other kind than
                "<code>video</code>", then throw a <code>SyntaxError</code>
                exception.</p>
              </li>

              <li>
                <p>If <var>track</var> has the same underlying source as
                another element in <var>stream’s</var> video track list, then
                abort these steps.</p>
              </li>

              <li>
                <p>Add <var>track</var> to <var>stream’s</var> video track
                list.</p>
              </li>
            </ol>
          </li>
        </ol>

        <p>A <code>
            <a>MediaStream</a>
          </code> can have multiple audio and video sources (e.g. because the
        user has multiple microphones, or because the real source of the
        stream is a media resource with many media tracks). The stream
        represented by a <code>
            <a>MediaStream</a>
          </code> thus has zero or more tracks.</p>

        <p>The tracks of a <code>
            <a>MediaStream</a>
          </code> are stored in two track lists represented by <code>
            <a>MediaStreamTrackList</a>
          </code> objects; one for audio tracks and one for video tracks. The
        two track lists MUST contain the <code>
            <a>MediaStreamTrack</a>
          </code> objects that correspond to the tracks of the stream. The
        relative order of all tracks in a user agent MUST be stable. Tracks
        that come from a media resource whose format defines an order MUST be
        in the order defined by the format; tracks that come from a media
        resource whose format does not define an order MUST be in the relative
        order in which the tracks are declared in that media resource. Within
        these constraints, the order is user-agent defined.</p>

        <p>An object that reads data from the output of a <code>
            <a>MediaStream</a>
          </code> is referred to as a <code>
            <a>MediaStream</a>
          </code> <dfn>consumer</dfn>. The list of <code>
            <a>MediaStream</a>
          </code> consumers currently includes the media elements, <code>
            <a>PeerConnection</a>
          </code> (specified in [[!WEBRTC10]]).</p>

        <p class="note"><code>
            <a>MediaStream</a>
          </code> consumers must be able to handle tracks being added and
        removed. This behavior is specified per consumer.</p>

        <p>A <code>
            <a>MediaStream</a>
          </code> object is said to be <dfn>finished</dfn> when all tracks
        belonging to the stream have <a>ended</a>. When this happens for any
        reason other than the <code>
            <a href="#dom-mediastream-stop">stop()</a>
          </code> method being invoked, the user agent MUST queue a task that
        runs the following steps:</p>

        <ol>
          <li>
            <p>If the object’s <code>
                <a href="#dom-mediastream-ended">ended</a>
              </code> attribute has the value true already, then abort these
            steps. (The <code>
                <a href="#dom-mediastream-stop">stop()</a>
              </code> method was probably called just before the stream
            stopped for other reasons, e.g. the user clicked an in-page stop
            button and then the user-agent-provided stop button.)</p>
          </li>

          <li>
            <p>Set the object’s <code>
                <a href="#dom-mediastream-ended">ended</a>
              </code> attribute to true.</p>
          </li>

          <li>
            <p>Fire a simple event named <code title="event-MediaStream-ended">
                <a href="#event-mediastream-ended">ended</a>
              </code> at the object.</p>
          </li>
        </ol>

        <p>If the end of the stream was reached due to a user request, the
        task source for this <span title="concept-task">task</span> is the
        user interaction task source. Otherwise the task source for this <span
        title="concept-task">task</span> is the networking task source.</p>

        <dl class="idl"
            title="[Constructor (MediaStreamTrackList? audioTracks, MediaStreamTrackList? videoTracks)] interface MediaStream">
          <dt>readonly attribute DOMString label</dt>

          <dd>
            <p>When a <code>
                <a>LocalMediaStream</a>
              </code> object is created, the user agent MUST generate a
            globally unique identifier string, and MUST initialize the
            object’s <code>
                <a href="#dom-mediastream-label">label</a>
              </code> attribute to that string. Such strings MUST only use
            characters in the ranges U+0021, U+0023 to U+0027, U+002A to
            U+002B, U+002D to U+002E, U+0030 to U+0039, U+0041 to U+005A,
            U+005E to U+007E, and MUST be 36 characters long.</p>

            <!-- UUIDs have 36 characters
      including hyphens; the ranges above comes from RFC4574 (the a=label:
      thing in SDP) -->

            <!-- described below -->

            <p>When a <code>
                <a>MediaStream</a>
              </code> is created from another using the <code>
                <a href="#dom-mediastream">MediaStream()</a>
              </code> constructor, the <code title="dom-MediaStream-label">
                <a href="#dom-mediastream-label">label</a>
              </code> attribute is initialized to a newly generated value.</p>

            <!-- described above -->

            <p>The <dfn id="dom-mediastream-label">
                <code>label</code>
              </dfn> attribute MUST return the value to which it was
            initialized when the object was created.</p>
          </dd>

          <dt>readonly attribute MediaStreamTrackList audioTracks</dt>

          <dd>
            <p>Returns a <code>
                <a>MediaStreamTrackList</a>
              </code> object representing the audio tracks that can be enabled
            and disabled.</p>

            <p>The <dfn id="dom-mediastream-audiotracks">
                <code>audioTracks</code>
              </dfn> attribute MUST return an <span
            title="array host objects">array host object</span> for objects of
            type <code>
                <a>MediaStreamTrack</a>
              </code> that is <em>fixed length</em> and <em>read only</em>.
            The same object MUST be returned each time the attribute is
            accessed.</p>
          </dd>

          <dt>readonly attribute MediaStreamTrackList videoTracks</dt>

          <dd>
            <p>Returns a <code>
                <a>MediaStreamTrackList</a>
              </code> object representing the video tracks that can be enabled
            and disabled.</p>

            <p>The <dfn id="dom-mediastream-videotracks">
                <code>videoTracks</code>
              </dfn> attribute MUST return an <span
            title="array host objects">array host object</span> for objects of
            type <code>
                <a>MediaStreamTrack</a>
              </code> that is <em>fixed length</em> and <em>read only</em>.
            The same object MUST be returned each time the attribute is
            accessed.</p>
          </dd>

          <dt>attribute boolean ended</dt>

          <dd>
            <p>The <dfn id="dom-mediastream-ended">
                <code>MediaStream.ended</code>
              </dfn> attribute MUST return true if the <code>
                <a>MediaStream</a>
              </code> has <a>finished</a>, and false otherwise.</p>

            <p>When a <code>
                <a>MediaStream</a>
              </code> object is created, its <code>
                <a href="#dom-mediastream-ended">ended</a>
              </code> attribute MUST be set to false, unless it is being
            created using the <code>
                <a href="#dom-mediastream">MediaStream()</a>
              </code> constructor whose arguments are lists of <code>
                <a>MediaStreamTrack</a>
              </code> objects that are all <a>ended</a>, in which case the
            <code>
                <a>MediaStream</a>
              </code> object MUST be created with its <code>
                <a href="#dom-mediastream-ended">ended</a>
              </code> attribute set to true.</p>
          </dd>

          <dt>attribute Function? onended</dt>

          <dd>This event handler, of type <code>
              <a href="#event-mediastream-ended">ended</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStream</a>
            </code> interface.</dd>
        </dl>

        <div class="idl" title="MediaStream implements EventTarget" />
      </section>

      <section>
        <h4>LocalMediaStream</h4>

        <p>Before the web application can access the users media input devices
        it must let <code>
            <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          </code> create a <code>
            <a>LocalMediaStream</a>
          </code>. Once the application is done using, e.g., a webcam and a
        microphone, it may revoke its own access by calling <code>
            <a href="#dom-mediastream-stop">stop()</a>
          </code> on the <code>
            <a>LocalMediaStream</a>
          </code> . <!--If the web application no longer has access to any media input devices, any
 "on air" indicators in the browser UI MUST be turned off.--></p>

        <p>A web application may, once it has access to a <code>
            <a>LocalMediaStream</a>
          </code>, use the <code>
            <a href="#dom-mediastream">MediaStream()</a>
          </code> constructor to construct additional <code>
            <a>MediaStream</a>
          </code> objects. Since a derived <code>
            <a>MediaStream</a>
          </code> object is created from the tracks of an existing stream, it
        cannot use any media input devices that have not been approved by the
        user.</p>

        <dl class="idl" title="interface LocalMediaStream : MediaStream">
          <dt>void stop()</dt>

          <dd>
            <p>When a <code>
                <a>LocalMediaStream</a>
              </code> object’s <dfn id="dom-mediastream-stop">
                <code>stop()</code>
              </dfn> method is invoked, the user agent MUST queue a task that
            runs the following steps on every track:</p>

            <ol>
              <li>
                <p>Let <var>track</var> be the current <code>
                    <a>MediaStreamTrack</a>
                  </code> object.</p>
              </li>

              <li>
                <p><a title="ended">End</a> <var>track</var>. The track start
                outputting only silence and/or blackness, as appropriate.</p>
              </li>

              <li>
                <p>Dereference <var>track’s</var> underlying media source.</p>
              </li>

              <li>
                <p>If the reference count of <var>track’s</var> underlying
                media source is greater than zero, then abort these steps.</p>
              </li>

              <li>
                <p>Permanently stop the generation of data for
                <var>track’s</var> source. If the data is being generated from
                a live source (e.g. a microphone or camera), then the user
                agent SHOULD remove any active "on-air" indicator for that
                source. If the data is being generated from a prerecorded
                source (e.g. a video file), any remaining content in the file
                is ignored.</p>
              </li>
            </ol>

            <p>The task source for the <span title="concept-task">tasks</span>
            queued for the <code>
                <a href="#dom-mediastream-stop">stop()</a>
              </code> method is the DOM manipulation task source.</p>
          </dd>
        </dl>
      </section>

      <section>
        <h4>MediaStreamTrack</h4>

        <p>A <code>
            <a>MediaStreamTrack</a>
          </code> object represents a media source in the user agent. Several
        <code>
            <a>MediaStreamTrack</a>
          </code> objects can represent the same media source, e.g., when the
        user chooses the same camera in the UI shown by two consecutive calls
        to <code>
            <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          </code>.</p>

        <p>A <code>
            <a>MediaStreamTrack</a>
          </code> object can reference its media source in two ways, either
        with a strong or a weak reference, depending on how the track was
        created. For example, a track in a <code>
            <a>MediaStream</a>
          </code>, derived from a <code>
            <a>LocalMediaStream</a>
          </code> with the <code>
            <a href="#dom-mediastream">MediaStream()</a>
          </code> constructor, has a weak reference to a local media source,
        while a track in a <code>
            <a>LocalMediaStream</a>
          </code> has a strong reference. This means that a track in a <code>
            <a>MediaStream</a>
          </code>, derived from a <code>
            <a>LocalMediaStream</a>
          </code>, will end if there is no non-<a>ended</a> track in a <code>
            <a>LocalMediaStream</a>
          </code> which references the same local media source.</p>

        <p class="note">The concept with strong and weak references to media
        sources allows the web application to derive new <code>
            <a>MediaStream</a>
          </code> objects from <code>
            <a>LocalMediaStream</a>
          </code> objects (created via <code>
            <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          </code>), and still be able to revoke all given permissions with
        <code>
            <a href="#dom-mediastream-stop">LocalMediaStream.stop()</a>
          </code>.</p>

        <p>A <code>
            <a>MediaStreamTrack</a>
          </code> object is said to <em>end</em> when the user agent learns
        that no more data will ever be forthcoming for this track.</p>

        <p>When a <code>
            <a>MediaStreamTrack</a>
          </code> object ends for any reason (e.g. because the user rescinds
        the permission for the page to use the local camera, or because the
        data comes from a finite file and the file’s end has been reached and
        the user has not requested that it be looped, or because the UA has
        instructed the track to end for any reason, or because the reference
        count of the track’s underlying media source has reached zero, it is
        said to be <dfn>ended</dfn>. When track instance <var>track</var> ends
        for any reason other than <code>
            <a href="#dom-mediastream-stop">stop()</a>
          </code> method being invoked on the <code>
            <a>LocalMediaStream</a>
          </code> object that represents <var>track</var>, the user agent MUST
        queue a task that runs the following steps:</p>

        <ol>
          <li>
            <p>If the track’s <code>
                <a href="#dom-mediastreamtrack-readystate">readyState</a>
              </code> attribute has the value <code>
                <a href="#widl-MediaStreamTrack-ENDED">ENDED</a>
              </code> (2) already, then abort these steps.</p>
          </li>

          <li>
            <p>Set <var>track’s</var> <code>
                <a href="#dom-mediastreamtrack-readystate">readyState</a>
              </code> attribute to <code>
                <a href="#widl-MediaStreamTrack-ENDED">ENDED</a>
              </code> (2).</p>
          </li>

          <li>
            <p>Fire a simple event named <code>
                <a href="#event-mediastreamtrack-ended">ended</a>
              </code> at the object.</p>
          </li>
        </ol>

        <p>If the end of the stream was reached due to a user request, the
        event source for this event is the user interaction event source.</p>

        <dl class="idl" title="interface MediaStreamTrack">
          <dt>readonly attribute DOMString kind</dt>

          <dd>
            <p>The <dfn id="dom-mediastreamtrack-kind">
                <code>MediaStreamTrack.kind</code>
              </dfn> attribute MUST return the string "<code>audio</code>" if
            the object’s corresponding track is or was an audio track,
            "<code>video</code>" if the corresponding track is or was a video
            track, and a user-agent defined string otherwise.</p>
          </dd>

          <dt>readonly attribute DOMString label</dt>

          <dd>
            <p>User agents MAY label audio and video sources (e.g. "Internal
            microphone" or "External USB Webcam"). The <dfn
                id="dom-mediastreamtrack-label">
                <code>MediaStreamTrack.label</code>
              </dfn> attribute MUST return the label of the object’s
            corresponding track, if any. If the corresponding track has or had
            no label, the attribute MUST instead return the empty string.</p>

            <p class="note">Thus the <code>
                <a href="#dom-mediastreamtrack-kind">kind</a>
              </code> and <code title="dom-MediaStreamTrack-label">
                <a href="#dom-mediastreamtrack-label">label</a>
              </code> attributes do not change value, even if the <code>
                <a>MediaStreamTrack</a>
              </code> object is disassociated from its corresponding
            track.</p>
          </dd>

          <dt>attribute boolean enabled</dt>

          <dd>
            <p>The <dfn id="dom-mediastreamtrack-enabled">
                <code>MediaStreamTrack.enabled</code>
              </dfn> attribute, on getting, MUST return the last value to
            which it was set. On setting, it MUST be set to the new value, and
            then, if the <code>
                <a>MediaStreamTrack</a>
              </code> object is still associated with a track, MUST enable the
            track if the new value is true, and disable it otherwise.</p>

            <p class="note">Thus, after a <code>
                <a>MediaStreamTrack</a>
              </code> is disassociated from its track, its <code>
                <a href="#dom-mediastreamtrack-enabled">enabled</a>
              </code> attribute still changes value when set, it just doesn’t
            do anything with that new value.</p>
          </dd>

          <dt>const unsigned short LIVE = 0</dt>

          <dd>
            <p>The track is active (the track’s underlying media source is
            making a best-effort attempt to provide data in real time).</p>

            <p>The output of a track in the <code>
                <a href="#widl-MediaStreamTrack-LIVE">LIVE</a>
              </code> state can be switched on and off with the <code>
                <a href="#dom-mediastreamtrack-enabled">enabled</a>
              </code> attribute.</p>
          </dd>

          <dt>const unsigned short MUTED = 1</dt>

          <dd>
            <p>The track is muted (the track’s underlying media source is
            temporarily unable to provide data).</p>

            <p>A <code>
                <a>MediaStreamTrack</a>
              </code> in a <code>
                <a>LocalMediaStream</a>
              </code> may be muted if the user temporarily revokes the web
            application’s permission to use a media input device.</p>
          </dd>

          <dt>const unsigned short ENDED = 2</dt>

          <dd>
            <p>The track has <a>ended</a> (the track’s underlying media source
            is no longer providing data, and will never provide more data for
            this track).</p>

            <p>For example, a video track in a <code>
                <a>LocalMediaStream</a>
              </code> finishes if the user unplugs the USB web camera that
            acts as the track’s media source.</p>
          </dd>

          <dt>readonly attribute unsigned short readyState</dt>

          <dd>
            <p>The <dfn id="dom-mediastreamtrack-readystate">
                <code>readyState</code>
              </dfn> attribute represents the state of the track. It MUST
            return the value to which the user agent last set it (as defined
            below). It can have the following values: <dfn>LIVE</dfn>,
            <dfn>MUTED</dfn> or <dfn>ENDED</dfn>.</p>

            <p>When a <code>
                <a>MediaStreamTrack</a>
              </code> object is created, its <code>
                <a href="#dom-mediastreamtrack-readystate">readyState</a>
              </code> is either <code>
                <a href="#widl-MediaStreamTrack-LIVE">LIVE</a>
              </code> (0) or <code>
                <a href="#widl-MediaStreamTrack-MUTED">MUTED</a>
              </code> (1), depending on the state of the track’s underlying
            media source. For example, a track in a <code>
                <a>LocalMediaStream</a>
              </code>, created with <code>
                <a href="#dom-navigator-getusermedia">getUserMedia()</a>
              </code>, MUST initially have its <code>
                <a href="#dom-mediastreamtrack-readystate">readyState</a>
              </code> attribute set to <code>
                <a href="#widl-MediaStreamTrack-LIVE">LIVE</a>
              </code> (1).</p>
          </dd>

          <dt>attribute Function? onmute</dt>

          <dd>This event handler, of type <code>
              <a href="#event-mediastreamtrack-muted">muted</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStreamTrack</a>
            </code> interface.</dd>

          <dt>attribute Function? onunmute</dt>

          <dd>This event handler, of type <code>
              <a href="#event-mediastreamtrack-unmuted">unmuted</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStreamTrack</a>
            </code> interface.</dd>

          <dt>attribute Function? onended</dt>

          <dd>This event handler, of type <code>
              <a href="#event-mediastreamtrack-ended">ended</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStreamTrack</a>
            </code> interface.</dd>
        </dl>
      </section>

      <section>
        <h4>URL</h4>

        <dl class="idl" title="partial interface URL">
          <dt>static DOMString createObjectURL (MediaStream stream)</dt>

          <dd>
            <p>Mints a <a href="#blob-url">Blob URL</a> to refer to the given
            <code>
                <a>MediaStream</a>
              </code>.</p>

            <p>When the <dfn id="dom-url-createobjecturl">
                <code>createObjectURL()</code>
              </dfn> method is called with a <code>
                <a>MediaStream</a>
              </code> argument, the user agent MUST return a unique <a
            href="#blob-url">Blob URL</a> for the given <code>
                <a>MediaStream</a>
              </code>. [[!FILE-API]]</p>

            <p>For audio and video streams, the data exposed on that stream
            MUST be in a format supported by the user agent for use in
            <code>audio</code> and <code>video</code> elements.</p>

            <p class="bookkeeping">A <dfn id="blob-url">Blob URL</dfn> is the
            same as what the File API specification calls a Blob URI, except
            that anything in the definition of that feature that refers to
            <code>File</code> and <code>Blob</code> objects is hereby extended
            to also apply to <code>
                <a>MediaStream</a>
              </code> and <code>
                <a>LocalMediaStream</a>
              </code> objects.</p>
          </dd>
        </dl>
      </section>

      <section>
        <h4>MediaStreamTrackList</h4>

        <p>A <code>
            <a>MediaStreamTrackList</a>
          </code> object’s <dfn
        id="concept-track-list-corresponding-stream">corresponding</dfn> <code>
            <a>MediaStream</a>
          </code> refers to the <code>
            <a>MediaStream</a>
          </code> object which the current <code>
            <a>MediaStreamTrackList</a>
          </code> object is a property of.</p>

        <dl class="idl" title="interface MediaStreamTrackList">
          <dt>readonly attribute unsigned long length</dt>

          <dd>Returns the number of tracks in the list.</dd>

          <!-- FIXME: getter syntax doesn't seem to be supported by respec -->

          <dt>MediaStreamTrack item(unsigned long index)</dt>

          <dd>Returns the <code>
              <a>MediaStreamTrack</a>
            </code> object at the specified index.</dd>

          <dt>void add(MediaStreamTrack track)</dt>

          <dd>
            <p>Adds the given <code>
                <a>MediaStreamTrack</a>
              </code> to this <code>
                <a>MediaStreamTrackList</a>
              </code> according to the ordering rules for tracks.</p>

            <p>When the <dfn id="dom-mediastreamtracklist-add">
                <code>add()</code>
              </dfn> method is invoked, the user agent MUST run the following
            steps:</p>

            <ol>
              <li>
                <p>Let <var>track</var> be the <code>
                    <a>MediaStreamTrack</a>
                  </code> argument.</p>
              </li>

              <li>
                <p>Let <var>stream</var> be the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object’s <a
                href="#concept-track-list-corresponding-stream"
                title="concept-track-list-corresponding-stream">corresponding</a>
                <code>
                    <a>MediaStream</a>
                  </code> object.</p>
              </li>

              <li>
                <p>If <var>stream</var> is <a>finished</a>, throw an
                <code>INVALID_STATE_ERR</code> exception.</p>
              </li>

              <li>
                <p>If <var>track</var> is already in the <code>
                    <a>MediaStreamTrackList</a>
                  </code>, object’s internal list, then abort these steps.</p>
              </li>

              <li>
                <p>Add <var>track</var> to the end of the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object’s internal list.</p>
              </li>
            </ol>
          </dd>

          <dt>void remove(MediaStreamTrack track)</dt>

          <dd>
            <p>Removes the given <code>
                <a>MediaStreamTrack</a>
              </code> from this <code>
                <a>MediaStreamTrackList</a>
              </code>.</p>

            <p>When the <dfn id="dom-mediastreamtracklist-remove">
                <code>remove()</code>
              </dfn> method is invoked, the user agent MUST run the following
            steps:</p>

            <ol>
              <li>
                <p>Let <var>track</var> be the <code>
                    <a>MediaStreamTrack</a>
                  </code> argument.</p>
              </li>

              <li>
                <p>Let <var>stream</var> be the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object’s <a
                href="#concept-track-list-corresponding-stream"
                title="concept-track-list-corresponding-stream">corresponding</a>
                <code>
                    <a>MediaStream</a>
                  </code> object.</p>
              </li>

              <li>
                <p>If <var>stream</var> is <a>finished</a>, throw an
                <code>INVALID_STATE_ERR</code> exception.</p>
              </li>

              <li>
                <p>If <var>track</var> is not in the <code>
                    <a>MediaStreamTrackList</a>
                  </code>, object’s internal list, then abort these steps.</p>
              </li>

              <li>
                <p>Remove <var>track</var> from the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object’s internal list.</p>
              </li>
            </ol>
          </dd>

          <dt>attribute Function? onaddtrack</dt>

          <dd>This event handler, of type <code>
              <a href="#event-mediastreamtracklist-addtrack">addtrack</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStreamTrackList</a>
            </code> interface.</dd>

          <dt>attribute Function? onremovetrack</dt>

          <dd>This event handler, of type <code>
              <a
              href="#event-mediastreamtracklist-removetrack">removetrack</a>
            </code>, MUST be supported by all objects implementing the <code>
              <a>MediaStreamTrackList</a>
            </code> interface.</dd>
        </dl>
      </section>

      <section>
        <h4>MediaStreams as Media Elements</h4>

  <p>A MediaStream may be assigned to media elements as defined in <a href="http://www.w3.org/TR/html5/media-elements.html#media-elements">
  	HTML5 </a>  by calling createObjectURL to obtain a URL for the
  	MediaStream and then setting the media elements 'src' attribute to	that url. [OPEN ISSUE: 
  	do we also need to support direct assignment and access of the underlying stream?]  A MediaStream
  	is not preloadable or seekable and represents a simple, potentially infinite, linear media timeline.  The timeline starts at 0 and
  	increments linearly in real time as long as the MediaStream is playing.  The timeline does not
  	increment when the MediaStream is paused.</p>
  	
  	<p>The nature of the MediaStream places certain restrictions on the behavior and attribute values of
  		 the associated media element and on the operations that can be performed on it, as shown below:
  		 </p>
  		 
  	<ul><li> Whenever UA runs the <a href="http://www.w3.org/TR/html5/media-elements.html#media-element-load-algorithm">
              	media element load algorithm</a>,reaches the 
              	<a href="http://www.w3.org/TR/html5/media-elements.html#concept-media-load-resource">resource
              		fetch phase</a> of this algorithm and determines that the media resource in question is
              		a MediaStream, it <em class="rfc2119" title="must">must</em> immediately abort the <a href="http://www.w3.org/TR/html5/media-elements.html#concept-media-load-algorithm">resource
              		selection algorithm</a>, setting the <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-readystate"><code>media.readystate</code></a> to
              			HAVE_ENOUGH_DATA.</li>
          <li>The UA <em class="rfc2119" title="must">must not</em> buffer data from a MediaStream.  When
          	playing, the UA <em class="rfc2119" title="must">must</em> always play the current data from the stream.
          	</li>
   			
              			</ul>
  
  
       <table summary="Legal values for the properties of a media element bound to a MediaStream" class="simple">
          <thead>
            <tr>
              <th scope="col">
                Attribute Name
              </th>
              <th scope="col">
                Attribute Type
              </th>
              <th scope="col">
                Valid Values
              </th>
              <th scope="col">
                Additional considerations
              </th>
            </tr>
          </thead>
          <tbody><tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-src" class="externalDFN"><code>src</code></a> 
            </td>
            <td>
              <code>DOMString</code> 
            </td>
            <td>
              a local URI referencing a MediaStream
            </td>
            <td>
               N.B.  Revocation of the URL does not count as a change to this field.
            </td>
          </tr>
          <tr>
          	
              <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-currentsrc" class="externalDFN"><code>currentSrc</code></a> 
            </td>
            <td>
              <code>DOMString</code> 
            </td>
            <td>
              a local URI referencing a MediaStream
            </td>
            <td>
              -
            </td>
          </tr>
          <tr></tr>
          <tr>
          	
              <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#attr-media-preload" class="externalDFN"><code>preload</code></a> 
            </td>
            <td>
              <code>DOMString</code> 
            </td>
            <td>
              'None'
            </td>
            <td>
              A MediaStream cannot be preloaded. 
            </td>
          </tr>
          <tr></tr>
          
             <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#attr-media-buffered" class="externalDFN"><code>buffered</code></a> 
            </td>
            <td>
               <a href="http://www.w3.org/TR/html5/media-elements.html#timeranges" class="externalDFN"><code>TimeRanges</code></a> 
            </td>
            <td>
              <code>buffered.length</code> <em class="rfc2119" title="must">must</em> return <code>1</code>.<br>
               <code>buffered.start(0)</code> <em class="rfc2119" title="must">must</em> return <code>0</code>.<br>
               <code>buffered.end(0)</code> <em class="rfc2119" title="must">must</em> return <code>0</code>.<br>
            </td>
            <td>
              A MediaStream cannot be preloaded.  Therefore the amount buffered is always an empty TimeRange. 
            </td>
          </tr>
          <tr></tr>
    
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a> 
            </td>
            <td>
              <code>double</code> 
            </td>
            <td>
              Any positive integer.  The initial value is 0 and the values increments linearly
              in real time whenever the stream is playing.  
            </td>
            <td>
              The value is the current stream position, in seconds.  The UA <em class="rfc2119" title="must">must</em> ignore attempts to set 
              this attribute.  
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-duration" class="externalDFN"><code>duration</code></a> 
            </td>
            <td>
              <code>double</code> 
            </td>
            <td>
              Infinity 
            </td>
            <td>
              A MediaStream  does not have a pre-defined duration. 
              <p>If the underlying
            MediaStream is destroyed, the UA <em class="rfc2119" title="must">must</em> be set this property to the value of the last known <code>currentTime</code>.</p>
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-seeking" class="externalDFN"><code>seeking</code></a> 
            </td>
            <td>
              <code>boolean</code> 
            </td>
            <td>
              false 
            </td>
            <td>
              A MediaStream is not seekable. Therefore this attribute <em class="rfc2119" title="must">must</em> always
              have the value <code>false</code>.
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-defaultplaybackrate" class="externalDFN"><code>defaultPlaybackRate</code></a> 
            </td>
            <td>
              <code>double</code> 
            </td>
            <td>
              1.0 
            </td>
            <td>
              A MediaStream is not seekable. Therefore this attribute <em class="rfc2119" title="must">must</em> always
              have the value <code>1.0</code> and any attempt to alter it <em class="rfc2119" title="must">must</em> fail.
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-playbackrate" class="externalDFN"><code>playbackRate</code></a> 
            </td>
            <td>
              <code>double</code> 
            </td>
            <td>
              1.0 
            </td>
            <td>
              
              A MediaStream is not seekable. Therefore this attribute <em class="rfc2119" title="must">must</em> always
              have the value <code>1.0</code> and any attempt to alter it <em class="rfc2119" title="must">must</em> fail.
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-played" class="externalDFN"><code>played</code></a> 
            </td>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#timeranges" class="externalDFN"><code>TimeRanges</code></a> 
            </td>
            <td>
              <code>played.length</code> <em class="rfc2119" title="must">must</em> return <code>1</code>.<br>
               <code>played.start(0)</code> <em class="rfc2119" title="must">must</em> return <code>0</code>.<br>
               <code>played.end(0)</code> <em class="rfc2119" title="must">must</em> return the last known <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.
            </td>
            <td>
             A MediaStream's timeline always consists of a single range, starting at 0 and extending up to the
             currentTime.
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-seekable" class="externalDFN"><code>seekable</code></a> 
            </td>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#timeranges" class="externalDFN"><code>TimeRanges</code></a> 
            </td>
            <td>
              <code>seekable.length</code> <em class="rfc2119" title="must">must</em> return <code>0</code>.<br>
               <code>seekable.start()</code> <em class="rfc2119" title="must">must</em> return <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.<br>
               <code>seekable.end()</code> <em class="rfc2119" title="must">must</em> return <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.
            </td>
            <td>
              A MediaStream is not seekable. 
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-startoffsettime" class="externalDFN"><code>startOffsetTime</code></a> 
            </td>
            <td>
              <code>Date</code>
            </td>
            <td>
              Not-a-Number (NaN)
            </td>
            <td>
              A MediaStream does not specify a timeline offset. 
            </td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/media-elements.html#dom-media-loop" class="externalDFN"><code>loop</code></a> 
            </td>
            <td>
              <code>boolean</code> 
            </td>
            <td>
              false
            </td>
            <td>
              A MediaStream has no defined end and therefore cannot be looped. 
            </td>
          </tr>
        </tbody></table>

      </section>
    </section>

    <section id="local-content">
      <h2>Obtaining local multimedia content</h2>

      <section>
        <h2>NavigatorUserMedia</h2>

        <dl class="idl"
            title="[NoInterfaceObject] interface NavigatorUserMedia">
          <dt>void getUserMedia(MediaStreamConstraints? constraints,
          NavigatorUserMediaSuccessCallback? successCallback, optional
          NavigatorUserMediaErrorCallback? errorCallback)</dt>

          <dd>
            <p>Prompts the user for permission to use their Web cam or other
            video or audio input.</p>

            <p>The <var>constraints</var> argument is an object of type <code>
                <a>MediaStreamConstraints</a>
              </code>.</p>

            <p>If the user accepts, the <var>successCallback</var> is invoked,
            with a suitable <code>
                <a>LocalMediaStream</a>
              </code> object [[!WEBRTC10]] as its argument.</p>

            <p>If the user declines, the <var>errorCallback</var> (if any) is
            invoked.</p>

            <p>When the <dfn id="dom-navigator-getusermedia">
                <code>getUserMedia()</code>
              </dfn> method is called, the user agent MUST run the following
            steps:</p>

            <ol>
              <li>
                <p>Let <var>constraints</var> be the method's first
                argument.</p>
              </li>

              <li>
                <p>Let <var>successCallback</var> be the callback indicated by
                the method's second argument.</p>
              </li>

              <li>
                <p>Let <var>errorCallback</var> be the callback indicated by
                the method's third argument, if any, or null otherwise.</p>
              </li>

              <li>
                <p>Let <var>requestedMediaTypes</var> be the set of media
                types in <var>constraints</var> with either a dictionary value or a value of "true".</p>
              </li>

              <li>
                <p>Let <var>finalSet</var> be an (initially) empty set.</p>
              </li>

              <li>
                <p>If <var>successCallback</var> is null, abort these
                steps.</p>
              </li>

              <!-- we could throw an exception instead (that's
   why the method doesn't return until later: so that we can add an
   exception here, or for /options/ below, without changing the
   algorithm) -->

              <!--
            <li>
              <p>For each member of the <code><a>MediaStreamOptions</a></code>
              dictionary create a local representation and set it to false.</p>
            </li>

            <li>
              <p>For each property in <var>options</var> that is present and
              set to true, let the corresponding local representation be
              true.</p>
            </li>

            <li>
              <p>If none of the local representations of the
              <code><a>MediaStreamOptions</a></code> dictionary members is set
              to true, then throw a <code>NOT_SUPPORTED_ERR</code> exception
              and abort these steps.</p>
            </li>
-->

              <li>
                <p>For each media type <var>T</var> in <var>requestedMediaTypes</var>,</p>

                <ol>
                  <li>
                    <p>Let <var>candidateSet</var> be all possible tracks of
                    media type <var>T</var> that the browser could return.</p>
                  </li>
                  <li>If the value of the <var>T</var> entry of <var>constraints</var> is "true", jump to the step labeled <em>final</em> below.  Otherwise, continue.</li>
                  <li>
                    <p>For each constraint key-value pair in the "mandatory"
                      dictionary,</p>

                    <ol>
                      <li>
                        <p>If the constraint is not supported by the
                          browser, queue a task to invoke <var>errorCallback</var> with a new NavigatorUserMediaError object whose code attribute has the numeric value ??? (<code>NOT_SUPPORTED_ERR</code>) and abort these steps.  ***N.B. - also need to find a way to return the name of the constraint that failed***</p>
                      </li>

                      <li>
                        <p>Remove from the <var>candidateSet</var> any track
                          that cannot satisfy the value given for the
                          constraint.</p>
                      </li>

                      <li>
                        <p>If the <var>candidateSet</var> no longer contains
                          at least one track, queue a task to invoke <var>errorCallback</var> with a new NavigatorUserMediaError object whose code attribute has the numeric value ??? (<code>MANDATORY_UNSATISFIED_ERR</code>) and abort these steps.  (***N.B. - also need to find a way to return the name of the constraint that failed***). Otherwise,
                          continue with the next mandatory constraint.</p>
                      </li>
                    </ol>
                  </li>

                  <li>
                    <p>Let the <var>secondPassSet</var> be the current
                      contents of the <var>candidateSet</var>.</p>
                  </li>

                  <li>
                    <p>For each constraint key-value pair in the "optional"
                      sequence of the <var>constraints</var> that are for the
                      current media type, in order, </p>

                    <ol>
                      <li>
                        <p>If the constraint is not supported by the
                          browser, skip it and continue with the next
                          constraint.</p>
                      </li>

                      <li>
                        <p>Remove from the <var>secondPassSet</var> any
                          tracks that cannot satisfy the value given for the
                          constraint.</p>
                      </li>

                      <li>
                        <p>If the <var>secondPassSet</var> is now empty, let
                          the <var>secondPassSet</var> be the current contents
                          of the <var>candidateSet</var>. Otherwise, let the
                          <var>candidateSet</var> be the current contents of
                          the <var>secondPassSet</var>.</p>
                      </li>
                    </ol>
                  </li>

                  <li>
                    <p><em>Final:</em> Select one track from the <var>candidateSet</var> to
                      add to the <var>finalSet</var>. The decision of which
                      track to choose from the <var>candidateSet</var> is
                      completely up to the browser. Unless and until a new set
                      of constraints is provided, the browser MAY change its
                      choice of track at any point, provided that 1) the new
                      choice does not violate the given user permission, and
                      2) it notifies the application code by raising the
                      ******TBD****** event. It may wish to do this, for
                      example, if the user interface or network congestion
                      changes. Note that no such change will have an effect on
                      the presence or absence of each type of track, merely
                      the contents.</p>
                  </li>
                </li>
              </ol>
            </li>

            <li>
              <p>Return, and run the remaining steps asynchronously.</p>
            </li>

            <li>
              <p>Optionally, e.g. based on a previously-established user
                preference, for security reasons, or due to platform
                limitations, jump to the step labeled <em>failure</em>
                below.</p>
            </li>

            <li>
              <p>Prompt the user in a user-agent-specific manner for
                permission to provide the entry script's origin with a <code>
                  <a>LocalMediaStream</a>
                  </code> object [[!WEBRTC10]] representing a media
                stream.</p>

              <p>The provided media MUST include precisely the tracks in the
                <var>finalSet</var>.</p>

              <p>User agents are encouraged to default to using the user's
                primary or system default camera and/or microphone (as
                appropriate) to generate the media stream. User agents MAY
                allow users to use any media source, including pre-recorded
                media files.</p>

              <p>If the user grants permission to use local recording
                devices, user agents are encouraged to include a prominent
                indicator that the devices are "hot" (i.e. an "on-air" or
                "recording" indicator).</p>

              <p>If the user denies permission, jump to the step labeled
                <em>failure</em> below. If the user never responds, this
                algorithm stalls on this step.</p>
            </li>

            <li>
              <p>Let <var>stream</var> be the <code>
                    <a>LocalMediaStream</a>
                  </code> object [[!WEBRTC10]] for which the user granted
                permission.</p>
            </li>

            <li>
              <p>Queue a task to invoke <var>successCallback</var> with
                <var>stream</var> as its argument.</p>
            </li>

            <li>
              <p>Abort these steps.</p>
            </li>

            <li>
              <p><em>Failure</em>: If <var>errorCallback</var> is null,
                abort these steps.</p>
            </li>

            <li>
              <p>Let <var>error</var> be a new <code>
                    <a
                    href="#navigatorusermediaerror">NavigatorUserMediaError</a>
                  </code> object whose <code
                    title="dom-NavigatorUserMediaError-code">
                    <a href="#dom-navigatorusermediaerror-code">code</a>
                  </code> attribute has the numeric value 1 (<code
                    title="dom-NavigatorUserMediaError-PERMISSION_DENIED">
                    <a
                    href="#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a>
                  </code>).</p>
            </li>

            <li>
              <p>Queue a task to invoke <var>errorCallback</var> with
                <var>error</var> as its argument.</p>
            </li>
          </ol>

          <p>The task source for these <span
            title="concept-task">tasks</span> is the user interaction task
            source.</p>
          </dd>
        </dl>

        <div class="idl" title="Navigator implements NavigatorUserMedia" />
      </section>

      <section>
        <h2>MediaStreamConstraints</h2>

        <dl class="idl" title="dictionary MediaStreamConstraints">
          <!--        <dt>boolean audio</dt>

        <dd>Set to true if an audio track is requested, default is false</dd>

        <dt>boolean video</dt>

        <dd>Set to true if a video track is requested, default is false</dd>
-->

          <dt>(boolean or MediaTrackConstraints) video = false;</dt>

          <dd>**** Provide def of video constraints here ****.</dd>

          <dt>(boolean or MediaTrackConstraints) audio = false;</dt>

          <dd>**** Provide def of audio constraints here ****.</dd>
        </dl>

        <dl class="idl" title="dictionary MediaTrackConstraints">
          <dt>MediaTrackConstraintSet? mandatory = null;</dt>

          <dd>**** Provide def of mandatory here ****</dd>

          <dt>MediaTrackConstraint[]? optional = null;</dt>

          <dd>**** Provide def of optional here ****</dd>
        </dl>

        <p>A MediaTrackConstraintSet is a dictionary containing one or more
        key-value pairs, where each key MUST be a valid registered constraint
        name in the IANA-hosted RTCWeb Media Constraints registry
        [[!RTCWEB-CONSTRAINTS]] and its value SHOULD be as defined in the
        associated reference[s] given in the registry.</p>

        <p>A MediaTrackConstraint is a dictionary containing exactly one
        key-value pair, where the key MUST be a valid registered constraint
        name in the IANA-hosted RTCWeb Media Constraints registry
        [[!RTCWEB-CONSTRAINTS]] and the value SHOULD be as defined in the
        associated reference[s] given in the registry.</p>

        <p>TBD - adjust MediaTrackConstraints to also allow true/false values.</p>
      </section>

      <section>
        <h2>NavigatorUserMediaSuccessCallback</h2>

        <dl class="idl"
            title="callback NavigatorUserMediaSuccessCallback = void">
          <dt>LocalMediaStream stream</dt>

          <dd>(Explanation of handleEvent TBD)</dd>
        </dl>
      </section>

      <section>
        <h2>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</h2>

        <dl class="idl"
            title="[NoInterfaceObject] interface NavigatorUserMediaError">
          <dt>const unsigned short PERMISSION_DENIED = 1</dt>

          <dd>The user denied the page permission to use the user's media
          devices.</dd>

          <dt>readonly attribute unsigned short code</dt>

          <dd>Returns the current error's error code. At this time, this will
          always be 1, for which the constant <code
              title="dom-NavigatorUserMediaError-PERMISSION_DENIED">
              <a
              href="#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a>
            </code> is defined.</dd>
        </dl>

        <dl class="idl"
            title="callback NavigatorUserMediaErrorCallback = void">
          <dt>NavigatorUserMediaError error</dt>

          <dd>(Explanation of handleEvent TBD)</dd>
        </dl>
      </section>

      <section class="informative">
        <h2>Implementation Suggestions</h2>

        <subsection>
          <h4>Resource reservation</h4>
          <p>
          User-Agents are suggested to reserve resources when it has
          determined that a given call to getUserMedia will succeed. It is
          preferable to reserve the resource prior to invoking the success
          callback provided by the web page. Subsequent calls to
          <a href="#dom-navigator-getusermedia">getUserMedia()</a> (in this
          page or any other) should treat the resource that was previously
          allocated, as well as resources held by other applications, as busy.
          Resources marked as busy should not be provided as sources to the
          current web page, unless specified by the user.
          </p>

          <p>
          It is suggested that in the permission grant dialog or device
          selection interace (if one is present), the user be allowed to select
          any available hardware as a source for the stream requested
          by the page (provided the resource is able to fulfil mandatory
          constraints, if any were specified), in addition to the ability to
          substitute a video or audio source with local files and other media.
          A file picker may be used to provide this functionality to the user.
          </p>

          <p>
          It is also suggested that the user be shown all resources that are
          currently busy as a result of prior calls
          to <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          (in this page or any other page that is still alive), and be allowed
          to terminate that stream and utilize the resource for the current page
          instead. If possible in the current operating environment, it is also
          suggested that resources currently held by other applications be
          presented and treated in the same manner. If the user chooses this
          option, the track corresponding to the resource that
          was provided to the page whose stream was affected must be removed.
          Additionally, if removing a track in this manner causes the stream to
          contain no more tracks, the <a>onended</a> event must be raised on it.
          </p>
        </subsection>

        <subsection>
          <h4>Handling multiple devices</h4>
          <p>
          A <a>MediaStream</a> may contain more than one video and audio track.
          This makes it possible to include video from two or more webcams in
          a single stream object, for example. However, the current API does
          not allow a page to express a need for multiple video streams from
          independent sources.
          </p>
          <p>
          It is suggested that while the User-Agent may choose to allow the user
          to select multiple video or audio sources to associate with a single
          stream, as a result of a single call to
          <a href="#dom-navigator-getusermedia">getUserMedia()</a>; multiple
          calls to <a href="#dom-navigator-getusermedia">getUserMedia()</a>
          from the same page be allowed as a way for pages to request multiple,
          discrete, video or audio streams.
          </p>
        </subsection>
      </section>
    </section>

    <section>
      <h3>Examples</h3>

      <div>
        <p>This sample code exposes a button. When clicked, the button is
        disabled and the user is prompted to offer a stream. The user can
        cause the button to be re-enabled by providing a stream (e.g. giving
        the page access to the local camera) and then disabling the stream
        (e.g. revoking that access).</p>

        <pre class="example sh_javascript">&lt;input type="button" value="Start" onclick="start()" id="startBtn"&gt;
&lt;script&gt;
 var startBtn = document.getElementById('startBtn');
 function start() {
   navigator.getUserMedia({audio:true, video:true}, gotStream);
   startBtn.disabled = true;
 }
 function gotStream(stream) {
   stream.onended = function () {
     startBtn.disabled = false;
   };
 }
&lt;/script&gt; </pre>
      </div>

      <!-- Put back when we define MediaStreamRecorder
    <div>
      <p>This example allows people to record a short audio message and upload
      it to the server. This example even shows rudimentary error handling.</p>
      <pre class='example sh_javascript'>
&lt;input type="button" value="⚫" onclick="msgRecord()" id="recBtn"&gt;
&lt;input type="button" value="◼" onclick="msgStop()" id="stopBtn" disabled&gt;
&lt;p id="status"&gt;To start recording, press the ⚫ button.&lt;/p&gt;
&lt;script&gt;
 var recBtn = document.getElementById('recBtn');
 var stopBtn = document.getElementById('stopBtn');
 function report(s) {
   document.getElementById('status').textContent = s;
 }
 function msgRecord() {
   report('Attempting to access microphone...');
   navigator.getUserMedia({audio:true}, gotStream, noStream);
   recBtn.disabled = true;
 }
 var msgStream, msgStreamRecorder;
 function gotStream(stream) {
   report('Recording... To stop, press to ◼ button.');
   msgStream = stream;
   msgStreamRecorder = stream.record();
   stopBtn.disabled = false;
   stream.onended = function () {
     msgStop();     
   }
 }
 function msgStop() {
   report('Creating file...');
   stopBtn.disabled = true;
   msgStream.onended = null;
   msgStream.stop();
   msgStreamRecorder.getRecordedData(msgSave);
 }
 function msgSave(blob) {
   report('Uploading file...');
   var x = new XMLHttpRequest();
   x.open('POST', 'uploadMessage');
   x.send(blob);
   x.onload = function () {
     report('Done! To record a new message, press the ⚫ button.');
     recBtn.disabled = false;
   };
   x.onerror = function () {
     report('Failed to upload message. To try recording a message again, press the ⚫ button.');
     recBtn.disabled = false;
   };
 }
 function noStream() {
   report('Could not obtain access to your microphone. To try again, press the ⚫ button.');
   recBtn.disabled = false;
 }
&lt;/script&gt;
</pre>
    </div>-->

      <div>
        <p>This example allows people to take photos of themselves from the
        local video camera.</p>

        <pre class="example sh_javascript">
&lt;article&gt;
 &lt;style scoped&gt;
  video { transform: scaleX(-1); }
  p { text-align: center; }
 &lt;/style&gt;
 &lt;h1&gt;Snapshot Kiosk&lt;/h1&gt;
 &lt;section id="splash"&gt;
  &lt;p id="errorMessage"&gt;Loading...&lt;/p&gt;
 &lt;/section&gt;
 &lt;section id="app" hidden&gt;
  &lt;p&gt;&lt;video id="monitor" autoplay&gt;&lt;/video&gt; &lt;canvas id="photo"&gt;&lt;/canvas&gt;
  &lt;p&gt;&lt;input type=button value="&amp;#x1F4F7;" onclick="snapshot()"&gt;
 &lt;/section&gt;
 &lt;script&gt;
  navigator.getUserMedia({video:true}, gotStream, noStream);
  var video = document.getElementById('monitor');
  var canvas = document.getElementById('photo');
  function gotStream(stream) {
    video.src = URL.createObjectURL(stream);
    video.onerror = function () {
      stream.stop();
    };
    stream.onended = noStream;
    video.onloadedmetadata = function () {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      document.getElementById('splash').hidden = true;
      document.getElementById('app').hidden = false;
    };
  }
  function noStream() {
    document.getElementById('errorMessage').textContent = 'No camera available.';
  }
  function snapshot() {
    canvas.getContext('2d').drawImage(video, 0, 0);
  }
 &lt;/script&gt;
&lt;/article&gt;</pre>
      </div>
    </section>

    <section>
      <h2>Garbage collection</h2>
    </section>

    <section>
      <h2>Event definitions</h2>
    </section>

    <section class="informative">
      <h2>Event summary</h2>
    </section>

    <section>
      <h2 id="sec-iana">IANA Registrations</h2>

      <section>
        <h2 id="sec-constraints">Constraints Registrations</h2>

        <p> IANA is requested to register the following constraints as
        specified in [[!RTCWEB-CONSTRAINTS]]: </p>

        <dl>
        <!-- please leaves this just commented out in the file for now - Cullen

      <dt> EchoCancelation </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> When one or more audio streams is being played in the proceses of
        varios microphones, it is often desirable to attempt to remove the sound
        being played from the input signals recorded by the microphones. This is
        referred to echo cancelation. There are cases where it is not needed and
        it is desirable to turn it off so that no audio artifacts are
        introduced. This constraint allows the application to control this
        behavior. </p>
      </dd>

      <dt> CaptureAudio </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture audio input from a
        microphone. </p>
      </dd>

      <dt> CaptureVideo </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture video input from a
        camera. </p>
      </dd>

      <dt> CaptureImage </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture an single image from a
        camera. </p>
      </dd>


        <dt> EnableSecureMedia </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "false". </p>

        <p> Indicates that application would like the browser to keep the media
        secure. This means that the media will not be a available to JavaScript
        application but is useful for cases where other objects will operate on
        the media stream. For some trusted application environments, the browser
        may enforce that this constraint is a mandatory "true". </p> </dd>

      -->
        </dl>
      </section>
    </section>

    <section>
      <h2>Change Log</h2>

      <p>This section will be removed before publication.</p>

      <h3>To Do Items</h3>

      <p>-</p>

      <h3>June 5 2012</h3>

      <ol>
        <li>Added non-normative section "Implementation Suggestions".</li>
        <li>Removed stray whitespace.</li>
      </ol>

      <h3>June 1 2012</h3>

      <ol>
        <li>Added media constraint algorithm.</li>
      </ol>

      <h3>Apr 23 2012</h3>

      <ol>
        <li>Remove MediaStreamRecorder.</li>
      </ol>

      <h3>Apr 20 2012</h3>

      <ol>
        <li>Add definitions of MediaStreams and related objects.</li>
      </ol>

      <h3>Dec 21 2011</h3>

      <ol>
        <li>Changed to make wanted media opt in (rather than opt out). Minor
        edits.</li>
      </ol>

      <h3>Nov 29 2011</h3>

      <ol>
        <li>Changed examples to use MediaStreamOptions objects rather than
        strings. Minor edits.</li>
      </ol>

      <h3>Nov 15 2011</h3>

      <ol>
        <li>Removed MediaStream stuff. Refers to webrtc 1.0 spec for that part
        instead.</li>
      </ol>

      <h3>Nov 9 2011</h3>

      <ol>
        <li>Created first version by copying the webrtc spec and ripping out
        stuff. Put it on github.</li>
      </ol>
    </section>

    <section class="appendix">
      <h2>Acknowledgements</h2>
    </section>
  </body>
</html>
