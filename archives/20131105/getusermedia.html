<!DOCTYPE html>
<html lang="en-us" typeof="bibo:Document " about="" property="dcterms:language" content="en">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 (experimental) for Linux https://github.com/w3c/tidy-html5/tree/68a9e74">
  <style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;   
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;    
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title { color: #2b2; }
div.issue-title span, div.note-title span {
    text-transform: uppercase;
}
div.note, div.issue {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .issue > p:first-child { margin-top: 0 }
.issue, .note {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.issue { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note {
    border-color: #52e052;
    background: #e9fbe9;
}


</style><style>/* HIGHLIGHTS */
code.prettyprint {
    color:  inherit;
}

/* this from google-code-prettify */
.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
</style><style>/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
    background: #dfffff;
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}
</style><style>/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID, .idlCallbackID, .idlEnumID {
    font-weight:    bold;
    color:  #005a9c;
}
a.idlEnumItem {
    color:  #000;
    border-bottom:  1px dotted #ccc;
    text-decoration: none;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType, .idlCallbackType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlCtor*/
.idlCtorName {
    color:  #ff4500;
}
.idlCtorName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName, .idlDefaultValue {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlSectionComment*/
.idlSectionComment {
    color: gray;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.constructors, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .constructors dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .constructors dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.constructors dt code {
    background:  #cfc;
}

.attributes dd, .methods dd, .constants dd, .constructors dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}
</style><link href="getusermedia.css" rel="stylesheet" type="text/css">

  <title>Media Capture and Streams</title>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <!--
   To publish this document, see instructions in README
   -->

  
  
<style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}
</style><link href="https://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>

<body id="respecDocument" role="document" class="h-entry"><div id="respecHeader" role="contentinfo" class="head">
  <p>
    
      <a href="http://www.w3.org/"><img src="https://www.w3.org/Icons/w3c_home" alt="W3C" height="48" width="72"></a>
    
  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">Media Capture and Streams</h1>
  
  <h2 id="w3c-editor-s-draft-05-november-2013" property="dcterms:issued" datatype="xsd:dateTime" content="2013-11-05T16:09:50.000Z"><acronym title="World Wide Web Consortium">W3C</acronym> Editor's Draft <time class="dt-published" datetime="2013-11-05">05 November 2013</time></h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a class="u-url" href="http://dev.w3.org/2011/webrtc/editor/archives/20131105/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/archives/20131105/getusermedia.html</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/mediacapture-streams/">http://www.w3.org/TR/mediacapture-streams/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/getusermedia.html</a></dd>
    
    
    
    
      
        <dt>Previous editor's draft:</dt>
        <dd><a href="http://dev.w3.org/2011/webrtc/editor/archives/20131017/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/archives/20131017/getusermedia.html</a></dd>
      
    
    
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Daniel C. Burnett</span>, Voxeo</span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Adam Bergkvist</span>, Ericsson</span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Cullen Jennings</span>, Cisco</span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Anant Narayanan</span>, Mozilla (until November 2012)</span>
</dd>

    
    
  </dl>
  
  
  
  
    
      <p class="copyright">Initial Author of this Specification was Ian Hickson, Google Inc., with the following copyright statement:<br> © Copyright 2004-2011 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA. You are granted a license to use, reproduce and create derivative works of this document.</p> <p class="copyright">All subsequent changes since 26 July 2011 done by the <acronym title="World Wide Web Consortium">W3C</acronym> WebRTC Working Group and the Device APIs Working Group are under the following <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>:<br>© 2011-2013 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. <a href="http://www.w3.org/Consortium/Legal/copyright-documents">Document use</a>  rules apply.</p> <p class="copyright">For the entire publication on the <acronym title="World Wide Web Consortium">W3C</acronym> site the <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a> and <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> rules apply.</p>
    
  
  <hr>
</div>
  <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" datatype="" property="dcterms:abstract" class="introductory" id="abstract"><h2 id="h2_abstract" role="heading" aria-level="1">Abstract</h2>
    <p>This document defines a set of JavaScript APIs that allow local media,
    including audio and video, to be requested from a platform.</p>
  </section><section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="sotd" class="introductory"><h2 id="h2_sotd" role="heading" aria-level="1">Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication.
          Other documents may supersede this document. A list of current <acronym title="World Wide Web Consortium">W3C</acronym> publications and the
          latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><acronym title="World Wide Web Consortium">W3C</acronym> technical reports index</a> at
          http://www.w3.org/TR/.</em>
        </p>
        
    <p>This document is not complete. It is subject to major changes and, while
    early experimentations are encouraged, it is therefore not intended for
    implementation. The API is based on preliminary work done in the WHATWG.</p>
  
        <p>
          This document was published by the <a href="http://www.w3.org/2011/04/webrtc/">Web Real-Time Communication Working Group</a> and <a href="http://www.w3.org/2009/dap">Device APIs Working Group</a> as an Editor's Draft.
          
          
            If you wish to make comments regarding this document, please send them to 
            <a href="mailto:public-media-capture@w3.org">public-media-capture@w3.org</a> 
            (<a href="mailto:public-media-capture-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="http://lists.w3.org/Archives/Public/public-media-capture/">archives</a>).
          
          
          
          
            All comments are welcome.
          
        </p>
        
        
          <p>
            Publication as an Editor's Draft does not imply endorsement by the <acronym title="World Wide Web Consortium">W3C</acronym>
            Membership. This is a draft document and may be updated, replaced or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other than work in
            progress.
          </p>
        
        
        <p>
          
            This document was produced by a group operating under the 
            <a id="sotd_patent" about="" rel="w3p:patentRules" href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <acronym title="World Wide Web Consortium">W3C</acronym> Patent
            Policy</a>.
          
          
          
            
              <acronym title="World Wide Web Consortium">W3C</acronym> maintains a public list of any patent disclosures (<a href="http://www.w3.org/2004/01/pp-impl/47318/status" rel="disclosure">Web Real-Time Communication Working Group</a>, <a href="http://www.w3.org/2004/01/pp-impl/43696/status" rel="disclosure">Device APIs Working Group</a>)
            
            made in connection with the deliverables of the group; that page also includes
            instructions for disclosing a patent. An individual who has actual knowledge of a patent
            which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
            Claim(s)</a> must disclose the information in accordance with
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>.
          
          
        </p>
        
      
    
  
</section><section id="toc"><h2 id="h2_toc" role="heading" aria-level="1" class="introductory">Table of Contents</h2><ul id="respecContents" role="directory" class="toc"><li class="tocline"><a class="tocxref" href="#intro"><span class="secno">1. </span>Introduction</a></li><li class="tocline"><a class="tocxref" href="#conformance"><span class="secno">2. </span>Conformance</a></li><li class="tocline"><a class="tocxref" href="#terminology"><span class="secno">3. </span>Terminology</a></li><li class="tocline"><a class="tocxref" href="#stream-api"><span class="secno">4. </span>MediaStream API</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><span class="secno">4.1 </span>Introduction</a></li><li class="tocline"><a class="tocxref" href="#mediastream"><span class="secno">4.2 </span>MediaStream</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#constructors"><span class="secno">4.2.1 </span>Constructors</a></li><li class="tocline"><a class="tocxref" href="#attributes"><span class="secno">4.2.2 </span>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods"><span class="secno">4.2.3 </span>Methods</a></li></ul></li><li class="tocline"><a class="tocxref" href="#mediastreamtrack"><span class="secno">4.3 </span>MediaStreamTrack</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#life-cycle-and-media-flow"><span class="secno">4.3.1 </span>Life-cycle and Media Flow</a></li><li class="tocline"><a class="tocxref" href="#tracks-and-constraints"><span class="secno">4.3.2 </span>Tracks and Constraints</a></li><li class="tocline"><a class="tocxref" href="#interface-definition"><span class="secno">4.3.3 </span>Interface Definition</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#attributes-1"><span class="secno">4.3.3.1 </span>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods-1"><span class="secno">4.3.3.2 </span>Methods</a></li></ul></li><li class="tocline"><a class="tocxref" href="#track-source-types"><span class="secno">4.3.4 </span>Track Source Types</a></li><li class="tocline"><a class="tocxref" href="#isolated-media-streams"><span class="secno">4.3.5 </span>Isolated Media Streams</a></li></ul></li><li class="tocline"><a class="tocxref" href="#mediastreamtrackevent"><span class="secno">4.4 </span>MediaStreamTrackEvent</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#constructors-1"><span class="secno">4.4.1 </span>Constructors</a></li><li class="tocline"><a class="tocxref" href="#attributes-2"><span class="secno">4.4.2 </span>Attributes</a></li><li class="tocline"><a class="tocxref" href="#dictionary-mediastreamtrackeventinit-members"><span class="secno">4.4.3 </span>Dictionary <span class="formerLink"><code>MediaStreamTrackEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a class="tocxref" href="#video-and-audio-tracks"><span class="secno">4.5 </span>Video and Audio Tracks</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#videostreamtrack-interface"><span class="secno">4.5.1 </span>VideoStreamTrack interface</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#constructors-2"><span class="secno">4.5.1.1 </span>Constructors</a></li></ul></li><li class="tocline"><a class="tocxref" href="#audiostreamtrack"><span class="secno">4.5.2 </span>AudioStreamTrack</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#constructors-3"><span class="secno">4.5.2.1 </span>Constructors</a></li></ul></li></ul></li></ul></li><li class="tocline"><a class="tocxref" href="#the-model-sources-sinks-constraints-and-states"><span class="secno">5. </span>The model:  sources, sinks, constraints, and states</a></li><li class="tocline"><a class="tocxref" href="#mediastreams-as-media-elements"><span class="secno">6. </span>MediaStreams as Media Elements</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#direct-assignment-to-media-elements"><span class="secno">6.1 </span>Direct Assignment to Media Elements</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#attributes-3"><span class="secno">6.1.1 </span>Attributes</a></li></ul></li><li class="tocline"><a class="tocxref" href="#loading-and-playing-a-mediastream-in-a-media-element"><span class="secno">6.2 </span>Loading and Playing a MediaStream in a Media Element</a></li><li class="tocline"><a class="tocxref" href="#media-element-attributes-when-playing-a-mediastream"><span class="secno">6.3 </span>Media Element Attributes when Playing a MediaStream</a></li></ul></li><li class="tocline"><a class="tocxref" href="#event-summary"><span class="secno">7. </span>Event summary</a></li><li class="tocline"><a class="tocxref" href="#enumerating-devices"><span class="secno">8. </span>Enumerating Local Media Devices</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#navigatorusermedia"><span class="secno">8.1 </span>NavigatorUserMedia</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#methods-2"><span class="secno">8.1.1 </span>Methods</a></li></ul></li><li class="tocline"><a class="tocxref" href="#device-info"><span class="secno">8.2 </span>Device Info</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#callback-mediadeviceinfocallback-parameters"><span class="secno">8.2.1 </span>Callback <span class="formerLink"><code>MediaDeviceInfoCallback</code></span> Parameters</a></li><li class="tocline"><a class="tocxref" href="#dictionary-mediadeviceinfo-members"><span class="secno">8.2.2 </span>Dictionary <span class="formerLink"><code>MediaDeviceInfo</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a class="tocxref" href="#local-content"><span class="secno">9. </span>Obtaining local multimedia content</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#navigatorusermedia-1"><span class="secno">9.1 </span>NavigatorUserMedia</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#methods-3"><span class="secno">9.1.1 </span>Methods</a></li></ul></li><li class="tocline"><a class="tocxref" href="#mediastreamconstraints"><span class="secno">9.2 </span>MediaStreamConstraints</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#dictionary-mediastreamconstraints-members"><span class="secno">9.2.1 </span>Dictionary <span class="formerLink"><code>MediaStreamConstraints</code></span> Members</a></li></ul></li><li class="tocline"><a class="tocxref" href="#navigatorusermediasuccesscallback"><span class="secno">9.3 </span>NavigatorUserMediaSuccessCallback</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#callback-navigatorusermediasuccesscallback-parameters"><span class="secno">9.3.1 </span>Callback <span class="formerLink"><code>NavigatorUserMediaSuccessCallback</code></span> Parameters</a></li></ul></li><li class="tocline"><a class="tocxref" href="#navigatorusermediaerror-and-navigatorusermediaerrorcallback"><span class="secno">9.4 </span>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#attributes-4"><span class="secno">9.4.1 </span>Attributes</a></li><li class="tocline"><a class="tocxref" href="#callback-navigatorusermediaerrorcallback-parameters"><span class="secno">9.4.2 </span>Callback <span class="formerLink"><code>NavigatorUserMediaErrorCallback</code></span> Parameters</a></li></ul></li><li class="tocline"><a class="tocxref" href="#implementation-suggestions"><span class="secno">9.5 </span>Implementation Suggestions</a></li></ul></li><li class="tocline"><a class="tocxref" href="#constrainable-interface"><span class="secno">10. </span>Constrainable Interface</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#interface-definition-1"><span class="secno">10.1 </span>Interface Definition</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#attributes-5"><span class="secno">10.1.1 </span>Attributes</a></li><li class="tocline"><a class="tocxref" href="#methods-4"><span class="secno">10.1.2 </span>Methods</a></li><li class="tocline"><a class="tocxref" href="#applyconstraints-failure-callback"><span class="secno">10.1.3 </span>applyConstraints Failure Callback</a><ul class="toc"></ul></li><li class="tocline"><a class="tocxref" href="#capabilities-constraints-and-settings"><span class="secno">10.1.4 </span>Capabilities, Constraints, and Settings</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#registry"><span class="secno">10.1.4.1 </span>The Property Registry</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#propertyvaluerange"><span class="secno">10.1.4.1.1 </span>PropertyValueRange</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#dictionary-propertyvaluerange-members"><span class="secno">10.1.4.1.1.1 </span>Dictionary <span class="formerLink"><code>PropertyValueRange</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a class="tocxref" href="#capabilities"><span class="secno">10.1.4.2 </span>Capabilities</a></li><li class="tocline"><a class="tocxref" href="#settings"><span class="secno">10.1.4.3 </span>Settings</a></li><li class="tocline"><a class="tocxref" href="#constraints"><span class="secno">10.1.4.4 </span>Constraints</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#dictionary-constraints-members"><span class="secno">10.1.4.4.1 </span>Dictionary <span class="formerLink"><code>Constraints</code></span> Members</a></li><li class="tocline"><a class="tocxref" href="#constraintset"><span class="secno">10.1.4.4.2 </span>ConstraintSet</a></li><li class="tocline"><a class="tocxref" href="#constraint"><span class="secno">10.1.4.4.3 </span>Constraint</a></li></ul></li></ul></li></ul></li></ul></li><li class="tocline"><a class="tocxref" href="#examples"><span class="secno">11. </span>Examples</a></li><li class="tocline"><a class="tocxref" href="#iana-registrations"><span class="secno">12. </span>IANA Registrations</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#track-property-registrations"><span class="secno">12.1 </span>Track Property Registrations</a></li></ul></li><li class="tocline"><a class="tocxref" href="#change-log"><span class="secno">13. </span>Change Log</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">B.1 </span>Normative references</a></li></ul></li></ul></section>

  

  <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" class="informative" id="intro">
    <!--OddPage--><h2 id="h2_intro" role="heading" aria-level="1"><span class="secno">1. </span>Introduction</h2><p><em>This section is non-normative.</em></p>

    <p>Access to multimedia streams (video, audio, or both) from local devices
    (video cameras, microphones, Web cams) can have a number of uses, such as
    real-time communication, recording, and surveillance.</p>

    <p>This document defines the APIs used to get access to local devices that
    can generate multimedia stream data. This document also defines the MediaStream
    API by which JavaScript is able to manipulate the stream data or otherwise
    process it.</p>
  </section>

<section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="conformance"><!--OddPage--><h2 id="h2_conformance" role="heading" aria-level="1"><span class="secno">2. </span>Conformance</h2>
<p>
  As well as sections marked as non-normative, all authoring guidelines, diagrams, examples,
  and notes in this specification are non-normative. Everything else in this specification is
  normative.
</p>
<p>
  The key words <em title="MUST" class="rfc2119">MUST</em>, <em title="MUST NOT" class="rfc2119">MUST NOT</em>, <em title="REQUIRED" class="rfc2119">REQUIRED</em>, <em title="SHOULD" class="rfc2119">SHOULD</em>, <em title="SHOULD NOT" class="rfc2119">SHOULD NOT</em>, <em title="RECOMMENDED" class="rfc2119">RECOMMENDED</em>, <em title="MAY" class="rfc2119">MAY</em>,
  and <em title="OPTIONAL" class="rfc2119">OPTIONAL</em> in this specification are to be interpreted as described in [<cite><a href="#bib-RFC2119" class="bibref">RFC2119</a></cite>].
</p>

      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn id="dfn-user-agent">user agent</dfn> that implements the
        interfaces that it contains.
      </p>
      <p>
        Implementations that use ECMAScript to implement the APIs defined in
        this specification must implement them in a manner consistent with the
        ECMAScript Bindings defined in the Web IDL specification [<cite><a href="#bib-WEBIDL" class="bibref">WEBIDL</a></cite>],
        as this specification uses that specification and terminology.
      </p>
    </section>
    <section id="terminology">
      <!--OddPage--><h2 id="h2_terminology" role="heading" aria-level="1"><span class="secno">3. </span>Terminology</h2>

      <dl>
        <dt><i>HTML Terms:</i></dt>
        <dd>
          <p>
            The <code><a href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
            EventHandler</a></code> interface represents a callback used for event
            handlers as defined in [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>].
          </p>
          <p>
            The concepts <dfn id="dfn-queue-a-task"><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">
            queue a task</a></dfn> and
            <dfn id="dfn-fires-a-simple-event"><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
            fires a simple event</a></dfn> are defined in [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>].
          </p>

          <p>
            The terms <dfn id="dfn-event-handlers"><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers">
            event handlers</a></dfn> and
            <dfn id="dfn-event-handler-event-types"><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
            event handler event types</a></dfn> are defined in [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>].
          </p>
        </dd>

        <dt><dfn id="dfn-source">source</dfn></dt>
        <dd>
          <p>A source is the "thing" providing the source of a media stream
          track. The source is the broadcaster of the media itself. A
          source can be a physical webcam, microphone, local video or
          audio file from the user's hard drive, network resource, or
          static image.</p>

          <p>Some sources have an identifier which <em title="must" class="rfc2119">must</em> be unique to the application
          (un-guessable by another application) and persistent between
          application sessions (e.g., the identifier for a given
          source device/application must stay the same, but not be
          guessable by another application). Sources that must have an
          identifier are camera and microphone sources; local file
          sources are not required to have an identifier. Source
          identifiers let the application save, identify the
          availability of, and directly request specific sources.</p>

          <p>Other than the identifier, other bits of source identity
          are <strong>never</strong> directly available to the
          application until the user agent connects a source to a
          track. Once a source has been "released" to the application
          (either via a permissions UI, pre-configured allow-list, or
          some other release mechanism) the application will be able
          discover additional source-specific capabilities.</p>

          <p>Sources <strong>do not</strong> have constraints --
          tracks have constraints. When a source is connected to a
          track, it must conform to the constraints present on that
          track (or set of tracks).</p>

          <p>Sources will be released (un-attached) from a track when
          the track is ended for any reason.</p>

          <p>On the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object,
          sources are represented by a <code>sourceType</code>
          attribute. The behavior of APIs associated with the source's
          capabilities and settings change depending on the source
          type.</p>

          <p>Sources have <code><a class="internalDFN" href="#dfn-capabilities">capabilities</a></code>
          and <code>settings</code>. The capabilities and settings
          are "owned" by the source and are common to any (multiple)
          tracks that happen to be using the same source (e.g., if two
          different track objects bound to the same source ask for
          the same capability or setting information, they will get back
          the same answer).</p>
        </dd>

        <dt><dfn id="dfn-state" title="state">Setting (Source Setting)</dfn></dt>
        <dd>
          <p>A setting refers to the immediate, current value of the
          source's (optionally constrained) capabilities. Settings are
          always read-only.</p>
          <p>A source's settings can change dynamically over time due to
          environmental conditions, sink configurations, or constraint
          changes. A source's settings must always conform to the current
          set of mandatory constraints that all of the tracks it is
          bound to have defined, and should do its best to conform to
          the set of optional constraints specified.</p>
          <p>A source's settings are directly exposed to audio and video
          track objects through individual read-only attributes. These
          attributes share the same name as their
          corresponding <a class="internalDFN" href="#dfn-capabilities">capabilities</a>
          and <a class="internalDFN" href="#dfn-constraints">constraints</a>.</p>
          <p>Events are available that signal to the application that
          a source's settings have changed.</p>
          <p>A conforming user-agent <em title="must" class="rfc2119">must</em> support all the setting names
          defined in this spec.</p>
        </dd>

        <dt><dfn title="capabilities" id="dfn-capabilities">Capabilities</dfn></dt>
        <dd>
          <p>Source capabilities are the intrinsic "features" of a
          source object. For each source setting, there is a
          corresponding capability that describes whether it is
          supported by the source and if so, what the range of
          supported values are. Capabilities are expressed as either a
          series of settings (for enumerated-type capabilities) or as a
          min/max range.</p>
          <p>The values of the supported capabilities must be
          normalized to the ranges and enumerated types defined in
          this specification.</p>
          <p>Capabilities return the same underlying per-source
          capabilities, regardless of any user-supplied constraints
          present on the source (capabilities are independent of
          constraints).</p>
          <p>Source capabilities are effectively
          constant. Applications should be able to depend on a
          specific source having the same capabilities for any
          session.</p>
        </dd>

        <dt><dfn title="constraints" id="dfn-constraints">Constraints</dfn></dt>

        <dd>
          <p>Constraints are an optional feature for restricting the
          range of allowed variability on a source. Without provided
          constraints, implementations are free to select a source's
          settings from the full ranges of its supported capabilities, and
          to adjust those settings at any time for any reason.</p>

          <p>Constraints may be optional or mandatory. Optional
          constraints are represented by an ordered list, mandatory
          constraints are an unordered set. The order of the optional
          constraints is from most important (at the head of the list)
          to least important (at the tail of the list).</p>

          <p>Constraints are stored on the track object, not the
          source. Each track can be optionally initialized with
          constraints, or constraints can be added afterward through
          the constraint APIs defined in this spec.</p>

          <p>Applying track level constraints to a source is
          conditional based on the type of source. For example,
          read-only sources will ignore any specified constraints on
          the track.</p>

          <p>It is possible for two tracks that share a unique source
          to apply contradictory constraints. Under such
          contradictions, the implementation will mute both tracks and
          notify them that they are over-constrained.</p>

          <p>Events are available that allow the application to know
          when constraints cannot be met by the user agent. These
          typically occur when the application applies constraints
          beyond the capability of a source, contradictory
          constraints, or in some cases when a source cannot sustain
          itself in over-constrained scenarios (overheating,
          etc.).</p>

          

          <p>A correspondingly-named constraint exists for each
          corresponding source setting name and capability name.  In
          general, user agents will have more flexibility to optimize
          the media streaming experience the fewer constraints are
          applied.</p>
        </dd>
      </dl>
    </section>

  <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="stream-api">
    <!--OddPage--><h2 id="h2_stream-api" role="heading" aria-level="1"><span class="secno">4. </span>MediaStream API</h2>

    <section id="introduction">
      <h3 id="h3_introduction" role="heading" aria-level="2"><span class="secno">4.1 </span>Introduction</h3>

      <p>The <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> interface is used to represent
      streams of media data, typically (but not necessarily) of audio and/or
      video content, e.g. from a local camera. The data from a
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object does not necessarily have a
      canonical binary form; for example, it could just be "the video currently
      coming from the user's video camera". This allows user agents to
      manipulate media streams in whatever fashion is most suitable on the
      user's platform.</p>

      <p>Each <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object can contain zero or more
      tracks, in particular audio and video tracks. All tracks in a MediaStream
      are intended to be synchronized when rendered. Different MediaStreams do
      not need to be synchronized.</p>

      <p>Each track in a MediaStream object has a corresponding
      <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object.</p>

      <p>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> represents content comprising
      one or more channels, where the channels have a defined well known
      relationship to each other (such as a stereo or 5.1 audio signal).</p>

      <p>A channel is the smallest unit considered in this API
      specification.</p>

      <p>A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object has an input and an output.
      The input depends on how the object was created: a
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object generated by a <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code> call (which is
      described later in this document), for instance, might take its input
      from the user's local camera. The output of the object controls how the
      object is used, e.g., what is saved if the object is written to a file or
      what is displayed if the object is used in a <code>video</code>
      element.</p>

      <p>Each track in a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object can be
      disabled, meaning that it is muted in the object's output. All tracks are
      initially enabled.</p>

      <p>A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> can be finished, indicating
      that its inputs have forever stopped providing data.</p>

      <p>The output of a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object <em title="MUST" class="rfc2119">MUST</em> correspond
      to the tracks in its input. Muted audio tracks <em title="MUST" class="rfc2119">MUST</em> be replaced with
      silence. Muted video tracks <em title="MUST" class="rfc2119">MUST</em> be replaced with blackness.</p>

      <p>A new <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object can be created from
      accessible media sources (that does not require any additional
      permissions) using the <code><a href="#dom-mediastream">MediaStream()</a>
      </code> constructor. The constructor argument can either be an existing
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object, in which case all the tracks of
      the given stream are added to the new <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>
      object, or an array of <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects. The
      latter form makes it possible to compose a stream from different source
      streams.</p>

      <p><img alt="A MediaStream" src="images/media-stream.png" width="418"></p>

      <p>Both <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> and <code>
      <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects can be cloned. This allows for
      greater control since the separate instances can be manipulated and
      <a class="internalDFN" href="#dfn-consumer" title="consumer">consumed</a> individually. A cloned <code>
      <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> contains clones of all member tracks from the
      original stream.</p>

      <p>When a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object is being generated
      from a local file (as opposed to a live audio/video source), the user
      agent <em title="SHOULD" class="rfc2119">SHOULD</em> stream the data from the file in real time, not all at once.
      The <code>MediaStream</code> object is also used in contexts outside
      <code>getUserMedia</code>, such as [<cite><a href="#bib-WEBRTC10" class="bibref">WEBRTC10</a></cite>]. In both cases, ensuring
      a realtime stream reduces the ease with which pages can distinguish live
      video from pre-recorded video, which can help protect the user's
      privacy.</p>
    </section>

    <section id="mediastream">
      <h3 id="h3_mediastream" role="heading" aria-level="2"><span class="secno">4.2 </span>MediaStream</h3>

      <p>The <dfn id="dom-mediastream"> <code>MediaStream()</code></dfn>
      constructor composes a new stream out of existing tracks. It takes an
      optional argument of type <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> or an array of
      <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects. <dfn id="mediastream-constructor">When the constructor is
      invoked</dfn>, the UA must run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>stream</var> be a newly constructed <code>
          <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object.</p>
        </li>

        <li>
          <p>Initialize <var>stream's</var> <code><a href="#dom-mediastream-id">id</a></code> attribute to a newly generated
          value.</p>
        </li>

        <li>
          <p>If the constructor's argument is present, run the sub steps that
          corresponds to the argument type.</p>

          <ul>
            <li>
              <p><code>Array</code> of <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
              objects:</p>

              <p>Run the following sub steps for each <code>
              <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> in the array:</p>

              <ol>
                <li>
                  <p><em>Add track</em>: Let <var>track</var> be the <code>
                  <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>  about to be processed.</p>
                </li>

                <li>
                  <p>If <var>track</var> has <a href="#track-ended">ended</a>, then abort these
                  steps and continue with the next track (if any).</p>
                </li>

                <li>
                  <p>Add <var>track</var> to <var>stream</var>'s <a href="#track-set">track set</a>.</p>
                </li>
              </ol>

            </li>

            <li>
              <p><code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>:</p>

              <p>Run the sub steps labeled <em>Add track</em> (above) for every
              <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> in the argument stream's
              <a href="#track-set">track set</a>.
              </p>
            </li>
          </ul>
        </li>

        <li>
          <p>If <var>stream</var>'s <a href="#track-set">track set</a> is
          empty, set <var>stream</var>'s <code><a href="#dom-mediastream-inactive">inactive</a></code> attribute to
          <code>true</code>, otherwise set it to <code>false</code>.</p>
        </li>

        <li>
          <p>Return <var>stream</var>.</p>
        </li>
      </ol>

      <p>A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> can have multiple audio and video
      sources (e.g. because the user has multiple microphones, or because the
      real source of the stream is a media resource with many media tracks).
      The stream represented by a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> thus has zero
      or more tracks.</p>

      <p>The tracks of a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> are stored in a
      <dfn id="track-set">track set</dfn>. The track set <em title="MUST" class="rfc2119">MUST</em> contain the
      <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects that correspond
      to the tracks of the stream. The relative order of the tracks in the set
      is user agent defined and the API will never put any requirements on the
      order. The proper way to find a specific <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
      </code> object in the set is to look it up by its
      <code><a href="#dom-mediastreamtrack-id">id</a></code>.</p>

      <p>An object that reads data from the output of a
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> is referred to as a
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> <dfn id="dfn-consumer">consumer</dfn>. The list of
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> consumers currently include the media
      elements [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>], <code>RTCPeerConnection</code> [<cite><a href="#bib-WEBRTC10" class="bibref">WEBRTC10</a></cite>],
      <code>MediaRecorder</code> [<cite><a href="#bib-mediastream-rec" class="bibref">mediastream-rec</a></cite>] and
      <code>ImageCapture</code> [<cite><a href="#bib-mediastream-imagecap" class="bibref">mediastream-imagecap</a></cite>].</p>

      <div class="note"><div id="h_note_1" role="heading" aria-level="3" class="note-title"><span>Note</span></div><p class=""><code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> consumers must be able to
      handle tracks being added and removed. This behavior is specified per
      consumer.</p></div>

      <p>A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object is said to be
      <dfn id="stream-inactive">inactive</dfn> when it does not have any tracks
      or all tracks belonging to the stream have <a href="#track-ended">ended</a>. Otherwise the
      stream is active. A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> can start its life as
      inactive if it is constructed without any tracks.</p>

      <p>When a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> goes from being active to
      inactive, the user agent <em title="MUST" class="rfc2119">MUST</em> queue a task that sets the object's
      <code><a href="#dom-mediastream-inactive">inactive</a></code> attribute
      to <code>true</code> and fire a simple event named <code><a href="#event-mediastream-inactive">inactive</a></code> at the object. When a
      <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> goes from being inactive to active, the
      user agent <em title="MUST" class="rfc2119">MUST</em> queue a task that sets the object's <code><a href="#dom-mediastream-inactive">inactive</a></code> attribute to
      <code>false</code> and fire a simple event named <code><a href="#event-mediastream-active">active</a></code> at the object.</p>

      <p>If the stream's activity status changed due to a user request, the task
      source for this <span title="concept-task">task</span> is the user
      interaction task source. Otherwise the task source for this <span title="concept-task">task</span> is the networking task source.</p>

      <pre class="idl"><span class="idlInterface" id="idl-def-MediaStream">[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaStream">Constructor</a></span></span>,
<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaStream--MediaStream-stream">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>)</span>,
<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaStream--sequence-MediaStreamTrack--tracks">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>&gt;</span> <span class="idlParamName">tracks</span></span>)</span>]
interface <span class="idlInterfaceID">MediaStream</span> : <span class="idlSuperclass">EventTarget</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>    <span class="idlAttrName"><a href="#widl-MediaStream-id">id</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-MediaStream-getAudioTracks-sequence-MediaStreamTrack">getAudioTracks</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-MediaStream-getVideoTracks-sequence-MediaStreamTrack">getVideoTracks</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>?</span>          <span class="idlMethName"><a href="#widl-MediaStream-getTrackById-MediaStreamTrack-DOMString-trackId">getTrackById</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">trackId</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">void</span>                       <span class="idlMethName"><a href="#widl-MediaStream-addTrack-void-MediaStreamTrack-track">addTrack</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">void</span>                       <span class="idlMethName"><a href="#widl-MediaStream-removeTrack-void-MediaStreamTrack-track">removeTrack</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></span>                <span class="idlMethName"><a href="#widl-MediaStream-clone-MediaStream">clone</a></span> ();</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">boolean</span>      <span class="idlAttrName"><a href="#widl-MediaStream-inactive">inactive</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span> <span class="idlAttrName"><a href="#widl-MediaStream-onactive">onactive</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span> <span class="idlAttrName"><a href="#widl-MediaStream-oninactive">oninactive</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span> <span class="idlAttrName"><a href="#widl-MediaStream-onaddtrack">onaddtrack</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span> <span class="idlAttrName"><a href="#widl-MediaStream-onremovetrack">onremovetrack</a></span>;</span>
};</span></pre><section id="constructors"><h4 id="h4_constructors" role="heading" aria-level="3"><span class="secno">4.2.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-MediaStream"><code>MediaStream</code></dt><dd>See the <a href="#mediastream-constructor">MediaStream constructor algorithm</a><div><em>No parameters.</em></div></dd><dt id="widl-ctor-MediaStream--MediaStream-stream"><code>MediaStream</code></dt><dd>See the <a href="#mediastream-constructor">MediaStream constructor algorithm</a><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table></dd><dt id="widl-ctor-MediaStream--sequence-MediaStreamTrack--tracks"><code>MediaStream</code></dt><dd>See the <a href="#mediastream-constructor">MediaStream constructor algorithm</a><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">tracks</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section><section id="attributes"><h4 id="h4_attributes" role="heading" aria-level="3"><span class="secno">4.2.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStream-id"><code>id</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
          <p>When a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object is created, the
          user agent <em title="MUST" class="rfc2119">MUST</em> generate a globally unique identifier string, and
          <em title="MUST" class="rfc2119">MUST</em> initialize the object's <code><a href="#dom-mediastream-id">id</a></code> attribute to that string.
          Such strings <em title="MUST" class="rfc2119">MUST</em> only use characters in the ranges U+0021, U+0023 to
          U+0027, U+002A to U+002B, U+002D to U+002E, U+0030 to U+0039, U+0041
          to U+005A, U+005E to U+007E, and <em title="MUST" class="rfc2119">MUST</em> be 36 characters long.</p>
          <!-- UUIDs have 36 characters
      including hyphens; the ranges above comes from RFC4574 (the a=label:
      thing in SDP) -->
          <!-- described below -->

          <p>The <dfn id="dom-mediastream-id"><code>id</code></dfn>
          attribute <em title="MUST" class="rfc2119">MUST</em> return the value to which it was initialized when the
          object was created.</p>
        </dd><dt id="widl-MediaStream-inactive"><code>inactive</code> of type <span class="idlAttrType">boolean</span>, readonly   </dt><dd>
          <p>The <dfn id="dom-mediastream-inactive"><code>MediaStream.inactive</code></dfn>
          attribute returns true if the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> is
          <a href="#stream-inactive">inactive</a>, and false otherwise.</p>

          <p>When a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object is created, its
          <code><a href="#dom-mediastream-inactive">inactive</a></code>
          attribute <em title="MUST" class="rfc2119">MUST</em> be set to false, unless stated otherwise (for example
          by the <code><a href="#dom-mediastream">MediaStream()</a></code>
          constructor algorithm).</p>
        </dd><dt id="widl-MediaStream-onactive"><code>onactive</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastream-active">active</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
        all objects implementing the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>
        interface.</dd><dt id="widl-MediaStream-onaddtrack"><code>onaddtrack</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastream-addtrack">addtrack</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
        all objects implementing the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> interface.
        </dd><dt id="widl-MediaStream-oninactive"><code>oninactive</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastream-inactive">inactive</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
        all objects implementing the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>
        interface.</dd><dt id="widl-MediaStream-onremovetrack"><code>onremovetrack</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastream-removetrack">removetrack</a></code>, <em title="MUST" class="rfc2119">MUST</em> be
        supported by all objects implementing the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a>
        </code> interface.</dd></dl></section><section id="methods"><h4 id="h4_methods" role="heading" aria-level="3"><span class="secno">4.2.3 </span>Methods</h4><dl class="methods"><dt id="widl-MediaStream-addTrack-void-MediaStreamTrack-track"><code>addTrack</code></dt><dd>
          <p>Adds the given <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> to this
          <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>.</p>

          <p>When the <dfn id="dom-mediastream-addtrack"><code>addTrack()</code></dfn> method is
          invoked, the user agent <em title="MUST" class="rfc2119">MUST</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>track</var> be the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
              </code> argument and <var>stream</var> this <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>
              object.</p>
            </li>

            <li>
              <p>If <var>stream</var> is finished, throw an
              <code>INVALID_STATE_ERR</code> exception.</p>
            </li>

            <li>
              <p>If <var>track</var> is already in <var>stream's</var>
              <a href="#track-set">track set</a>, then abort these steps.</p>
            </li>

            <li>
              <p>Add <var>track</var> to <var>stream</var>'s <a href="#track-set">track set</a>.</p>
            </li>
          </ol>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code></code></div></dd><dt id="widl-MediaStream-clone-MediaStream"><code>clone</code></dt><dd>
          <p>Clones the given <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> and all its
            tracks.</p>

            <p>When the <dfn id="dom-mediastream-clone"><code>clone()</code></dfn> method
            is invoked, the user agent <em title="MUST" class="rfc2119">MUST</em> run the following steps:</p>

            <ol>
              <li>
                <p>Let <var>streamClone</var> be a newly constructed <code>
                <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object.</p>
              </li>

              <li>
                <p>Initialize <var>streamClone</var>'s <code><a href="#dom-mediastream-id">id</a></code> attribute to a newly
                generated value.</p>
              </li>

              <li>
                <p>Let <var>trackSetClone</var> be a list that contains the
                result of running
                <code><a href="#dom-mediastreamtrack-clone">MediaStreamTrack.clone()</a></code> on all the tracks in this
                stream.</p>
              </li>

              <li>
                <p>Let <var>trackSetClone</var> be <var>streamClone</var>'s
                <a href="#track-set">track set</a>.</p>
              </li>
            </ol>
        <div><em>No parameters.</em></div><div><em>Return type: </em><code></code></div></dd><dt id="widl-MediaStream-getAudioTracks-sequence-MediaStreamTrack"><code>getAudioTracks</code></dt><dd>
          <p>Returns a sequence of <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects
          representing the audio tracks in this stream.</p>

          <p>The <dfn id="dom-mediastream-getaudiotracks"><code>getAudioTracks()</code></dfn>
          method <em title="MUST" class="rfc2119">MUST</em> return a sequence that represents a snapshot of all the
          <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects in this stream's
          <a href="#track-set">track set</a> whose <code>
          <a href="#dom-mediastreamtrack-kind">kind</a></code> is equal to
          "<code>audio</code>". The conversion from the <a href="#track-set">track set</a> to the sequence is user agent defined and
          the order does not have to stable between calls.</p>
        <div><em>No parameters.</em></div><div><em>Return type: </em><code></code></div></dd><dt id="widl-MediaStream-getTrackById-MediaStreamTrack-DOMString-trackId"><code>getTrackById</code></dt><dd>
          <p>The <dfn id="dom-mediastream-gettrackbyid"><code>getTrackById()</code></dfn>
          method <em title="MUST" class="rfc2119">MUST</em> return the first <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
          object in this stream's <a href="#track-set">track set</a> whose
          <code><a href="#dom-mediastreamtrack-id">id</a></code> is equal to
          <var>trackId</var>. The method <em title="MUST" class="rfc2119">MUST</em> return null if no track matches
          the <var>trackId</var> argument.</p>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">trackId</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code></code>, nullable</div></dd><dt id="widl-MediaStream-getVideoTracks-sequence-MediaStreamTrack"><code>getVideoTracks</code></dt><dd>
          <p>Returns a sequence of <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects
          representing the video tracks in this stream.</p>

          <p>The <dfn id="dom-mediastream-getvideotracks"><code>getVideoTracks()</code></dfn>
          method <em title="MUST" class="rfc2119">MUST</em> return a sequence that represents a snapshot of all the
          <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects in this stream's
          <a href="#track-set">track set</a> whose <code>
          <a href="#dom-mediastreamtrack-kind">kind</a></code> is equal to
          "<code>video</code>". The conversion from the <a href="#track-set">track set</a> to the sequence is user agent defined and
          the order does not have to stable between calls.</p>
        <div><em>No parameters.</em></div><div><em>Return type: </em><code></code></div></dd><dt id="widl-MediaStream-removeTrack-void-MediaStreamTrack-track"><code>removeTrack</code></dt><dd>
          <p>Removes the given <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> from this
          <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>.</p>

          <p>When the <dfn id="dom-mediastream-removetrack"><code>removeTrack()</code></dfn> method
          is invoked, the user agent <em title="MUST" class="rfc2119">MUST</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>track</var> be the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
              </code> argument and <var>stream</var> this <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>
              object.</p>
            </li>

            <li>
              <p>If <var>stream</var> is finished, throw an
              <code>INVALID_STATE_ERR</code> exception.</p>
            </li>

            <li>
              <p>If <var>track</var> is in <var>stream</var>'s
              <a href="#track-set">track set</a>, remove it.</p>
            </li>
          </ol>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code></code></div></dd></dl></section>
    </section>

    <section id="mediastreamtrack">
      <h3 id="h3_mediastreamtrack" role="heading" aria-level="2"><span class="secno">4.3 </span>MediaStreamTrack</h3>

      <p>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object represents a media
      source in the user agent. Several <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
      objects can represent the same media source, e.g., when the user chooses
      the same camera in the UI shown by two consecutive calls to
      <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code>
      .</p>

      <p>Note that a web application can revoke all given permissions
      with <code><a href="#dom-mediastreamtrack-stop">MediaStreamTrack.stop()</a></code>.</p>

      <section id="life-cycle-and-media-flow">
        <h4 id="h4_life-cycle-and-media-flow" role="heading" aria-level="3"><span class="secno">4.3.1 </span>Life-cycle and Media Flow</h4>

        <p>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> has three stages in its
        lifecycle; <code>new</code>, <code>live</code> and <code>ended</code>.
        A track begins as <code>new</code> prior to being connected to an
        active source.</p>

        <p>Once connected, the <code><a href="#event-mediastreamtrack-started">started</a></code> event fires and the track
        becomes <code>live</code>. In the <code>live</code> state, the track is
        active and media is available for rendering at a <code>
        <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> <a class="internalDFN" href="#dfn-consumer">consumer</a>.</p>

        <p>A muted or disabled <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> renders either
        silence (audio), black frames (video), or a zero-information-content
        equivalent. For example, a video element sourced by a muted or disabled
        <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> (contained within a
        <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>), is playing but the rendered content
        is the muted output.

        </p><p>The muted/unmuted state of a track reflects if the source
        provides any media at this moment. The enabled/disabled state is under
        application control and determines if the track outputs media (to its
        consumers). Hence, media from the source only flows when a <code>
        <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object is both unmuted and enabled.</p>

        <p>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> is <dfn id="track-muted">muted</dfn> when the source is temporarily unable to
        provide the track with data. A track can be muted by a user. Often this
        action is outside the control of the application. This could be as a
        result of the user hitting a hardware switch, or toggling a control in
        the operating system or browser chrome. A track can also be muted by the
        user agent. For example, a track that is a member of a <code>
        <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>, received via a <code>RTCPeerConnection
        </code> [<cite><a href="#bib-WEBRTC10" class="bibref">WEBRTC10</a></cite>], is muted if the application on the other side
        disables the corresponding track in the <code>MediaStream</code> being
        sent.</p>

        <p>Applications are able to <dfn id="track-enabled">enable</dfn> or
        disable a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> to prevent it from
        rendering media from the source. A muted track will however, regardless
        of the enabled state, render silence and blackness. A disabled track is
        logically equivalent to a muted track, from a consumer point of view.
        </p>

        <p>For a newly created <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object, the
        following applies. The track is always enabled unless stated otherwise
        (for examlpe when cloned) and the muted state reflects the state of the
        source at the time the track is created.</p>

        <p>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object is said to <em>end</em>
        when the source of the track is disconnected or exhausted.</p>

        <p>When a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object ends for any reason
        (e.g., because the user rescinds the permission for the page to use the
        local camera, or because the data comes from a finite file and the file's
        end has been reached and the user has not requested that it be looped, or
        because the UA has instructed the track to end for any reason, or because
        the reference count of the track's underlying media source has reached
        zero), it is said to be <dfn id="track-ended">ended</dfn>. When track instance
        <var>track</var> ends for any reason other than the <code><a href="#dom-mediastreamtrack-stop">stop()</a></code> method being invoked on the
        <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object that represents
        <var>track</var>, the user agent <em title="MUST" class="rfc2119">MUST</em> queue a task that runs the
        following steps:</p>

        <ol>
          <li>
            <p>If the track's <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute
            has the value <code>ended</code> already, then abort these steps.
            (The <code><a href="#dom-mediastreamtrack-stop">stop()</a></code>
            method was probably called just before the track stopped for other
            reasons.)</p>
          </li>

          <li>
            <p>Set <var>track's</var> <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute to
            <code>ended</code>.</p>
          </li>

          <li>
            <p>Fire a simple event named <code><a href="#event-mediastreamtrack-ended">ended</a></code> at the object.</p>
          </li>
        </ol>

        <p>If the end of the stream was reached due to a user request, the event
        source for this event is the user interaction event source.</p>
      </section>

      <section id="tracks-and-constraints">
        <h4 id="h4_tracks-and-constraints" role="heading" aria-level="3"><span class="secno">4.3.2 </span>Tracks and Constraints</h4>

        <p>Constraints are independent of sources.  However, if
        the <code>sourceType</code> is "none",
        the <code><a class="internalDFN" href="#dom-mediastreamtrack-readonly">readonly</a></code> attribute
        is <code>true</code>, or the <code><a class="internalDFN" href="#dom-mediastreamtrack-remote">remote</a></code>
        attribute is <code>true</code>, the track's constraints will
        not be applied to the source.</p>

        <p>Whether <code><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></code> were provided at
        track initialization time or need to be established later at
        runtime, the APIs defined in the <a class="idlType" href="#idl-def-Constrainable"><code>Constrainable</code></a> 
        Interface allow the retrieval and
        manipulation of the constraints currently established on a
        track.</p>

        <p>Each track maintains an internal version of
        the <code><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></code> structure, namely a
        mandatory set of constraints (no duplicates), and an optional
        ordered list of individual constraint objects (may contain
        duplicates). The internal stored constraint structure is 
        exposed to the application by the 
        <code><a class="internalDFN" href="#dfn-constraints">constraints</a></code> attribute, and may be modified
        by the <code>applyConstraints()</code> method.
        </p>

        <p>When <code>applyConstraints()</code> is called, a user agent <em title="must" class="rfc2119">must</em> queue a task to evaluate those changes
        when the task queue is next serviced. Similarly, if
        the <a href="#widl-MediaSourceStates-sourceType"><code>sourceType</code></a>
        changes, then the user agent should perform the same actions to
        re-evaluate the constraints of each track affected by that
        source change.</p>
      </section>

      <section id="interface-definition">
        <h4 id="h4_interface-definition" role="heading" aria-level="3"><span class="secno">4.3.3 </span>Interface Definition</h4>
        

 <pre class="idl"><span class="idlImplements"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a> implements <a class="idlType" href="#idl-def-Constrainable"><code>Constrainable</code></a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> type are defined to also implement the <a class="idlType" href="#idl-def-Constrainable"><code>Constrainable</code></a> interface.</p></div>
        <pre class="idl"><span class="idlInterface" id="idl-def-MediaStreamTrack">interface <span class="idlInterfaceID">MediaStreamTrack</span> : <span class="idlSuperclass">EventTarget</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>             <span class="idlAttrName"><a href="#widl-MediaStreamTrack-kind">kind</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>             <span class="idlAttrName"><a href="#widl-MediaStreamTrack-id">id</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>             <span class="idlAttrName"><a href="#widl-MediaStreamTrack-label">label</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">boolean</span>               <span class="idlAttrName"><a href="#widl-MediaStreamTrack-enabled">enabled</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">boolean</span>               <span class="idlAttrName"><a href="#widl-MediaStreamTrack-muted">muted</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span>          <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onmute">onmute</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span>          <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onunmute">onunmute</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">boolean</span>               <span class="idlAttrName"><a href="#widl-MediaStreamTrack-_readonly">_readonly</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">boolean</span>               <span class="idlAttrName"><a href="#widl-MediaStreamTrack-remote">remote</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStreamTrackState"><code>MediaStreamTrackState</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrack-readyState">readyState</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span>          <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onstarted">onstarted</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span>          <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onended">onended</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> <span class="idlMethName"><a href="#widl-MediaStreamTrack-clone-MediaStreamTrack">clone</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">void</span>             <span class="idlMethName"><a href="#widl-MediaStreamTrack-stop-void">stop</a></span> ();</span>
};</span></pre><section id="attributes-1"><h5 id="h5_attributes-1" role="heading" aria-level="4"><span class="secno">4.3.3.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-MediaStreamTrack-enabled"><code>enabled</code> of type <span class="idlAttrType">boolean</span>,            </dt><dd>
            <p>The <dfn id="dom-mediastreamtrack-enabled"><code>MediaStreamTrack.enabled</code></dfn>
            attribute, on getting, <em title="MUST" class="rfc2119">MUST</em> return the last value to which it was
            set. On setting, it <em title="MUST" class="rfc2119">MUST</em> be set to the new value, and then, if the
            <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object is still associated with
            a track, <em title="MUST" class="rfc2119">MUST</em> enable the track if the new value is true, and disable
            it otherwise.</p>

            <div class="note"><div id="h_note_2" role="heading" aria-level="5" class="note-title"><span>Note</span></div><p class="">Thus, after a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> is
            disassociated from its track, its <code><a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute still
            changes value when set; it just doesn't do anything with that new
            value.</p></div>
          </dd><dt id="widl-MediaStreamTrack-id"><code>id</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
            <p>Unless a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object is created as
            a part a of special purpose algorithm that specifies how the track id
            must be initialized, the user agent <em title="MUST" class="rfc2119">MUST</em> generate a globally unique
            identifier string and initialize the object's <code><a href="#dom-mediastreamtrack-id">id</a></code> attribute to that string.</p>

            <p>An example of an algorithm that specifies how the track id must be
            initialized is the algorithm to represent an incoming network
            component with a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object.
            [<cite><a href="#bib-WEBRTC10" class="bibref">WEBRTC10</a></cite>]</p>

            <p><dfn id="dom-mediastreamtrack-id">
            <code>MediaStreamTrack.id</code></dfn> attribute <em title="MUST" class="rfc2119">MUST</em> return the value
            to which it was initialized when the object was created.</p>
          </dd><dt id="widl-MediaStreamTrack-kind"><code>kind</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
            <p>The <dfn id="dom-mediastreamtrack-kind"><code>MediaStreamTrack.kind</code></dfn>
            attribute <em title="MUST" class="rfc2119">MUST</em> return the string "<code>audio</code>" if the object
            represents an audio track or "<code>video</code>" if object represents
            a video track.</p>
          </dd><dt id="widl-MediaStreamTrack-label"><code>label</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
            <p>User agents <em title="MAY" class="rfc2119">MAY</em> label audio and video sources (e.g., "Internal
            microphone" or "External USB Webcam"). The <dfn id="dom-mediastreamtrack-label"><code>MediaStreamTrack.label</code></dfn>
            attribute <em title="MUST" class="rfc2119">MUST</em> return the label of the object's corresponding track,
            if any. If the corresponding track has or had no label, the attribute
            <em title="MUST" class="rfc2119">MUST</em> instead return the empty string.</p>

            <div class="note"><div id="h_note_3" role="heading" aria-level="5" class="note-title"><span>Note</span></div><p class="">Thus the <code><a href="#dom-mediastreamtrack-kind">kind</a></code> and <code title="dom-MediaStreamTrack-label"><a href="#dom-mediastreamtrack-label">label</a></code> attributes do not
            change value, even if the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object
            is disassociated from its corresponding track.</p></div>
          </dd><dt id="widl-MediaStreamTrack-muted"><code>muted</code> of type <span class="idlAttrType">boolean</span>, readonly   </dt><dd>
            <p>The <dfn id="dom-mediastreamtrack-muted"><code>MediaStreamTrack.muted</code></dfn>
            attribute <em title="MUST" class="rfc2119">MUST</em> return <code>true</code> if the track is <a href="#track-muted">muted</a>, and <code>false</code> otherwise.</p>
          </dd><dt id="widl-MediaStreamTrack-onended"><code>onended</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-ended">ended</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
          all objects implementing the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
          interface.</dd><dt id="widl-MediaStreamTrack-onmute"><code>onmute</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-mute">mute</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
          all objects implementing the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
          interface.</dd><dt id="widl-MediaStreamTrack-onstarted"><code>onstarted</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-started">started</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
          all objects implementing the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
          interface.</dd><dt id="widl-MediaStreamTrack-onunmute"><code>onunmute</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-unmute">unmute</a></code>, <em title="MUST" class="rfc2119">MUST</em> be supported by
          all objects implementing the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
          interface.</dd><dt id="widl-MediaStreamTrack-_readonly"><code>readonly</code> of type <span class="idlAttrType">boolean</span>, readonly   </dt><dd>
            If the track (audio or video) is backed by a read-only
            source such as a file, or the track source is a local
            microphone or camera, but is shared so that constraints applied to
            the track cannot modify the source's state, the <dfn id="dom-mediastreamtrack-readonly"><code>readonly</code></dfn>
            attribute <em title="MUST" class="rfc2119">MUST</em> return the value <code>true</code>.
            Otherwise, it must return the value <code>false</code>.
          </dd><dt id="widl-MediaStreamTrack-readyState"><code>readyState</code> of type <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStreamTrackState"><code>MediaStreamTrackState</code></a></span>, readonly   </dt><dd>
            <p>The <dfn id="dom-mediastreamtrack-readystate"><code>readyState</code></dfn>
            attribute represents the state of the track. It <em title="MUST" class="rfc2119">MUST</em> return the value
            to which the user agent last set it.</p>
          </dd><dt id="widl-MediaStreamTrack-remote"><code>remote</code> of type <span class="idlAttrType">boolean</span>, readonly   </dt><dd>
            If the track is sourced by
            an <code>RTCPeerConnection</code>, the <dfn id="dom-mediastreamtrack-remote"><code>remote</code></dfn>
            attribute <em title="MUST" class="rfc2119">MUST</em> return the value <code>true</code>.
            Otherwise, it must return the value <code>false</code>.
          </dd></dl></section><section id="methods-1"><h5 id="h5_methods-1" role="heading" aria-level="4"><span class="secno">4.3.3.2 </span>Methods</h5><dl class="methods"><dt id="widl-MediaStreamTrack-clone-MediaStreamTrack"><code>clone</code></dt><dd>
            <p>Clones the given <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>.</p>

            <p>When the <dfn id="dom-mediastreamtrack-clone"><code>clone()</code></dfn> method
            is invoked, the user agent <em title="MUST" class="rfc2119">MUST</em> run the following steps:</p>

            <ol>
              <li>
                <p>Let <var>trackClone</var> be a newly constructed <code>
                <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object.</p>
              </li>

              <li>
                <p>Initialize <var>trackClone</var>'s <code><a href="#dom-mediastreamtrack-id">id</a></code> attribute to a newly
                generated value.</p>
              </li>

              <li>
                <p>Let <var>trackClone</var> inherit this track's underlying
                source, <code>
                <a href="#dom-mediastreamtrack-kind">kind</a></code>, <code>
                <a href="#dom-mediastreamtrack-label">label</a></code> and
                <a href="#dom-mediastreamtrack-enabled">enabled</a>
                attributes.</p>
              </li>

              <li>
                <p>Return <var>trackClone</var>.</p>
              </li>
            </ol>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code></code></div></dd><dt id="widl-MediaStreamTrack-stop-void"><code>stop</code></dt><dd>
            <p>When a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
            object's <dfn id="dom-mediastreamtrack-stop"><code>stop()</code></dfn> method
            is invoked, the user agent <em title="MUST" class="rfc2119">MUST</em> run following steps:</p>

            <ol>
              <li>
                <p>Let <var>track</var> be the current
                <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object.</p>
              </li>

              <li>
                <p>If <var>track</var> has no source attached
                (<code>sourceType</code> is "none") or if the source is
                provided by an <code>RTCPeerConnection</code>, then abort these
                steps.</p>
              </li>

              <li>
                <p>Set <var>track's</var> <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code>
                attribute to <code>ended</code>.</p>
              </li>

              <li>
                <p>Permanently stop the generation of data for <var>track</var>'s
                source. If the data is being generated from a live source (e.g.,
                a microphone or camera), then the user agent <em title="SHOULD" class="rfc2119">SHOULD</em> remove any
                active "on-air" indicator for that source. If the data is being
                generated from a prerecorded source (e.g. a video file), any
                remaining content in the file is ignored.</p>

                <div class="note"><div id="h_note_4" role="heading" aria-level="5" class="note-title"><span>Note</span></div><p class="">This will effectively
                <a href="#track-ended">end</a> all other
                <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> objects sharing the same
                source as <var>track</var>.</p></div>
              </li>
            </ol>

            <p>The task source for the <span title="concept-task">tasks</span>
            queued for the <code><a href="#dom-mediastreamtrack-stop">stop()</a></code> method is the DOM
            manipulation task source.</p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code></code></div></dd></dl></section>
        
 

        <pre class="idl"><span class="idlEnum" id="idl-def-MediaStreamTrackState">enum <span class="idlEnumID">MediaStreamTrackState</span> {
    "<a href="#idl-def-MediaStreamTrackState.new" class="idlEnumItem">new</a>",
    "<a href="#idl-def-MediaStreamTrackState.live" class="idlEnumItem">live</a>",
    "<a href="#idl-def-MediaStreamTrackState.ended" class="idlEnumItem">ended</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-MediaStreamTrackState.new">new</code></td><td>The track type is new and has not been initialized
            (connected to a source of any kind). This state implies that
            the track's label will be the empty string.</td></tr><tr><td><code id="idl-def-MediaStreamTrackState.live">live</code></td><td>
            <p>The track is active (the track's underlying media source is making
            a best-effort attempt to provide data in real time).</p>

            <p>The output of a track in the <code>live</code> state can be
            switched on and off with the <code><a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute.</p>
          </td></tr><tr><td><code id="idl-def-MediaStreamTrackState.ended">ended</code></td><td>
            <p>The track has <a href="#track-ended">ended</a> (the track's underlying media source is
            no longer providing data, and will never provide more data for this
            track).  Once a track enters this state, it never exits it.</p>

            <p>For example, a video track in a
            <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> ends if the user unplugs the
            USB web camera that acts as the track's media source.</p>
          </td></tr></tbody></table>
        

      </section>

      <section id="track-source-types">
        <h4 id="h4_track-source-types" role="heading" aria-level="3"><span class="secno">4.3.4 </span>Track Source Types</h4>

        <pre class="idl"><span class="idlEnum" id="idl-def-SourceTypeEnum">enum <span class="idlEnumID">SourceTypeEnum</span> {
    "<a href="#idl-def-SourceTypeEnum.none" class="idlEnumItem">none</a>",
    "<a href="#idl-def-SourceTypeEnum.camera" class="idlEnumItem">camera</a>",
    "<a href="#idl-def-SourceTypeEnum.microphone" class="idlEnumItem">microphone</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-SourceTypeEnum.none">none</code></td><td>This track has no source. This is the case when the
	  track is in the <code>"new"</code> or <code>"ended"</code>
	  <code><a class="internalDFN" href="#dom-mediastreamtrack-readystate">readyState</a></code>.</td></tr><tr><td><code id="idl-def-SourceTypeEnum.camera">camera</code></td><td>A valid source type only for
	  <code><a class="idlType" href="#idl-def-VideoStreamTrack"><code>VideoStreamTrack</code></a></code>s. The source is a local
	  video-producing camera source.</td></tr><tr><td><code id="idl-def-SourceTypeEnum.microphone">microphone</code></td><td>A valid source type only for
	  <code><a class="idlType" href="#idl-def-AudioStreamTrack"><code>AudioStreamTrack</code></a></code>s. The source is a local
	  audio-producing microphone source.</td></tr></tbody></table>
      </section>

      <section id="isolated-media-streams">
        <h4 id="h4_isolated-media-streams" role="heading" aria-level="3"><span class="secno">4.3.5 </span>Isolated Media Streams</h4>
        
        <p>When either of the "noaccess" or "peerIdentity" constraints is
          applied to a MediaStreamTrack, the track shall be isolated so that its
          content is not accessible to the content JS. An isolated media stream
          may be used for two purposes:
        </p>
        <ul>
          <li>
            <p>
              Displayed in an appropriate tag (e.g., a video or audio element).
              The video element <em title="MUST" class="rfc2119">MUST</em> have a unique origin so that it is
              inaccessible to the content JS. This is the same security mechanism
              as is used with an ordinary audio or video element which has
              a src= property from a separate origin.
            </p>
          </li>
          <li>
            <p>
              Used as the argument to addStream() for a PeerConnection, subject
              to the restrictions detailed in the WebRTC document.
            </p>
          </li>
        </ul>
        <p>
          When the noaccess=true constraint applies to a track, that track
          may be added to any PeerConnection.
        </p>

        <div class="note"><div id="h_note_5" role="heading" aria-level="4" class="note-title"><span>Note</span></div><p class=""> Open Issue: The editors worry that the above paragraph
        is just wrong. If the track can be added to a PeerConnection that
        is connect to another PeerConenction in the same application, the
        application could get access to the data. We sugest this should be changed
        from "may be added" to "may not be added". This will allow noaccess=true
        to be used for things like hair check dialogs. 
        </p></div>
        
        <p>
          When the peerIdentity=foo constraint applies to a track, then
          that track may be added only to PeerConnections with compatible
          peer identities as described in the WebRTC document.
        </p>

        <p>
          Both the noaccess and peerIdentity constraints must be mandatory.
          Any use of them in the optional block must trigger an error.
        </p>
      </section>
    </section>

    <section id="mediastreamtrackevent">
      <h3 id="h3_mediastreamtrackevent" role="heading" aria-level="2"><span class="secno">4.4 </span>MediaStreamTrackEvent</h3>

      <p>The <code><a href="#event-mediastream-addtrack">addtrack</a></code> and
      <code title="event-MediaStreamTracklist-removetrack"><a href="#event-mediastream-removetrack">removetrack</a></code> events
      use the <code><a class="idlType" href="#idl-def-MediaStreamTrackEvent"><code>MediaStreamTrackEvent</code></a></code> interface.</p>

      <p><dfn id="dfn-fire-a-track-event" title="Fire a track event">Firing a track event named
      <var>e</var></dfn> with a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
      <var>track</var> means that an event with the name <var>e</var>, which
      does not bubble (except where otherwise stated) and is not cancelable
      (except where otherwise stated), and which uses the
      <code><a class="idlType" href="#idl-def-MediaStreamTrackEvent"><code>MediaStreamTrackEvent</code></a></code> interface with the
      <code><a href="#dom-mediastreamtrackevent-track">track</a></code>
      attribute set to <var>track</var>, <em title="MUST" class="rfc2119">MUST</em> be created and dispatched at the
      given target.</p>

      <pre class="idl"><span class="idlInterface" id="idl-def-MediaStreamTrackEvent"><span class="idlDictionary" id="idl-def-MediaStreamTrackEventInit">dictionary <span class="idlDictionaryID">MediaStreamTrackEventInit</span> : <span class="idlSuperclass">EventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>?</span> <span class="idlMemberName"><a href="#widl-MediaStreamTrackEventInit-track">track</a></span>;</span>
};</span><br><br>[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaStreamTrackEvent--DOMString-type-MediaStreamTrackEventInit-eventInitDict">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">type</span></span>, <span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStreamTrackEventInit"><code>MediaStreamTrackEventInit</code></a></span> <span class="idlParamName">eventInitDict</span></span>)</span>]
interface <span class="idlInterfaceID">MediaStreamTrackEvent</span> : <span class="idlSuperclass">Event</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrackEvent-track">track</a></span>;</span>
};</span></pre><section id="constructors-1"><h4 id="h4_constructors-1" role="heading" aria-level="3"><span class="secno">4.4.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-MediaStreamTrackEvent--DOMString-type-MediaStreamTrackEventInit-eventInitDict"><code>MediaStreamTrackEvent</code></dt><dd><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr><tr><td class="prmName">eventInitDict</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section><section id="attributes-2"><h4 id="h4_attributes-2" role="heading" aria-level="3"><span class="secno">4.4.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamTrackEvent-track"><code>track</code> of type <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span>, readonly   </dt><dd>
          <p>The <dfn id="dom-mediastreamtrackevent-track"><code>track</code></dfn> attribute
          represents the <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object associated
          with the event.</p>
        </dd></dl></section>

      <section id="dictionary-mediastreamtrackeventinit-members"><h4 id="h4_dictionary-mediastreamtrackeventinit-members" role="heading" aria-level="3"><span class="secno">4.4.3 </span>Dictionary <a href="#idl-def-MediaStreamTrackEventInit" class="idlType"><code>MediaStreamTrackEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamTrackEventInit-track"><code>track</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span>, nullable</dt><dd>
          <p>&nbsp;</p>
        </dd></dl></section>
    </section>

    <section id="video-and-audio-tracks">
      <h3 id="h3_video-and-audio-tracks" role="heading" aria-level="2"><span class="secno">4.5 </span>Video and Audio Tracks</h3>

      <p>The <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> object cannot be
      instantiated directly. To create an instance of
      a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>, one of its derived track
      types may be instantiated. These derived types are defined in
      this section.</p>

      <p>Note that the camera's <q>green light</q> doesn't come on
      when a new track is created; nor does the user get prompted to
      enable the camera/microphone. Those actions only happen after
      the developer has requested that a media stream
      containing <code>"new"</code> tracks be bound to a source
      via <code><a class="internalDFN" href="#dom-navigator-getusermedia">getUserMedia()</a></code>. Until that point tracks
      are inert.</p>

      <section id="videostreamtrack-interface">
        <h4 id="h4_videostreamtrack-interface" role="heading" aria-level="3"><span class="secno">4.5.1 </span>VideoStreamTrack interface</h4>

        <p>Video tracks may be instantiated with optional media track
        constraints. These constraints can be later modified on the
        track as needed by the application, or created after-the-fact
        if the initial constraints are unknown to the application.</p>

        <div class="note"><div id="h_note_6" role="heading" aria-level="4" class="note-title"><span>Note</span></div><div class="">
          <p><strong>Example: </strong> <code><a class="idlType" href="#idl-def-VideoStreamTrack"><code>VideoStreamTrack</code></a></code>
          objects are instantiated in JavaScript using the new
          operator:</p>
          <pre><b>new</b> <code>VideoStreamTrack</code>();</pre>
          or
          <pre><b>new</b> <code>VideoStreamTrack</code>( { optional: [ { <code>sourceId</code>: "20983-20o198-109283-098-09812" }, { <code>width</code>: { min: 800, max: 1200 }}, { <code>height</code>: { min: 600 }}] });</pre>
          </div></div>

        <pre class="idl"><span class="idlInterface" id="idl-def-VideoStreamTrack">[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-VideoStreamTrack--Constraints-videoConstraints">Constructor</a></span> (<span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span> <span class="idlParamName">videoConstraints</span></span>)</span>]
interface <span class="idlInterfaceID">VideoStreamTrack</span> : <span class="idlSuperclass"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> {
};</span></pre><section id="constructors-2"><h5 id="h5_constructors-2" role="heading" aria-level="4"><span class="secno">4.5.1.1 </span>Constructors</h5><dl class="constructors"><dt id="widl-ctor-VideoStreamTrack--Constraints-videoConstraints"><code>VideoStreamTrack</code></dt><dd><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">videoConstraints</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section>
      </section>
                    
      <section id="audiostreamtrack">
        <h4 id="h4_audiostreamtrack" role="heading" aria-level="3"><span class="secno">4.5.2 </span>AudioStreamTrack</h4>
                
          <div class="note"><div id="h_note_7" role="heading" aria-level="4" class="note-title"><span>Note</span></div><div class="">
            <p><strong>Example: </strong><code><a class="idlType" href="#idl-def-AudioStreamTrack"><code>AudioStreamTrack</code></a></code> objects are instantiated in JavaScript using the new operator:</p>
              <pre><b>new</b> <code>AudioStreamTrack</code>();</pre>
              or
              <pre><b>new</b> <code>AudioStreamTrack</code>( { optional: [ { <code>sourceId</code>: "64815-wi3c89-1839dk-x82-392aa" }, { <code>gain</code>: 0.5 }] });</pre>
            </div></div>

          <pre class="idl"><span class="idlInterface" id="idl-def-AudioStreamTrack">[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-AudioStreamTrack--Constraints-audioConstraints">Constructor</a></span> (<span class="idlParam">optional <span class="idlParamType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span> <span class="idlParamName">audioConstraints</span></span>)</span>]
interface <span class="idlInterfaceID">AudioStreamTrack</span> : <span class="idlSuperclass"><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></span> {
};</span></pre><section id="constructors-3"><h5 id="h5_constructors-3" role="heading" aria-level="4"><span class="secno">4.5.2.1 </span>Constructors</h5><dl class="constructors"><dt id="widl-ctor-AudioStreamTrack--Constraints-audioConstraints"><code>AudioStreamTrack</code></dt><dd><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">audioConstraints</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section>
        </section>
      </section>
    </section>

    <section id="the-model-sources-sinks-constraints-and-states">
      <!--OddPage--><h2 id="h2_the-model-sources-sinks-constraints-and-states" role="heading" aria-level="1"><span class="secno">5. </span>The model:  sources, sinks, constraints, and states</h2>

      <p>Browsers provide a media pipeline from sources to sinks.  In
      a browser, sinks are the &lt;img&gt;, &lt;video&gt; and
      &lt;audio&gt; tags. Traditional sources include camera,
      microphones, streamed content, files and web resources.  The
      media produced by these sources typically does not change over
      time - these sources can be considered to be static.</p>
	
      <p>The sinks that display these sources to the user (the actual
      tags themselves) have a variety of controls for manipulating the
      source content.  For example, an &lt;img&gt; tag scales down a
      huge source image of 1600x1200 pixels to fit in a rectangle
      defined with <code>width="400"</code>
      and <code>height="300"</code>.</p>

      <p>The getUserMedia API adds dynamic sources such as microphones
      and cameras - the characteristics of these sources can change in
      response to application needs. These sources can be considered
      to be dynamic in nature. A &lt;video&gt; element that displays
      media from a dynamic source can either perform scaling or it can
      feed back information along the media pipeline and have the
      source produce content more suitable for display.</p>

      <div class="note"><div id="h_note_8" role="heading" aria-level="2" class="note-title"><span>Note</span></div><div class="">
        <p><strong>Note: </strong> This sort of feedback loop is
        obviously just enabling an "optimization", but it's a
        non-trivial gain. This optimization can save battery, allow
        for less network congestion, etc...</p>
      </div></div>

      <p>Note that <code>MediaStream</code> sinks
      (such as <code>&lt;video&gt;</code>, <code>&lt;audio&gt;</code>,
      and even <code>RTCPeerConnection</code>) will continue to have
      mechanisms to further transform the source stream beyond that
      which the Settings, <a class="internalDFN" href="#dfn-capabilities">Capabilities</a>,
      and <a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a> described in this specification
      offer. (The sink transformation options, including
      those of <code>RTCPeerConnection</code>, are outside the scope of
      this specification.)</p>

      <p>The act of changing or applying a track constraint may affect
      the <code>settings</code> of all
      tracks sharing that source and consequently all down-level sinks
      that are using that source. Many sinks may be able to take these
      changes in stride, such as the <code>&lt;video&gt;</code>
      element or <code>RTCPeerConnection</code>.  Others like the
      Recorder API may fail as a result of a source state change.</p>

      <p>The <code>RTCPeerConnection</code> is an interesting object
      because it acts simultaneously as both a
      sink <strong>and</strong> a source for over-the-network
      streams. As a sink, it has source transformational capabilities
      (e.g., lowering bit-rates, scaling-up or down resolutions,
      adjusting frame-rates), and as a source it could have its own
      states changed by a track source (though in this specification
      sources with the <code><a class="internalDFN" href="#dom-mediastreamtrack-remote">remote</a></code> attribute set to
      true do not consider the current constraints applied to a
      track).  </p>

      <p>To illustrate how changes to a given source impact various
      sinks, consider the following example. This example only uses
      width and height, but the same principles apply to any of
      the Settings exposed
      in this proposal. In the first figure a home client has obtained
      a video source from its local video camera. The source's width
      and height state are 800 pixels by 600 pixels,
      respectively. Three <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> objects on
      the home client contain tracks that use this
      same <code>sourceId</code>. The three media streams are
      connected to three different sinks:  a <code>&lt;video&gt;</code>
      element (A), another <code>&lt;video&gt;</code> element (B), and
      a peer connection (C). The peer connection is streaming the
      source video to an away client. On the away client there are two
      media streams with tracks that use the peer connection as a
      source. These two media streams are connected to
      two <code>&lt;video&gt;</code> element sinks (Y and Z).  </p>
            
      <img alt="Changing media stream source effects: before the
      requested change" src="images/change_states_before.png">

      <p>Note that at this moment, all of the sinks on the home client
      must apply a transformation to the original source's provided
      dimension settings. A is scaling the video up (resulting in loss
      of quality), B is scaling the video down, and C is also scaling
      the video up slightly for sending over the network. On the away
      client, sink Y is scaling the video way down, while sink Z is
      not applying any scaling.</p>

      <p>Using the <a class="idlType" href="#idl-def-Constrainable"><code>Constrainable</code></a> interface, the
      home client's video source is changed to a higher resolution
      (1920 by 1200 pixels).</p>

      <img alt="Changing media stream source effects: after the
      requested change" src="images/change_states_after.png">

      <p>Note that the source change immediately affects all of the
      sinks on the home client, but does not impact any of the sinks (or
      sources) on the away client. With the increase in the home
      client source video's dimensions, sink A no longer has to
      perform any scaling, while sink B must scale down even further
      than before.  Sink C (the peer connection) must now scale down
      the video in order to keep the transmission constant to the away
      client.  </p>

      <p>While not shown, an equally valid settings change request
      could be made of the away client video source (the peer
      connection on the away client's side).  This would not only
      impact sink Y and Z in the same manner as before, but would also
      cause re-negotiation with the peer connection on the home client
      in order to alter the transformation that it is applying to the
      home client's video source. Such a change <strong>would
      not</strong> change anything related to sink A or B or the home
      client's video source.  </p>
			
      <p>Note that this specification does not define a
      mechanism by which a change to the away client's video source
      could automatically trigger a change to the home client's
      video source. Implementations may choose to make such
      source-to-sink optimizations as long as they only do so within
      the constraints established by the application, as the next
      example demonstrates.</p>
			
      <p>It is fairly obvious that changes to a given source will
      impact sink consumers. However, in some situations changes to a
      given sink may also be cause for implementations to adjust the
      characteristics of a source's stream. This is illustrated in the
      following figures. In the first figure below, the home client's
      video source is sending a video stream sized at 1920 by 1200
      pixels. The video source is also unconstrained, such that the
      exact source dimensions are flexible as far as the application
      is concerned. Two <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> objects contain
      tracks with the same <code>sourceId</code>, and
      those <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>s are connected to two
      different <code>&lt;video&gt;</code> element sinks A and B. Sink
      A has been sized to <code>width="1920"</code>
      and <code>height="1200"</code> and is displaying the source's
      video content without any transformations. Sink B has been sized
      smaller and, as a result, is scaling the video down to fit its
      rectangle of 320 pixels across by 200 pixels down.</p>

      <img alt="Changing media stream sinks may affect sources:
      before the requested change" src="images/change_states_before2.png">
			
      <p>When the application changes sink A to a smaller dimension
      (from 1920 to 1024 pixels wide and from 1200 to 768 pixels
      tall), the browser's media pipeline may recognize that none of
      its sinks require the higher source resolution, and needless
      work is being done both on the part of the source and on sink
      A. In such a case and without any other constraints forcing the
      source to continue producing the higher resolution video, the
      media pipeline <em title="MAY" class="rfc2119">MAY</em> change the source resolution:</p>
				
      <img alt="Changing media stream sinks may affect sources:
      after the requested change" src="images/change_states_after2.png">
            
      <p>In the above figure, the home client's video source
      resolution was changed to the greater of that from sinkA and
      from sinkB in order to optimize playback. While not shown above,
      the same behavior could apply to peer connections and other
      sinks.</p>

      <p>It is possible that <a class="internalDFN" href="#dfn-constraints">constraints</a> can be applied to a track
      which a source is unable to satisfy. When this happens, the user
      agent is required to fire an <a class="internalDFN" href="#event-mediastreamtrack-overconstrained">overconstrained</a> event to the
      track informing it of this condition, and the track becomes
      muted. There is no mandatory side-effect on the source itself as
      a result of this condition.</p>
 
      <p>When multiple tracks share the same source (as illustrated in
      the previous figures), it is also possible that two (or more)
      tracks can apply contradictory constraints on the source. Since
      there is only a single thread of control, it is always possible
      for the browser to determine which track created the
      overconstrained condition.  In this situation, the user agent
      <em title="MUST" class="rfc2119">MUST</em> send the <a class="internalDFN" href="#event-mediastreamtrack-overconstrained">overconstrained</a> event only to the track that
      created the condition and <em title="MUST" class="rfc2119">MUST</em> not apply any of the constraints
      newly requested for that track.  Here is an example of this
      behavior.</p>

 
      <p>In this example, two media streams each have a video track
      that share the same source. The first track has a mandatory
      constraint forcing on the source's fill light. That track is
      connected to sink N. Sink N has a width and height of 800 by 600
      pixels and is scaling down the source's resolution of 1024 by
      768 to fit. The other track initially has no constraints
      applied; it is connected to sink P. Sink P has a width and
      height equal to that of the source.</p>

      <p><img alt="Overconstrained" src="images/overconstrained_before.png"></p>

      <p>Now, the second track adds a mandatory constraint that the
      fill light should be forced off. At this point, both mandatory
      constraints cannot be satisfied by the source (the fill light
      cannot be simultaneously on and off at the same time). The
      second track is transitioned into the muted state and receives
      an <a class="internalDFN" href="#event-mediastreamtrack-overconstrained">overconstrained</a> event. At the same time, the source notes
      that its remaining active sink only requires a resolution of 800
      by 600 and so it adjusts its resolution down to match (this is
      an optional optimization that the user agent is allowed to make
      given the situation).</p>
 
      <p>At this point, it is the responsibility of the application to
      fix the problem that led to the overconstrained situation (by
      either removing the fill light mandatory constraint on the
      second track, or by changing/removing the fill light mandatory
      constraint on the first track).</p>

      <p><img alt="Overconstrained result" src="images/overconstrained_after.png"></p>

    </section>


    <section id="mediastreams-as-media-elements">
      <!--OddPage--><h2 id="h2_mediastreams-as-media-elements" role="heading" aria-level="1"><span class="secno">6. </span>MediaStreams as Media Elements</h2>

      <p>A <code>MediaStream</code> may be assigned to media elements
      as defined in <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-elements">HTML5</a>
      [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>] A <code>MediaStream</code> is not preloadable or
      seekable and represents a simple, potentially infinite, linear
      media timeline. The timeline starts at 0 and increments linearly
      in real time as long as the <code>MediaStream</code> is
      playing. The timeline does not increment when the
      <code>MediaStream</code> is paused.</p>
     
     <section id="direct-assignment-to-media-elements">
      <h3 id="h3_direct-assignment-to-media-elements" role="heading" aria-level="2"><span class="secno">6.1 </span>Direct Assignment to Media Elements</h3>
      
      <p>UAs that support this specification <em title="MUST" class="rfc2119">MUST</em>
      support the following partial interface, which allows a
      MediaStream to be assigned directly to a media element.  </p>
      	
      <pre class="idl"><span class="idlInterface" id="idl-def-HTMLMediaElement">partial interface <span class="idlInterfaceID">HTMLMediaElement</span> {
<span class="idlAttribute">                attribute <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a>?</span> <span class="idlAttrName"><a href="#widl-HTMLMediaElement-srcObject">srcObject</a></span>;</span>
};</span></pre><section id="attributes-3"><h4 id="h4_attributes-3" role="heading" aria-level="3"><span class="secno">6.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-HTMLMediaElement-srcObject"><code>srcObject</code> of type <span class="idlAttrType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></span>,            , nullable</dt><dd><p>Holds the MediaStream that provides media for this
	  element. This attribute overrides both the <code>src</code>
	  attribute and any &lt;source&gt; elements. Specifically, if
	  <code>srcObject</code> is specified, the UA <em title="MUST" class="rfc2119">MUST</em> use it as
	  the source of media, even if the <code>src</code> attribute
	  is also set or &lt;source&gt; children are present.  If the
	  value of <code>srcObject</code> is replaced or set to null
	  the UA <em title="MUST" class="rfc2119">MUST</em> re-run the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
	  media element load algorithm</a>
        	
        	</p></dd></dl></section> 	

 <div class="issue"><div id="h_issue_1" role="heading" aria-level="3" class="issue-title"><span>Issue 1</span></div><p class=""> We may want to allow direct assignment of other types as well </p></div>
 </section> 
 <section id="loading-and-playing-a-mediastream-in-a-media-element">
 	<h3 id="h3_loading-and-playing-a-mediastream-in-a-media-element" role="heading" aria-level="2"><span class="secno">6.2 </span>Loading and Playing a MediaStream in a Media Element</h3>
      
      <p>The UA runs the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
        media element load algorithm</a> to obtain media for the media
        element to display.  As defined in the [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>]
        specification, this algorithm has two basic phases: <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-algorithm">
        resource selection algorithm</a> chooses the resource to play
        and resolves its URI. Then the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">
        resource fetch phase</a> loads the resource. Both these phases
        are potentially simplified when using a MediaStream.  First of
        all, <code>srcObject</code>
        takes priority over other means of specifying the resource,
        and it provides the object itself rather than a URI.
        Therefore, there is no need to run the resource selection
        algorithm.  Secondly, when the UA reaches the resource fetch
        algorithm with a MediaStream, the MediaStream is a local object so
        there's nothing to fetch.  Therefore, the following
        modifications/restrictions to the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
        media element load algorithm</a> apply: </p>

      <ul>

        <li>
          <p>Whenever the user agent runs the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
          media element load algorithm</a>, if <code>srcObject</code> is
          specified, the UA must immediately go to the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">
          resource fetch phase</a> of the algorithm. </p>
        </li>

        <li>
          <p>Whenever the user agent runs the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
          media element load algorithm</a>, reaches the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">
          resource fetch phase</a> of this algorithm, and determines
          that the media resource in question is a MediaStream, it <em title="MUST" class="rfc2119">MUST</em>
          immediately abort the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-algorithm">
          resource selection algorithm</a>, setting the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">
          <code>media.readyState</code></a> to HAVE_NOTHING if media is
          not yet available and to HAVE_ENOUGH_DATA once it is.</p>
        </li>

        <li>
          <p>For each <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> in the
          <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>, including those that are added after
          the UA enters the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
          media element load algorithm</a>, the UA <em title="MUST" class="rfc2119">MUST</em> create a
          corresponding <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#audiotrack">
          AudioTrack</a></code> or <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#videotrack">
          VideoTrack</a></code> as defined in [<cite><a href="#bib-HTML5" class="bibref">HTML5</a></cite>]. Since the order in
          the <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>'s <a href="#track-set">track set</a> is undefined, no requirements are put how
          the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#audiotracklist">
          AudioTrackList</a></code> and <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#videotracklist">
          VideoTrackList</a></code> are ordered.</p>

          <p>The properties of the <code>AudioTrack</code> and
          <code>VideoTrack</code> objects <em title="MUST" class="rfc2119">MUST</em> be initialized as follows.
          Let</p>

          <ul>
            <li>
              <p><code>AudioTrack.id</code> and <code>VideoTrack.id</code>
              have the value of the corresponding <code><a href="#dom-mediastreamtrack-id">MediaStreamTrack.id</a></code>
              attribute</p>
            </li>

            <li>
              <p><code>AudioTrack.kind</code> and
              <code>VideoTrack.kind</code> be <code>"main"</code>
              </p>
            </li>

            <li>
              <p><code>AudioTrack.label</code> and
              <code>VideoTrack.label</code> have the value of the corresponding
              <code><a href="#dom-mediastreamtrack-label">MediaStreamTrack.label</a></code>
              attribute</p>
            </li>

            <li>
              <p><code>AudioTrack.language</code> and
              <code>VideoTrack.language</code> be the empty string</p>
            </li>

            <li>
              <p><code>AudioTrack.enabled</code> be <code>true</code></p>
            </li>
          </ul>

          <p>Set the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-videotracklist-selectedindex">
          VideoTrackList.selectedIndex</a></code> to the index of the first
          <code>VideoTack</code>, in the <code>VideoTrackList</code>,
          that corresponds to a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> that is
          not <a href="#track-muted">muted</a> or <a href="#track-enabled">disabled</a>. If
          no such <code>VideoTack</code> exists, set the
          <code>selectedIndex</code> attribute to 0.</p>

          <p>(Note that since the
          MediaStream is potentially endless, the UA does not exit the
          <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-element-load-algorithm">
          media element load algorithm</a> until the MediaStream moves
          from the active to the <a href="#stream-inactive">inactive</a> state.)</p>
        </li>

        <li>
          <p>If a <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> is removed from a
          <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>, played by a media element, the
          corresponding <code>AudioTrack</code> or <code>VideoTrack</code> <em title="MUST" class="rfc2119">MUST</em>
          be removed as well.</p>
        </li>

        <li>
          <p>The UA <em title="MUST NOT" class="rfc2119">MUST NOT</em> buffer data from a MediaStream. When
          playing, the UA <em title="MUST" class="rfc2119">MUST</em> always play the current data from the
          stream.</p>
        </li>

        <li>
          <p>When the MediaStream is moves from the active to the
          <a href="#stream-inactive">inactive</a> state, the UA <em title="MUST" class="rfc2119">MUST</em> raise an <a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-ended">ended</a>
          event on the media element and set its <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-ended">ended</a>
          attribute to <code>true</code>. Note that once <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-ended">ended</a>
          equals <code>true</code> the media element will not play media
          even if new Tracks are added to the MediaStream (causing it to
          return to the active state) unless <code>autoplay</code> is <code>true</code> or the JavaScript restarts the
          element, e.g., by calling <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-play">play()</a>.</p>
        </li>
      </ul>
      

      
</section>
<section id="media-element-attributes-when-playing-a-mediastream">
      
      <h3 id="h3_media-element-attributes-when-playing-a-mediastream" role="heading" aria-level="2"><span class="secno">6.3 </span>Media Element Attributes when Playing a MediaStream</h3>

      <p>The nature of the <code>MediaStream</code> places certain restrictions on the
      behavior and attribute values of the associated media element and on the
      operations that can be performed on it, as shown below:</p>
      <table class="simple"><caption>
      Legal values for the properties of a media element bound to a MediaStream</caption>
        <thead>
          <tr>
            <th scope="col">Attribute Name</th>

            <th scope="col">Attribute Type</th>

            <th scope="col">Valid Values When Using a MediaStream</th>

            <th scope="col">Additional considerations</th>
          </tr>
        </thead>

        <tbody>
 
            <tr><td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-currentsrc" class="externalDFN"><code>currentSrc</code></a>
            </td>

            <td><code>DOMString</code></td>

            <td>the empty string</td>

            <td>When <code>srcObject</code> is specified the UA <em title="MUST" class="rfc2119">MUST</em>
            	set this to the empty string. </td>
		
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#attr-media-preload" class="externalDFN"><code>preload</code></a>
            </td>

            <td><code>DOMString</code></td>

            <td><code>none</code></td>

            <td>A MediaStream cannot be preloaded.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-buffered" class="externalDFN"><code>buffered</code></a>
            </td>

            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#timeranges" class="externalDFN"><code>TimeRanges</code></a>
            </td>

            <td><code>buffered.length</code> <em title="MUST" class="rfc2119">MUST</em> return <code>0</code>.</td>

            <td>A MediaStream cannot be preloaded. Therefore, the amount
            buffered is always an empty TimeRange.</td>
          </tr>
                        <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-networkstate" class="externalDFN"><code>networkState</code></a>
            </td>

            <td><code>unsigned short</code></td>

            <td>NETWORK_IDLE	</td>

            <td>The media element does not fetch the MediaStream so there is no network traffic. </td>
          </tr>
              <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate" class="externalDFN"><code>readyState</code></a>
            </td>

            <td><code>unsigned short</code></td>

            <td>HAVE_NOTHING, HAVE_ENOUGH_DATA</td>

            <td>A <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> may be created before there
            is any data available, for example when a stream is received from a
            remote peer. The value of the <code>readyState</code> of
            the media element <em title="MUST" class="rfc2119">MUST</em>
            be HAVE_NOTHING before the first media arrives
            and HAVE_ENOUGH_DATA once the first media has arrived.</td>
          </tr>
          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>
            </td>

            <td><code>double</code></td>

            <td>Any positive integer. The initial value is 0 and the values
            increments linearly in real time whenever the stream is
            playing.</td>

            <td>The value is the current stream position, in seconds. On any
            attempt to set this attribute, the user agent must throw an
            <code>InvalidStateError</code> exception.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-duration" class="externalDFN"><code>duration</code></a>
            </td>

            <td><code>unrestricted double</code></td>

            <td>Infinity</td>

            <td>
              A MediaStream does not have a pre-defined duration.
            </td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-seeking" class="externalDFN"><code>seeking</code></a>
            </td>

            <td><code>boolean</code></td>

            <td>false</td>

            <td>A MediaStream is not seekable. Therefore, this attribute
            <em title="MUST" class="rfc2119">MUST</em> always have the value
            <code>false</code>.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-defaultplaybackrate" class="externalDFN"><code>defaultPlaybackRate</code></a>
            </td>

            <td><code>double</code></td>

            <td>1.0</td>

            <td>A MediaStream is not seekable. Therefore, this attribute
            <em title="MUST" class="rfc2119">MUST</em> always have the value
            <code>1.0</code> and any attempt to alter it <em title="MUST" class="rfc2119">MUST</em> fail.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-playbackrate" class="externalDFN"><code>playbackRate</code></a>
            </td>

            <td><code>double</code></td>

            <td>1.0</td>

            <td>A MediaStream is not seekable. Therefore, this attribute
            <em title="MUST" class="rfc2119">MUST</em> always have the value
            <code>1.0</code> and any attempt to alter it <em title="MUST" class="rfc2119">MUST</em> fail.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-played" class="externalDFN"><code>played</code></a>
            </td>

            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#timeranges" class="externalDFN"><code>TimeRanges</code></a>
            </td>

            <td>
              <code>played.length</code> <em title="MUST" class="rfc2119">MUST</em> return <code>1</code>.<br>
              <code>played.start(0)</code> <em title="MUST" class="rfc2119">MUST</em> return <code>0</code>.<br>
              <code>played.end(0)</code> <em title="MUST" class="rfc2119">MUST</em> return the last known <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.
            </td>

            <td>A MediaStream's timeline always consists of a single range,
            starting at 0 and extending up to the currentTime.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-seekable" class="externalDFN"><code>seekable</code></a>
            </td>

            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#timeranges" class="externalDFN"><code>TimeRanges</code></a>
            </td>

            <td>
              <code>seekable.length</code> <em title="MUST" class="rfc2119">MUST</em> return <code>0</code>.<br>
              <code>seekable.start()</code> <em title="MUST" class="rfc2119">MUST</em> return <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.<br>
              <code>seekable.end()</code> <em title="MUST" class="rfc2119">MUST</em> return <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-currenttime" class="externalDFN"><code>currentTime</code></a>.
            </td>

            <td>A MediaStream is not seekable.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-startdate" class="externalDFN"><code>startDate</code></a>
            </td>

            <td><code>Date</code></td>

            <td>Not-a-Number (NaN)</td>

            <td>A MediaStream does not specify a timeline offset.</td>
          </tr>

          <tr>
            <td>
              <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-loop" class="externalDFN"><code>loop</code></a>
            </td>

            <td><code>boolean</code></td>

            <td>true, false</td>

            <td>Setting the <code>loop</code> attribute has no effect since a
            <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> has no defined end and therefore
            cannot be looped.</td>
          </tr>
          

        </tbody>
      </table>
      	</section>
    </section>

    <section id="event-summary" class="informative">
      <!--OddPage--><h2 id="h2_event-summary" role="heading" aria-level="1"><span class="secno">7. </span>Event summary</h2><p><em>This section is non-normative.</em></p>

      <p>The following event fires on <code>
          <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastream-active">
                <code>active</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> became active (see <a href="#stream-inactive">inactive</a>).</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastream-inactive">
                <code>inactive</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> became <a href="#stream-inactive">inactive</a>.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastream-addtrack"><code>addtrack</code></dfn>
            </td>

            <td>
              <code>
                <a class="idlType" href="#idl-def-MediaStreamTrackEvent"><code>MediaStreamTrackEvent</code></a>
              </code>
            </td>

            <td>A new <code> <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a> </code> has been added to
            this stream. Note that this event is not fired when the script
            directly modifies the tracks of a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>.
          </td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastream-removetrack"><code>removetrack</code>
              </dfn>
            </td>

            <td>
              <code>
                <a class="idlType" href="#idl-def-MediaStreamTrackEvent"><code>MediaStreamTrackEvent</code></a>
              </code>
            </td>

            <td>A <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code> has been removed from
            this stream. Note that this event is not fired when the script
            directly modifies the tracks of a <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code>.
            </td>
          </tr>
        </tbody>
      </table>

      <p>The following event fires on <code>
          <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastreamtrack-started">
                <code>started</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code><a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a></code>
              object has just transitioned from the
              "new" <code><a class="internalDFN" href="#dom-mediastreamtrack-readystate">readyState</a></code> to another state.
              This event fires before any other corresponding events
              such as "ended" or "statechanged".</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtrack-mute">
                <code>mute</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
              </code> object's source is temporarily unable to provide
            data.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtrack-unmute">
                <code>unmute</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
              </code> object's source is live again after having been
            temporarily unable to provide data.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtrack-overconstrained">
                <code>overconstrained</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>
              <p>This event fires asynchronously for each affected
              track (when multiple tracks share the same source) after
              the user agent has evaluated the current constraints
              against a given <code>sourceId</code> and is not
              able to configure the source within the limitations
              established by the union of imposed constraints.</p>

              <p>Due to being over-constrained, the user
              agent must mute each affected track.</p>
              <p>The affected track(s) will remain un-usable (in
              the <code>"muted"</code> <a class="internalDFN" href="#dom-mediastreamtrack-readystate">readyState</a>) until the
              application adjusts the constraints to accommodate the
              source's capabilities.</p>
              <p>The "overconstrained" event is a simple event of
              type <code>Event</code>; it carries no information about
              which constraints caused the source to be
              over-constrained (the application has all the necessary
              APIs to figure it out).</p>
            </td>
          </tr>


          <tr>
            <td>
              <dfn id="event-mediastreamtrack-ended">
                <code>ended</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>
              </code> object's source will no longer provide any data, either
            because the user revoked the permissions, or because the source
            device has been ejected, or because the remote peer stopped
            sending data, or because the <code>
                <a href="#widl-MediaStreamTrack-stop-void">stop()</a>
              </code> method was invoked.</td>
          </tr>
        </tbody>
      </table>
    </section>
  

  <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="enumerating-devices">
    <!--OddPage--><h2 id="h2_enumerating-devices" role="heading" aria-level="1"><span class="secno">8. </span>Enumerating Local Media Devices</h2>

    <p>This section describes an API that the script can use to query the user
    agent about connected media input and output devices.</p>

    <section id="navigatorusermedia">
      <h3 id="h3_navigatorusermedia" role="heading" aria-level="2"><span class="secno">8.1 </span>NavigatorUserMedia</h3>

      <pre class="idl"><span class="idlInterface" id="idl-def-NavigatorUserMedia">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMedia</span> {
<span class="idlMethod">    <span class="idlMethType">void</span> <span class="idlMethName"><a href="#widl-NavigatorUserMedia-getMediaDevices-void-MediaDeviceInfoCallback-resultCallback">getMediaDevices</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaDeviceInfoCallback"><code>MediaDeviceInfoCallback</code></a></span> <span class="idlParamName">resultCallback</span></span>);</span>
};</span></pre><section id="methods-2"><h4 id="h4_methods-2" role="heading" aria-level="3"><span class="secno">8.1.1 </span>Methods</h4><dl class="methods"><dt id="widl-NavigatorUserMedia-getMediaDevices-void-MediaDeviceInfoCallback-resultCallback"><code>getMediaDevices</code></dt><dd>
          <p>Collects information about the user agents available media input
          and output devices; for example a web camera or a headset. The method
          <em title="MUST" class="rfc2119">MUST</em> only return information that the script is authorized to access
          (TODO expand authorized).</p>

          <p>When the <dfn id="dom-navigator-getmediadevices"><code>getMediaDevices()</code></dfn>
          method is called, the user agent must queue a task that runs the
          following steps:</p>

          <ol>
            <li>
              <p>Let <var>resultCallback</var> be the callback indicated by the
              methods first argument.</p>
            </li>

            <li>
              <p>If this method has been called previously within this
              application session, let <var>oldList</var> be the list of
              <code><a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a></code> objects that was produced at
              that call (<var>resultList</var>); otherwise, let
              <var>oldList</var> be an empty list.</p>
            </li>

            <li>
              <p>Let <var>resultList</var> be an empty list.</p>
            </li>

            <li>
              <p>Probe the user agent for available media devices, and run the
              following sub steps for each discovered device,
              <var>device</var>:</p>

              <ol>
                <li>
                  <p>If <var>device</var> is represented by a
                  <code><a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a></code> object in
                  <var>oldList</var>, move that object to
                  <var>resultList</var>, abort these steps and continue with
                  the next device (if any).</p>
                </li>

                <li>
                  <p>Let <var>deviceInfo</var> be a new <code>
                  <a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a></code> object to represent
                  <var>device</var>.</p>
                </li>

                <li>
                  <p>If <var>device</var> belongs to the same physical device
                  as a device, already represented in <var>oldList</var> or
                  <var>resultList</var>, initialize <var>deviceInfo</var>'s
                  <code><a href="#widl-MediaDeviceInfo-groupId">groupId</a>
                  </code> member to the <code><a href="#widl-MediaDeviceInfo-groupId">groupId</a></code> value of
                  the existing <code><a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a></code> object.
                  Otherwise, let <var>deviceInfo</var>'s <code><a href="#widl-MediaDeviceInfo-groupId">groupId</a></code> member be
                  a newly generated unique identifier </p>
                </li>

                <li>
                  <p>Append <var>deviceInfo</var> to <var>resultList</var>.</p>
                </li>
              </ol>
            </li>

            <li>
              <p>Invoke <var>resultCallback</var> with <var>resultList</var> as
              its argument.</p>
            </li>
          </ol>

        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">resultCallback</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code></code></div></dd></dl></section>

      <pre class="idl"><span class="idlImplements">Navigator implements <a class="idlType" href="#idl-def-NavigatorUserMedia"><code>NavigatorUserMedia</code></a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code>Navigator</code> type are defined to also implement the <a class="idlType" href="#idl-def-NavigatorUserMedia"><code>NavigatorUserMedia</code></a> interface.</p></div>
    </section>

    <section id="device-info">
      <h3 id="h3_device-info" role="heading" aria-level="2"><span class="secno">8.2 </span>Device Info</h3>

      <pre class="idl"><span class="idlCallback" id="idl-def-MediaDeviceInfoCallback">callback <span class="idlCallbackID">MediaDeviceInfoCallback</span> = <span class="idlCallbackType">void</span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a>&gt;</span> <span class="idlParamName">deviceInfoList</span></span>);</span></pre><section id="callback-mediadeviceinfocallback-parameters"><h4 id="h4_callback-mediadeviceinfocallback-parameters" role="heading" aria-level="3"><span class="secno">8.2.1 </span>Callback <a href="#idl-def-MediaDeviceInfoCallback" class="idlType"><code>MediaDeviceInfoCallback</code></a> Parameters</h4><dl class="callback-members"><dt id="widl-MediaDeviceInfoCallback-deviceInfoList"><code>deviceInfoList</code> of type <span class="idlMemberType">sequence&lt;<a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a>&gt;</span></dt><dd>A sequence of <code><a class="idlType" href="#idl-def-MediaDeviceInfo"><code>MediaDeviceInfo</code></a></code> objects
        representing the result of a call to <code><a href="#dom-navigator-getmediadevices">Navigator.getMediaDevices()</a></code>
        .</dd></dl></section>

      <div class="note"><div id="h_note_9" role="heading" aria-level="3" class="note-title"><span>Note</span></div><div class="">The old SourceInfo dictionary used to refer to the
      MediaSourceStates dictionary. That dictionary is no longer available when
      Constrainable is introduced. When Constrainable lands, we should see if
      we can align deviceId, kind and label, below, with the new definitions of
      source capabilities.</div></div>

      <pre class="idl"><span class="idlDictionary" id="idl-def-MediaDeviceInfo">dictionary <span class="idlDictionaryID">MediaDeviceInfo</span> {
<span class="idlMember">    <span class="idlMemberType">DOMString</span>       <span class="idlMemberName"><a href="#widl-MediaDeviceInfo-deviceId">deviceId</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a class="idlType" href="#idl-def-MediaDeviceKind"><code>MediaDeviceKind</code></a></span> <span class="idlMemberName"><a href="#widl-MediaDeviceInfo-kind">kind</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>       <span class="idlMemberName"><a href="#widl-MediaDeviceInfo-label">label</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>       <span class="idlMemberName"><a href="#widl-MediaDeviceInfo-groupId">groupId</a></span>;</span>
};</span></pre><section id="dictionary-mediadeviceinfo-members"><h4 id="h4_dictionary-mediadeviceinfo-members" role="heading" aria-level="3"><span class="secno">8.2.2 </span>Dictionary <a href="#idl-def-MediaDeviceInfo" class="idlType"><code>MediaDeviceInfo</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaDeviceInfo-deviceId"><code>deviceId</code> of type <span class="idlMemberType">DOMString</span></dt><dd>
          <p>The unique id for the represented device.</p>
        </dd><dt id="widl-MediaDeviceInfo-groupId"><code>groupId</code> of type <span class="idlMemberType">DOMString</span></dt><dd>
          <p>Returns the group identifier of the represented device. Two
          devices has the same group identifier if they belong to the same
          physical device; for example a headset.</p>
        </dd><dt id="widl-MediaDeviceInfo-kind"><code>kind</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-MediaDeviceKind"><code>MediaDeviceKind</code></a></span></dt><dd>
          <p>Describes the kind of the represented device.</p>
        </dd><dt id="widl-MediaDeviceInfo-label"><code>label</code> of type <span class="idlMemberType">DOMString</span></dt><dd>
          <p>A label describing this device (for example "External USB
          Webcam"). If the device has no associated label, then this dictionary
          member <em title="MUST" class="rfc2119">MUST</em> return the empty string.</p>
        </dd></dl></section>

      <pre class="idl"><span class="idlEnum" id="idl-def-MediaDeviceKind">enum <span class="idlEnumID">MediaDeviceKind</span> {
    "<a href="#idl-def-MediaDeviceKind.audioinput" class="idlEnumItem">audioinput</a>",
    "<a href="#idl-def-MediaDeviceKind.audiooutput" class="idlEnumItem">audiooutput</a>",
    "<a href="#idl-def-MediaDeviceKind.videoinput" class="idlEnumItem">videoinput</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-MediaDeviceKind.audioinput">audioinput</code></td><td>
          <p>Represents an audio input device; for example a microphone.</p>
        </td></tr><tr><td><code id="idl-def-MediaDeviceKind.audiooutput">audiooutput</code></td><td>
          <p>Represents an audio output device; for example a pair of
          headphones.</p>
        </td></tr><tr><td><code id="idl-def-MediaDeviceKind.videoinput">videoinput</code></td><td>
          <p>Represents a video input device; for example a webcam.</p>
        </td></tr></tbody></table>

    </section>

  </section>

  <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="local-content">
    <!--OddPage--><h2 id="h2_local-content" role="heading" aria-level="1"><span class="secno">9. </span>Obtaining local multimedia content</h2>

    <section id="navigatorusermedia-1">
      <h3 id="h3_navigatorusermedia-1" role="heading" aria-level="2"><span class="secno">9.1 </span>NavigatorUserMedia</h3>

      <pre class="idl"><span class="idlInterface" id="idl-def-NavigatorUserMedia-1">partial interface <span class="idlInterfaceID">NavigatorUserMedia</span> {
<span class="idlMethod">    <span class="idlMethType">void</span> <span class="idlMethName"><a href="#widl-NavigatorUserMedia-getUserMedia-void-MediaStreamConstraints-constraints-NavigatorUserMediaSuccessCallback-successCallback-NavigatorUserMediaErrorCallback-errorCallback">getUserMedia</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStreamConstraints"><code>MediaStreamConstraints</code></a>?</span> <span class="idlParamName">constraints</span></span>, <span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-NavigatorUserMediaSuccessCallback"><code>NavigatorUserMediaSuccessCallback</code></a></span> <span class="idlParamName">successCallback</span></span>, <span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-NavigatorUserMediaErrorCallback"><code>NavigatorUserMediaErrorCallback</code></a></span> <span class="idlParamName">errorCallback</span></span>);</span>
};</span></pre><section id="methods-3"><h4 id="h4_methods-3" role="heading" aria-level="3"><span class="secno">9.1.1 </span>Methods</h4><dl class="methods"><dt id="widl-NavigatorUserMedia-getUserMedia-void-MediaStreamConstraints-constraints-NavigatorUserMediaSuccessCallback-successCallback-NavigatorUserMediaErrorCallback-errorCallback"><code>getUserMedia</code></dt><dd>
          <p>Prompts the user for permission to use their Web cam or other
          video or audio input.</p>

          <div class="issue"><div id="h_issue_2" role="heading" aria-level="4" class="issue-title"><span>Issue 2</span></div><p class="">The syntax for getUserMedia() is still
          under discussion.  Some questions are: whether it creates
          media streams or just initializes ones already created;
          whether it creates streams synchronously (immediate return
          of MediaStream with callback later when user grants
          permission) or asynchronously (MediaStream available only
          upon callback).</p></div>

          <p>The <var>constraints</var> argument is an object of type
          <code><a class="idlType" href="#idl-def-MediaStreamConstraints"><code>MediaStreamConstraints</code></a></code>.</p>

          <p>The <var>successCallback</var> will be invoked with a suitable
          <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object as its argument if the
          user accepts valid tracks as described below.</p>

          <p>The <var>errorCallback</var> will be invoked if there is
          a failure in finding valid tracks or if the user denies permission,
          both as described below.</p>

          <p>When the <dfn id="dom-navigator-getusermedia"><code>getUserMedia()</code></dfn> method
          is called, the user agent <em title="MUST" class="rfc2119">MUST</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>constraints</var> be the method's first argument.</p>
            </li>

            <li>
              <p>Let <var>successCallback</var> be the callback indicated by
              the method's second argument.</p>
            </li>

            <li>
              <p>Let <var>errorCallback</var> be the callback indicated by the
              method's third argument.</p>
            </li>

            <li>
              <p>Let <var>requestedMediaTypes</var> be the set of media types
              in <var>constraints</var> with either a dictionary value or a
              value of "true".</p>
            </li>

            <li>
              <p>If <var>requestedMediaTypes</var> is the empty set, let
              <var>error</var> be a new
              <code><a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></code> object whose
              <code>name</code> attribute has the value
              <code>NotSupportedError</code> and jump to the step labeled
              <em>Error Task</em> below.</p>
            </li>

            <li>
              <p>Let <var>finalSet</var> be an (initially) empty set.</p>
            </li>

            <li>
              <p>If <var>successCallback</var> is null, abort these steps.</p>
            </li><!-- we could throw an exception instead (that's
   why the method doesn't return until later: so that we can add an
   exception here, or for /options/ below, without changing the
   algorithm) -->
            <!--
            <li>
              <p>For each member of the <code><a>MediaStreamOptions</a></code>
              dictionary create a local representation and set it to false.</p>
            </li>

            <li>
              <p>For each property in <var>options</var> that is present and
              set to true, let the corresponding local representation be
              true.</p>
            </li>

            <li>
              <p>If none of the local representations of the
              <code><a>MediaStreamOptions</a></code> dictionary members is set
              to true, then throw a <code>NOT_SUPPORTED_ERR</code> exception
              and abort these steps.</p>
            </li>
-->

            <li>
              <p>For each media type <var>T</var> in
              <var>requestedMediaTypes</var>,</p>

              <ol>
                <li>
                  <p>Let <var>candidateSet</var> be all possible tracks of
                  media type <var>T</var> that the browser could return.</p>
                </li>

                <li>If the value of the <var>T</var> entry of
                <var>constraints</var> is "true", jump to the step labeled
                <em>final</em> below. Otherwise, continue.</li>

                <li>
                  <p>For each constraint key-value pair in the "mandatory"
                  dictionary,</p>

                  <ol>
                    <li>
                      <p>If the constraint is not supported by the browser,
                      jump to the step labeled <em>Constraint Failure</em>
                      below.</p>
                    </li>

                    <li>
                      <p>Remove from the <var>candidateSet</var> any track that
                      cannot satisfy the value given for the constraint.</p>
                    </li>

                    <li>
                      <p>If the <var>candidateSet</var> no longer contains at
                      least one track, jump to the step labeled
                      <em>Constraint Failure</em> below. Otherwise, continue
                      with the next mandatory constraint.</p>
                    </li>
                  </ol>
                </li>

                <li>
                  <p>Let the <var>secondPassSet</var> be the current contents
                  of the <var>candidateSet</var>.</p>
                </li>

                <li>
                  <p>For each constraint key-value pair in the "optional"
                  sequence of the <var>constraints</var> that are for the
                  current media type, in order,</p>

                  <ol>
                    <li>
                      <p>If the constraint is not supported by the browser,
                      skip it and continue with the next constraint.</p>
                    </li>

                    <li>
                      <p>Remove from the <var>secondPassSet</var> any tracks
                      that cannot satisfy the value given for the
                      constraint.</p>
                    </li>

                    <li>
                      <p>If the <var>secondPassSet</var> is now empty, let the
                      <var>secondPassSet</var> be the current contents of the
                      <var>candidateSet</var>. Otherwise, let the
                      <var>candidateSet</var> be the current contents of the
                      <var>secondPassSet</var>.</p>
                    </li>
                  </ol>
                </li>

                <li>
                  <p><em>Final:</em> Add the tracks in the
                  <var>candidateSet</var> to the <var>finalSet</var>.</p>
                </li>
              </ol>
            </li>

            <li>
              <p>Return, and run the remaining steps asynchronously.</p>
            </li>

            <li>
              <p>Optionally, e.g., based on a previously-established user
              preference, for security reasons, or due to platform limitations,
              jump to the step labeled <em>Permission Failure</em> below.</p>
            </li>

            <li>
              <p>Prompt the user in a user agent specific manner for permission
              to provide the entry script's origin with a
              <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object representing a media
              stream.</p>

              <p>The provided media <em title="MUST" class="rfc2119">MUST</em> include precisely one track of each
              media type in requestedMediaTypes from the <var>finalSet</var>.
              The decision of which tracks to choose from the
              <var>finalSet</var> is completely up to the user agent and may be
              determined by asking the user. Unless and until a new set of
              constraints is provided, the user agent <em title="MAY" class="rfc2119">MAY</em> change its choice of
              track at any point, provided that 1) the new choice does not
              violate given user permissions, and 2) it notifies the
              application code by raising an event. It may wish to do this, for
              example, if the user interface or network congestion changes. Note
              that no such change will have an effect on the presence or absence
              of each type of track, merely the contents.</p>

              <div class="issue"><div id="h_issue_3" role="heading" aria-level="4" class="issue-title"><span>Issue 3</span></div><p class="">Define the event that should be raised when the
              user agent changes its choice of track.</p></div>

              <p>User agents are encouraged to default to using the user's
              primary or system default camera and/or microphone (when
              possible) to generate the media stream. User agents <em title="MAY" class="rfc2119">MAY</em> allow
              users to use any media source, including pre-recorded media
              files.</p>

              <p>If the user grants permission to use local recording devices,
              user agents are encouraged to include a prominent indicator that
              the devices are "hot" (i.e. an "on-air" or "recording"
              indicator).</p>

              <p>If the user denies permission, jump to the step labeled
              <em>Constraint Failure</em> below. If the user never responds, this
              algorithm stalls on this step.</p>
            </li>

            <li>
              <p>Let <var>stream</var> be the
              <code><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></code> object for which the user
              granted permission.</p>
            </li>

            <li>
              <p>Queue a task to invoke <var>successCallback</var> with
              <var>stream</var> as its argument.</p>
            </li>

            <li>
              <p>Abort these steps.</p>
            </li>

            <li>
              <p><em>Permission Failure</em>: Let <var>error</var> be a new
              <code><a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></code> object whose
              <code>name</code> attribute has the value
              <code>PermissionDeniedError</code> and jump to the step
              labeled <em>Error Task</em> below.</p>
            </li>

            <li>
              <p><em>Constraint Failure</em>: Let <var>error</var> be a new
              <code><a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></code> object whose
              <code>name</code> attribute has the value
              <code>ConstraintNotSatisfiedError</code> and whose
              <code><a href="#widl-NavigatorUserMediaError-constraintName">constraintName</a></code> attribute is set to the name of the
              constraint that caused the error.</p>
            </li>

            <li>
              <p><em>Error Task:</em> Queue a task to invoke
              <var>errorCallback</var> with <var>error</var> as its argument.
              </p>
            </li>

            <li style="list-style: none; display: inline">
              <p>The task source for these <span title="concept-task">tasks</span> is the user interaction task
              source.</p>
            </li>
          
        </ol><table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">constraints</td><td class="prmType"><code></code></td><td class="prmNullTrue"><span role="img" aria-label="True">✔</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr><tr><td class="prmName">successCallback</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr><tr><td class="prmName">errorCallback</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr></tbody></table><div><em>Return type: </em><code></code></div></dd></dl></section>
    </section>

    <section id="mediastreamconstraints">
      <h3 id="h3_mediastreamconstraints" role="heading" aria-level="2"><span class="secno">9.2 </span>MediaStreamConstraints</h3>
      <p>The <code>MediaStreamConstraints</code> dictionary is used to instruct
      	the UA what sort of <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>s to include in the <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a>
      	returned by <a class="internalDFN" href="#dom-navigator-getusermedia">getUserMedia()</a>. </p>

      <pre class="idl"><span class="idlDictionary" id="idl-def-MediaStreamConstraints">dictionary <span class="idlDictionaryID">MediaStreamConstraints</span> {
<span class="idlMember">    <span class="idlMemberType">(boolean or <a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a>)</span> <span class="idlMemberName"><a href="#widl-MediaStreamConstraints-video">video</a></span> = <span class="idlMemberValue">false</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(boolean or <a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a>)</span> <span class="idlMemberName"><a href="#widl-MediaStreamConstraints-audio">audio</a></span> = <span class="idlMemberValue">false</span>;</span>
};</span></pre><section id="dictionary-mediastreamconstraints-members"><h4 id="h4_dictionary-mediastreamconstraints-members" role="heading" aria-level="3"><span class="secno">9.2.1 </span>Dictionary <a href="#idl-def-MediaStreamConstraints" class="idlType"><code>MediaStreamConstraints</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamConstraints-audio"><code>audio</code> of type <span class="idlMemberType">(boolean or Constraints)</span>, defaulting to <code>false</code></dt><dd>
           <p>If <code>true</code>, it requests that the returned <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a> 
          	contain an audio track. If a <a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a> structure is provided,
          	it further specifies the nature and settings of the audio Track.  If
          	<code>false</code>, the <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a> <em title="MUST" class="rfc2119">MUST</em> not contain an audio
          	Track.</p>
        </dd><dt id="widl-MediaStreamConstraints-video"><code>video</code> of type <span class="idlMemberType">(boolean or Constraints)</span>, defaulting to <code>false</code></dt><dd>
          <p>If <code>true</code>, it requests that the returned <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a> 
          	contain a video track. If a <a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a> structure is provided,
          	it further specifies the nature and settings of the video Track.  If
          	<code>false</code>, the <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a> <em title="MUST" class="rfc2119">MUST</em> not contain a video
          	Track.</p>
        </dd></dl></section>

 

    </section>

    <section id="navigatorusermediasuccesscallback">
      <h3 id="h3_navigatorusermediasuccesscallback" role="heading" aria-level="2"><span class="secno">9.3 </span>NavigatorUserMediaSuccessCallback</h3>

      <pre class="idl"><span class="idlCallback" id="idl-def-NavigatorUserMediaSuccessCallback">callback <span class="idlCallbackID">NavigatorUserMediaSuccessCallback</span> = <span class="idlCallbackType">void</span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>);</span></pre><section id="callback-navigatorusermediasuccesscallback-parameters"><h4 id="h4_callback-navigatorusermediasuccesscallback-parameters" role="heading" aria-level="3"><span class="secno">9.3.1 </span>Callback <a href="#idl-def-NavigatorUserMediaSuccessCallback" class="idlType"><code>NavigatorUserMediaSuccessCallback</code></a> Parameters</h4><dl class="callback-members"><dt id="widl-NavigatorUserMediaSuccessCallback-stream"><code>stream</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a></span></dt><dd><div class="issue"><div id="h_issue_4" role="heading" aria-level="4" class="issue-title"><span>Issue 4</span></div><p class="">Add explanation of handleEvent</p></div></dd></dl></section>
    </section>

    <section id="navigatorusermediaerror-and-navigatorusermediaerrorcallback">
      <h3 id="h3_navigatorusermediaerror-and-navigatorusermediaerrorcallback" role="heading" aria-level="2"><span class="secno">9.4 </span>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</h3>

      <pre class="idl"><span class="idlInterface" id="idl-def-NavigatorUserMediaError">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMediaError</span> : <span class="idlSuperclass">DOMError</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString?</span> <span class="idlAttrName"><a href="#widl-NavigatorUserMediaError-constraintName">constraintName</a></span>;</span>
};</span></pre><section id="attributes-4"><h4 id="h4_attributes-4" role="heading" aria-level="3"><span class="secno">9.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-NavigatorUserMediaError-constraintName"><code>constraintName</code> of type <span class="idlAttrType">DOMString</span>, readonly   , nullable</dt><dd>
            <p>This attribute is only used for some types of errors. For <code>
            <a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></code> with a name of
            <code>ConstraintNotSatisfiedError</code>, this attribute <em title="MUST" class="rfc2119">MUST</em> be set
            to the name of the constraint that caused the error.</p>
        </dd></dl></section>

      <div class="note"><div id="h_note_10" role="heading" aria-level="3" class="note-title"><span>Note</span></div><div class="">
        <p>Ask the DOM team to extend their list with the following errors.</p>

        <ul>
          <li>PermissionDeniedError: User denied permission for scripts from
          this origin to access the media device.</li>

          <li>ConstraintNotSatisfiedError: One of the mandatory constraints
          could not be satisfied.</li>
        </ul>
      </div></div>
            
      <pre class="idl"><span class="idlCallback" id="idl-def-NavigatorUserMediaErrorCallback">callback <span class="idlCallbackID">NavigatorUserMediaErrorCallback</span> = <span class="idlCallbackType">void</span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></span> <span class="idlParamName">error</span></span>);</span></pre><section id="callback-navigatorusermediaerrorcallback-parameters"><h4 id="h4_callback-navigatorusermediaerrorcallback-parameters" role="heading" aria-level="3"><span class="secno">9.4.2 </span>Callback <a href="#idl-def-NavigatorUserMediaErrorCallback" class="idlType"><code>NavigatorUserMediaErrorCallback</code></a> Parameters</h4><dl class="callback-members"><dt id="widl-NavigatorUserMediaErrorCallback-error"><code>error</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></span></dt><dd><div class="issue"><div id="h_issue_5" role="heading" aria-level="4" class="issue-title"><span>Issue 5</span></div><p class="">Add explanation of handleEvent</p></div></dd></dl></section>
    </section>

    <section id="implementation-suggestions" class="informative">
      <h3 id="h3_implementation-suggestions" role="heading" aria-level="2"><span class="secno">9.5 </span>Implementation Suggestions</h3><p><em>This section is non-normative.</em></p>

      <div class="practice">
        <span id="resource-reservation" class="practicelab">Best Practice 1: Resource
        reservation</span>

        <p class="practicedesc">The user agent is encouraged to reserve
        resources when it has determined that a given call to <a href="#dom-navigator-getusermedia">getUserMedia()</a> will succeed. It is
        preferable to reserve the resource prior to invoking the success
        callback provided by the web page. Subsequent calls to <a href="#dom-navigator-getusermedia">getUserMedia()</a> (in this page or any
        other) should treat the resource that was previously allocated, as well
        as resources held by other applications, as busy. Resources marked as
        busy should not be provided as sources to the current web page, unless
        specified by the user. Optionally, the user agent may choose to provide
        a stream sourced from a busy source but only to a page whose origin
        matches the owner of the original stream that is keeping the source
        busy.</p>

        <p class="practicedesc">This document recommends that in the permission
        grant dialog or device selection interace (if one is present), the user
        be allowed to select any available hardware as a source for the stream
        requested by the page (provided the resource is able to fulfill
        mandatory constraints, if any were specified), in addition to the
        ability to substitute a video or audio source with local files and
        other media. A file picker may be used to provide this functionality to
        the user.</p>

        <p class="practicedesc">This document also recommends that the user be
        shown all resources that are currently busy as a result of prior calls
        to <a href="#dom-navigator-getusermedia">getUserMedia()</a> (in this
        page or any other page that is still alive) and be allowed to terminate
        that stream and utilize the resource for the current page instead. If
        possible in the current operating environment, it is also suggested
        that resources currently held by other applications be presented and
        treated in the same manner. If the user chooses this option, the track
        corresponding to the resource that was provided to the page whose
        stream was affected must be removed.</p>
      </div>

      <div class="practice">
        <span id="handling-devices" class="practicelab">Best Practice 2: Handling multiple
        devices</span>

        <p class="practicedesc">A <a class="idlType" href="#idl-def-MediaStream"><code>MediaStream</code></a> may contain more than one
        video and audio track. This makes it possible to include video from two
        or more webcams in a single stream object, for example. However, the
        current API does not allow a page to express a need for multiple video
        streams from independent sources.</p>

        <p class="practicedesc">It is recommended for multiple
        calls to <a href="#dom-navigator-getusermedia">getUserMedia()</a> from
        the same page be allowed as a way for pages to request multiple,
        discrete, video or audio streams.</p>

        <p class="practicedesc">A single call to
        <a href="#dom-navigator-getusermedia">getUserMedia()</a> will always
        return a stream with either zero or one audio tracks, and either zero or
        one video tracks. If a script calls
        <a href="#dom-navigator-getusermedia">getUserMedia()</a> multiple times
        before reaching a stable state, this document advises the UI designer
        that the permission dialogs should be merged, so that the user can give
        permission for the use of multiple cameras and/or media sources in one
        dialog interaction. The constraints on each getUserMedia call can be
        used to decide which stream gets which media sources.</p>
      </div>
    </section>
  </section>
 <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="constrainable-interface">
  	 <!--OddPage--><h2 id="h2_constrainable-interface" role="heading" aria-level="1"><span class="secno">10. </span>Constrainable Interface</h2>
  	 <p>The Constrainable interface allows its consumers to inspect
  	 	and adjust the properties of the object that implements it. It is
  	 	broken out as a separate partial interface so that it can be used in
  	 	other specifications.  The core concept is that of a Capability,
  	 	which consists of a property or feature of an object and the set of its possible values, which
  	 	 may be specified either as a range or as an enumeration. For example,
  	 	 a camera might be capable of framerates (a property) between 20 and 50 frames
  	 	 per second (a range) and may be able to be positioned (a property) facing towards
  	 	 the user, away from the user, or to the left or right of the user
  	 	 (an enumerated set.)  The application can examine a Constrainable object's
  	 	 set of Capabilities via the <code>capabilities</code> attribute.</p>
  	 	 <p>The application can select the (range of) values it wants for a
  	 	 	Capability by means of a Constraint and the <code>applyConstraints()</code>
  	 	 	method.  A Constraint consists of the name of the property,
  	 	 	plus the desired value (or a range of desired values.)  For example,
  	 	 	the application may set a Constraint stating that the framerate of a camera
  	 	 	be between 30 and 40 frames per second (a range) or that it wants the camera to be
  	 	 	facing the user (a specific value).  Constraints can be mandatory or optional. 
  	 	 	In the case of optional Constraints, the UA <em title="MUST" class="rfc2119">MUST</em> consider the
  	 	 	Constraints in the order in which they are specified, and <em title="MUST" class="rfc2119">MUST</em> try to
  	 	 	satisfy each one, but <em title="MAY" class="rfc2119">MAY</em> ignore
  	 	 	a Constraint if it cannot satisfy it.  In the case of mandatory Constraints,
  	 	 	the <em title="MUST" class="rfc2119">MUST</em> try to satisfy all of them, and <em title="MUST" class="rfc2119">MUST</em> call the <code>errorCallback</code>
  	 	 	if it cannot do so.  For example, suppose that an application applies
  	 	 	three Constraints, stating that the video aspect ratio should be 3 to 2
  	 	 	(height to width), that the height should be 600 and that the width
  	 	 	should  be 500.  Since these constraints interact with each other (the aspect
  	 	 	ratio affects the possible values for height and width, and vice-versa) it is impossible to satisfy all three
  	 	 	constraints, so if all the Constraints are mandatory, the UA will call the
  	 	 	<code>errorCallback</code>.  However if any one of the
  	 	 	Constraints is optional, the other two can be satisified, so the UA
  	 	 	will satisfy the two mandatory ones, silently ignore the optional one,
  	 	 	and call the <code>successCallback.</code>
  	 	</p>
  	 	<p>The ordering of optional constraints is significant.  In the example
  	 		in the previous paragraph, suppose that aspect ratio constraint
  	 		is mandatory and that the height and width constraints are optional.
  	 		If the height constraint is specified first, then it will be satisfied
  	 		and the width constraint will be ignored.  Thus the height will be set to 600
  	 		and the the width will be set to 400.  On the other hand, if width is specified before height, the width
  	 		constraint will be satisfied and the height constraint will be ignored,
  	 		resulting in width of 500 and height of 750.  (Note that the mandatory
  	 		aspect ratio constraint is enforced in both cases.)  The UA will attempt
  	 		to satisfy as many optional constraints as it can, even if some of them cannot
  	 		be satisfied and must therefore be ignored.  Application authors can therefore
  	 		implement a backoff strategy by specifying multiple optional constraints
  	 		for the same property.  For example, an application might specify
  	 		three optional constraints, the first asking for a framerate greater than
  	 		500, the second asking for a framerate greater than 400, and the third
  	 		asking for one greater than 300.  If the UA is capable of setting a framerate
  	 		greater than 500, it will (and the subsequent two constraints will be trivially
  	 		satisifed.)  However, if the UA cannot set the framerate above 500, it will
  	 		ignore that constraint and attempt to set the framerate above 400. If that fails,
  	 		it will then try to set it above 300.  If the UA cannot satisfy any of the
  	 		three constraints, it will set the framerate to any value it can get.  If the
  	 		developer wanted to insist on 300 as a lower bound, he could make that a mandatory
  	 		constraint.  In that case, the UA would fail altogether if it couldn't get
  	 		a value over 300, but would choose a value over 500 if possible, then
  	 		try for a value over 400.  
  	 	 	An application may inspect the set of Constraints currently in effect
  	 	 	via the <code>constraints</code> attribute. </p>
  	 	 		<p>The specific value that the UA chooses for a Capability is
  	 	 			referred to as a Setting.  For example, if the application applies
  	 	 			a Constraint that the framerate must be at least 30 frames per second,
  	 	 			and no greater than 40, the Setting can be any intermediate value, e.g.,
  	 	 			32, 35, or 37 frames per second.  The application can query the current
  	 	 			settings of the object's Capabilities via the <code>settings</code> attribute.</p>
    	 <section id="interface-definition-1">
  	 	<h3 id="h3_interface-definition-1" role="heading" aria-level="2"><span class="secno">10.1 </span>Interface Definition</h3>
  	 	     <pre class="idl"><span class="idlInterface" id="idl-def-Constrainable">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">Constrainable</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a class="internalDFN" href="#dfn-capabilities">Capabilities</a></span> <span class="idlAttrName"><a href="#widl-Constrainable-capabilities">capabilities()</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span>  <span class="idlAttrName"><a href="#widl-Constrainable-constraints">constraints</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">Settings</span>     <span class="idlAttrName"><a href="#widl-Constrainable-settings">settings</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span> <span class="idlAttrName"><a href="#widl-Constrainable-onoverconstrained">onoverconstrained</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">void</span> <span class="idlMethName"><a href="#widl-Constrainable-applyConstraints-void-Constraints-constraints-VoidFunction-successCallback-ConstraintErrorCallback-errorCallback">applyConstraints</a></span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span> <span class="idlParamName">constraints</span></span>, <span class="idlParam"><span class="idlParamType">VoidFunction</span> <span class="idlParamName">successCallback</span></span>, <span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-ConstraintErrorCallback"><code>ConstraintErrorCallback</code></a></span> <span class="idlParamName">errorCallback</span></span>);</span>
};</span></pre><section id="attributes-5"><h4 id="h4_attributes-5" role="heading" aria-level="3"><span class="secno">10.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Constrainable-capabilities"><code>capabilities()</code> of type <span class="idlAttrType"><a class="internalDFN" href="#dfn-capabilities">Capabilities</a></span>, readonly   </dt><dd>
            <p>Contains the dictionary of the capabilities that the object
            	supports. Note that it is possible that the underlying hardware       
             may not
            exactly map to the range defined in the specification.  In this
            case, an
            implementation <em title="should" class="rfc2119">should</em> make a reasonable attempt to
            translate and scale the hardware's setting onto the mapping
            provided by the relevant specification. </p>

            <div class="note"><div id="h_note_11" role="heading" aria-level="4" class="note-title"><span>Note</span></div><div class="">
              <p>An example of the user agent providing an alternative
              mapping: if a source supports a hypothetical fluxCapacitance
              capability that is defined to be the range
              from -10 (min) to 10 (max), but the source's (hardware
              setting) for fluxCapacitance only supports values of "off"
              "medium" and "full", then the user agent should map the
              range value of -10 to "off", 10 should map to "full", and
              0 should map to "medium". Constraints imposing a strict
              value of 3 will cause the user agent to attempt to set the
              value of "medium" on the hardware, and return a
              fluxCapacitance  of 0, the closest supported
              setting. No error event is raised in this
              scenario.</p>
            </div></div>
            <div class="issue"><div id="h_issue_6" role="heading" aria-level="4" class="issue-title"><span>Issue 6</span></div><div class="">What about the case where the object uses
            	the same units as the specification, but supports only a sub-range
            	of the specified values?  What about an object whose fluxCapacitance
            	range is only -5 to 5?  Should it map those to -10 to 10, or leave
            	them as they are?   </div></div>

          </dd><dt id="widl-Constrainable-constraints"><code>constraints</code> of type <span class="idlAttrType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span>, readonly   </dt><dd>
          <p>Contains all the <code>Constraints</code> that were  
          	applied to the object in the last succesfull call of <code>applyConstraints()</code>. 
          	The list <em title="MUST" class="rfc2119">MUST</em> contain only the constraints that were successfully applied,
          	and <em title="MUST" class="rfc2119">MUST</em> maintain the order that they were specified in. </p>

          <p>If no mandatory constraints have been defined,
          the <code>mandatory</code> field will not be present (it will be
          undefined). If no optional constraints have been defined,
          the <code>optional</code> field will not be present (it will be
          undefined). If neither optional nor mandatory constraints have been
          created, the value will be <code>null</code>.</p>
        
        </dd><dt id="widl-Constrainable-onoverconstrained"><code>onoverconstrained</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>This event handler, of type <code><a href="#event-constrainable-overconstrained">overconstrained</a></code>, <em title="MUST" class="rfc2119">MUST</em>
        be supported by all objects implementing the <code>
        <a class="idlType" href="#idl-def-Constrainable"><code>Constrainable</code></a></code> interface.  The UA <em title="MUST" class="rfc2119">MUST</em> raise the 
        	<code>overconstrained</code> event if changing circumstances at runtime
        	result in the currently valid mandatory constraints no longer being satisfied.
        	The conditions under which this might happen are platform- and application-specific.
        	For example, the user might physically manipulate a camera in a way that
        	made it impossible to provide a resolution that satisified the constraints.  
        	</dd><dt id="widl-Constrainable-settings"><code>settings</code> of type <span class="idlAttrType">Settings</span>, readonly   </dt><dd>
            Contains the current settings of all the properties
            of the object, whether they are platform defaults or have been
            set by <code>applyConstraints()</code>.  Note that the actual setting
            of a property <em title="MUST" class="rfc2119">MUST</em> be a single value.
          </dd></dl></section><section id="methods-4"><h4 id="h4_methods-4" role="heading" aria-level="3"><span class="secno">10.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-Constrainable-applyConstraints-void-Constraints-constraints-VoidFunction-successCallback-ConstraintErrorCallback-errorCallback"><code>applyConstraints</code></dt><dd>
          
          <p>The algorithm for applying constraints is stated below.
          	Here are some preliminary definitions that are used in the
          	statement of the algorithm:
          	</p><ul> 
          		<li>
          	A sequence of values for the properties of an object O satisfy
          	 constraint set C if each value a) is in the set of supported values specified by the corresponding
          	Capability of O, and b) is in the set specified by any constraints
          	in C that apply to that property, and c) there is no constraint in C that
          	does not correspond to a Capability in O. (Note that although this definition ignores
          	the difference between mandatory and optional constraints, the algorithm
          	below distinguishes between them.) </li>
          	<li> A set of constraints C can be satisifed
          	by an object O if it is possible to choose a sequence of values for the
          	properties of O that satisfy  C. </li>
          	<li>To apply a set of constraints
          	C to object O is to choose such a sequence of values that satisfy C and assign them as the 
          	settings for the properties of O.   </li>
          	</ul> 
          <p>When <code>applyConstraints</code> is called, the UA <em title="MUST" class="rfc2119">MUST</em> queue a task
          to run the following steps:</p>
          <ol>
          
          	<li>let <var>desiredContraints</var> be the argument to this function.
          		Each constraint <em title="MUST" class="rfc2119">MUST</em> specify one or more values (or a range of values)
          		for its property.  
          		A property <em title="MAY" class="rfc2119">MAY</em> appear more than once in the list of optional constraints.</li>
          			<li>Let <var>newConstraints</var> be an initially empty set
          			of constraints</li>
          		<li>Let <var>object</var> be the Constrainable object on which 
          			this method was called.  Let <var>copy</var> be an unconstrained copy of 
          			<var>object</var> (i.e., <var>copy</var> should behave
          			as if it were <var>object</var> with all constraints removed.) </li>
          	<li>If the mandatory constraints in <var>desiredConstraints</var> is
          		cannot be satisifed by <var>copy</var>, call the <code>errorCallback</code>, passing 
          		it a list of the mandatory constraints that could not be
          satisfied, and return. (Note that there may be more than one way of selecting
          the set of constraints that were not satisfied.)  <code>existingConstraints</code> remain
          in effect on <var>object</var> in this case.
          		</li>
          		<li>Otherwise add the mandatory constraints to <var>newConstraints</var></li>
          		<li>Iterate over the optional constraints in <var>desiredConstraints</var>
          			in the order in which they were specified.  For each constraint,if it and <var>newConstraints</var> together can be satisfied
          			by <var>copy</var>, add it to <var>newConstraints</var>.
          			Otherwise, ignore it. </li>
          			
          	<li>In a single operation, remove all existing constraints from <var>object</var>,
          		apply <var>newConstraints</var>, set the value of the <code>constraints</code>
          		attribute to <var>newConstraints</var>, and fire the <code>successCallback</code>
          		passing it <var>newConstraints</var> as its argument. Note: the UA
          		<em title="MAY" class="rfc2119">MAY</em> modify the  values of one or more properties of <var>object</var>
          		at any time, as long as the resulting set of values satisfy the current set of
          		constraints.  
          		  </li>
          	</ol>
          	
         
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">constraints</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">A new constraint structure to apply to this object.</td></tr><tr><td class="prmName">successCallback</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">Called if all mandatory constraints can be satisfied.</td></tr><tr><td class="prmName">errorCallback</td><td class="prmType"><code></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">Called if one or more mandatory constraints cannot be satisified.</td></tr></tbody></table><div><em>Return type: </em><code></code></div></dd></dl></section>
  <section id="applyconstraints-failure-callback">
  	<h4 id="h4_applyconstraints-failure-callback" role="heading" aria-level="3"><span class="secno">10.1.3 </span>applyConstraints Failure Callback</h4>
      <section>

  	<section>
  	<h6 role="heading" aria-level="5" id="constrainterror">ConstraintError</h6>
 <pre class="idl"><span class="idlInterface" id="idl-def-ConstraintError">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">ConstraintError</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span> <span class="idlAttrName"><a href="#widl-ConstraintError-constraintNames">constraintNames</a></span>;</span>
};</span></pre><section><h6 role="heading" aria-level="6" id="attributes-6">Attributes</h6><dl class="attributes"><dt id="widl-ConstraintError-constraintNames"><code>constraintNames</code> of type <span class="idlAttrType"><a class="idlType" href="#idl-def-Constraints"><code>Constraints</code></a></span>, readonly   </dt><dd>Contains the set of mandatory constraints that could not
          	be satisified. The <code>optional</code> field in this 
          	object will be undefined.</dd></dl></section>
      </section>
      <section>
<h6 role="heading" aria-level="5" id="constrainterrorcallback">ConstraintErrorCallback</h6>      
<pre class="idl"><span class="idlCallback" id="idl-def-ConstraintErrorCallback">callback <span class="idlCallbackID">ConstraintErrorCallback</span> = <span class="idlCallbackType">void</span> (<span class="idlParam"><span class="idlParamType"><a class="idlType" href="#idl-def-ConstraintError"><code>ConstraintError</code></a></span> <span class="idlParamName">error</span></span>);</span></pre><section><h6 role="heading" aria-level="6" id="callback-constrainterrorcallback-parameters">Callback <a href="#idl-def-ConstraintErrorCallback" class="idlType"><code>ConstraintErrorCallback</code></a> Parameters</h6><dl class="callback-members"><dt id="widl-ConstraintErrorCallback-error"><code>error</code> of type <span class="idlMemberType"><a class="idlType" href="#idl-def-ConstraintError"><code>ConstraintError</code></a></span></dt><dd>An object holding the mandatory constraints that could not be satisfied.</dd></dl></section>
      
  </section>
</section>     
      </section>
      
            <div class="note"><div id="h_note_12" role="heading" aria-level="3" class="note-title"><span>Note</span></div><div class="">
        <p>Here is an example of Constraints that could  be passed into
        	<code>applyConstraints()</code> or returned as a value
        	of <code><a class="internalDFN" href="#dfn-constraints">constraints</a></code>. It uses the properties defined
        	in <a href="#sec-track-properties">the Track property registry</a>, below:</p>
 
<pre>{
  <code>mandatory</code>: {
    width: { min: 640 },
    height: { min: 480 }
  },
  <code>optional</code>: [
    { width: 650 },
    { width: { min: 650 }},
    { frameRate: 60 },
    { width: { max: 800 }},
    { facingMode: "user" }
  ]
}                                
</pre>
      </div></div>

    <section id="capabilities-constraints-and-settings">
      <h4 id="h4_capabilities-constraints-and-settings" role="heading" aria-level="3"><span class="secno">10.1.4 </span>Capabilities, Constraints, and Settings</h4>
      
      <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="registry">
      	<h5 id="h5_registry" role="heading" aria-level="4"><span class="secno">10.1.4.1 </span>The Property Registry</h5>
      	<p>For each class/interface that implements Constrainable, there <em title="MUST" class="rfc2119">MUST</em> be a 
      		corresponding registry that defines the constrainable properties of that class
      		of object.  The registry entries <em title="MUST" class="rfc2119">MUST</em> contain the name of each property along
      		with its set of legal values.  The registry for MediaStreamTrack is defined
      		<a href="#sec-constraints"> below</a>.
      		The syntax for the specification of
      		the set of legal values depends on the type of the values.  In addition
      		to the standard atomic types (boolean, int, float, DOMString), legal values
      		include lists of any of the atomic types, plus min-max ranges, as 
      		defined below: </p>
 <section id="propertyvaluerange">     
 	   <h6 id="h6_propertyvaluerange" role="heading" aria-level="5"><span class="secno">10.1.4.1.1 </span>PropertyValueRange</h6>		
        <pre class="idl"><span class="idlDictionary" id="idl-def-PropertyValueRange">dictionary <span class="idlDictionaryID">PropertyValueRange</span> {
<span class="idlMember">    <span class="idlMemberType">any</span> <span class="idlMemberName"><a href="#widl-PropertyValueRange-max">max</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType">any</span> <span class="idlMemberName"><a href="#widl-PropertyValueRange-min">min</a></span>;</span>
};</span></pre><section id="dictionary-propertyvaluerange-members"><h6 id="h6_dictionary-propertyvaluerange-members" role="heading" aria-level="6"><span class="secno">10.1.4.1.1.1 </span>Dictionary <a href="#idl-def-PropertyValueRange" class="idlType"><code>PropertyValueRange</code></a> Members</h6><dl class="dictionary-members"><dt id="widl-PropertyValueRange-max"><code>max</code> of type <span class="idlMemberType">any</span></dt><dd>The maximum legal value of this property. 
          <p>The type of this value is specific to the object
          	and property in question.</p>
        
        </dd><dt id="widl-PropertyValueRange-min"><code>min</code> of type <span class="idlMemberType">any</span></dt><dd>The minimum value of this Property. 
          <p>The type of this value is specific to the object
          	and property in question.</p>
   
        </dd></dl></section></section>
  
   	
   	<div class="issue"><div id="h_issue_7" role="heading" aria-level="5" class="issue-title"><span>Issue 7</span></div><div class="">
   		<p>Should we allow registries to define new or different syntaxes for
   			capabilities?  For example could a registry introduce a new Capability
   			that had a min, a max, and a step value?</p></div></div>
      	</section>
      	
      	 <div class="issue"><div id="h_issue_8" role="heading" aria-level="4" class="issue-title"><span>Issue 8</span></div><div class="">
   	<p>Should we allow the use of multiple registries?  For example, a spec
   		might define a registry of Capabilities, and an implementation might
   		define extensions.  In that case, we could think of the implementation as
   		having its own registry, and the final set of Capabilities as being the 
   		union of the two.</p>
   	</div></div>
      
      <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="capabilities">
      	<h5 id="h5_capabilities" role="heading" aria-level="4"><span class="secno">10.1.4.2 </span>Capabilities</h5>
      	  <p> Capabilities a dictionary containing one or 
       	more key-value pairs, where each key <em title="MUST" class="rfc2119">MUST</em> be a constrainable property
       	defined in the associated registry, and each value <em title="SHOULD" class="rfc2119">SHOULD</em> be a subset
       	of the set of values defined for that property in the registry.  The exact syntax of the
       	value expression depends on the type of the property.  The Capabilities
       	dictionary specifies the subset of the 
       	constrainable properties and values from the registry that the UA supports. 
       	Note that a UA <em title="MAY" class="rfc2119">MAY</em> support only a subset of the properties 
       	that are defined in the registry,  and
       	<em title="MAY" class="rfc2119">MAY</em> support a subset of the set values for those properties that it does support.  
  </p>   	
      	</section>
      	
     <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="settings">
     	<h5 id="h5_settings" role="heading" aria-level="4"><span class="secno">10.1.4.3 </span>Settings</h5></section>
   <p>  		Settings is a dictionary containing one or more key-value pairs.  It 
   	<em title="MUST" class="rfc2119">MUST</em> contain each key returned in <code>capabilities()</code>.  There <em title="MUST" class="rfc2119">MUST</em>
   	be a single value for each key and the value <em title="MUST" class="rfc2119">MUST</em> a member of the set defined
   	for that property by <code>capabilities()</code>.  Thus the <code>Settings</code> 
    dictionary contains the actual values that the UA has chosen for the object's Capabilities.
  </p>   		
     <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="constraints">
     	<h5 id="h5_constraints" role="heading" aria-level="4"><span class="secno">10.1.4.4 </span>Constraints</h5>
     		
     		  <pre class="idl"><span class="idlDictionary" id="idl-def-Constraints">dictionary <span class="idlDictionaryID">Constraints</span> {
<span class="idlMember">    <span class="idlMemberType">ConstraintSet?</span> <span class="idlMemberName"><a href="#widl-Constraints-mandatory">mandatory</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType">Constraint[]</span>   <span class="idlMemberName"><a href="#widl-Constraints-optional">optional</a></span>;</span>
};</span></pre><section id="dictionary-constraints-members"><h6 id="h6_dictionary-constraints-members" role="heading" aria-level="5"><span class="secno">10.1.4.4.1 </span>Dictionary <a href="#idl-def-Constraints" class="idlType"><code>Constraints</code></a> Members</h6><dl class="dictionary-members"><dt id="widl-Constraints-mandatory"><code>mandatory</code> of type <span class="idlMemberType">ConstraintSet</span>, nullable</dt><dd>
          <p>The set of Constraints that the UA <em title="MUST" class="rfc2119">MUST</em> satisfy or else
          	call the <code>errorCallback</code>.  Note that a given property
          	name may occur only once in this set.</p>
        </dd><dt id="widl-Constraints-optional"><code>optional</code> of type array of <span class="idlMemberType">Constraint</span></dt><dd>
          <p>The set of Constraints that the UA <em title="SHOULD" class="rfc2119">SHOULD</em> try to satisfy
          	but <em title="MAY" class="rfc2119">MAY</em> ignore if they cannot be satisified.  The order
          	of these constraints is significant.  In particular, when they are passed
          	as an argument to <code>applyConstraints</code>, the UA <em title="MUST" class="rfc2119">MUST</em>
          	try to satisfy them in the order that is specified.  Thus
          	if optional constraints C1 and C2 can be satisfied individually, but
          	not together, then whichever of C1 and C2 is first in this list
          	will be satisfied, and the other will not. The UA <em title="MUST" class="rfc2119">MUST</em> attempt
          	to satisfy all optional constraints in the list, even if some
          	cannot be satisfied. Thus, in the preceeding example, if 
          	optional constraint C3 is specified after C1 and C2, the UA will 
          	attempt to satisfy C3 even though C2 cannot be satisified. 
          	Note that a given property name may occur multiple times in this set. </p>
        </dd></dl></section>


       <p>Each entry in the <a href="constraintset">ConstraintSet</a>
       	and <a href="constraint">Constraint</a> dictionaries 
       	corresponds to a property
       	and specifies a subset of its legal values.  Applying a constraint
       	instructs that UA to restrict the setting of the corresponding Capability to that
       	value or range of values.  A given property <em title="MAY" class="rfc2119">MAY</em> occur both 
       	in the mandatory and the optional constraints list, and <em title="MAY" class="rfc2119">MAY</em> occur
       	more than once in the optional constraints list.</p>
  
 
 <section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="constraintset"> 
 	<h6 id="h6_constraintset" role="heading" aria-level="5"><span class="secno">10.1.4.4.2 </span>ConstraintSet</h6>   
      <p> 	
       	A ConstraintSet is a dictionary containing one or 
        more key-value pairs, where each key is expected to be a constrainable property
       	defined in the associated registry, and each value <em title="SHOULD" class="rfc2119">SHOULD</em> be a subset
       	of the set of values defined for that property in the registry.  The exact syntax of the
       	value expression depends on the type of the property.
       	 	</p>
</section>

<section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="constraint">
	<h6 id="h6_constraint" role="heading" aria-level="5"><span class="secno">10.1.4.4.3 </span>Constraint</h6>
<p>
A Constraint is a dictionary containing exactly one 
key-value pair, where the key is expected to  be a constrainable property
       	defined in the associated registry, and the value <em title="SHOULD" class="rfc2119">SHOULD</em> be a subset
       	of the set of values defined for that property in the registry.  The exact syntax of the
       	value expression depends on the type of the property.
</p>
</section>
</section>  
</section>
 </section>	
</section>
      
 
  <section id="examples">
    <!--OddPage--><h2 id="h2_examples" role="heading" aria-level="1"><span class="secno">11. </span>Examples</h2>

    <div>
      <p>This sample code exposes a button. When clicked, the button is
      disabled and the user is prompted to offer a stream. The user can cause
      the button to be re-enabled by providing a stream (e.g., giving the page
      access to the local camera) and then disabling the stream (e.g., revoking
      that access).</p>
      <div class="example"><div class="example-title"><span>Example 1</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Start"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">start</span><span class="pun">()</span><span class="atv">"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"startBtn"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;script&gt;</span><span class="pln">
 </span><span class="kwd">var</span><span class="pln"> startBtn </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'startBtn'</span><span class="pun">);</span><span class="pln">
 </span><span class="kwd">function</span><span class="pln"> start</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   navigator</span><span class="pun">.</span><span class="pln">getUserMedia</span><span class="pun">({</span><span class="pln">audio</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> video</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> gotStream</span><span class="pun">,</span><span class="pln"> logError</span><span class="pun">);</span><span class="pln">
   startBtn</span><span class="pun">.</span><span class="pln">disabled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
 </span><span class="pun">}</span><span class="pln">
 </span><span class="kwd">function</span><span class="pln"> gotStream</span><span class="pun">(</span><span class="pln">stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   stream</span><span class="pun">.</span><span class="pln">oninactive </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
     startBtn</span><span class="pun">.</span><span class="pln">disabled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
   </span><span class="pun">};</span><span class="pln">
 </span><span class="pun">}</span><span class="pln">
 </span><span class="kwd">function</span><span class="pln"> logError</span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   log</span><span class="pun">(</span><span class="pln">error</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">": "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> error</span><span class="pun">.</span><span class="pln">message</span><span class="pun">);</span><span class="pln">
 </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln"> </span></pre></div>
    </div><!-- Put back when we define MediaStreamRecorder
    <div>
      <p>This example allows people to record a short audio message and upload
      it to the server. This example even shows rudimentary error handling.</p>
      <pre class='example sh_javascript'>
&lt;input type="button" value="⚫" onclick="msgRecord()" id="recBtn"&gt;
&lt;input type="button" value="◼" onclick="msgStop()" id="stopBtn" disabled&gt;
&lt;p id="status"&gt;To start recording, press the ⚫ button.&lt;/p&gt;
&lt;script&gt;
 var recBtn = document.getElementById('recBtn');
 var stopBtn = document.getElementById('stopBtn');
 function report(s) {
   document.getElementById('status').textContent = s;
 }
 function msgRecord() {
   report('Attempting to access microphone...');
   navigator.getUserMedia({audio:true}, gotStream, noStream);
   recBtn.disabled = true;
 }
 var msgStream, msgStreamRecorder;
 function gotStream(stream) {
   report('Recording... To stop, press to ◼ button.');
   msgStream = stream;
   msgStreamRecorder = stream.record();
   stopBtn.disabled = false;
   stream.oninactive = function () {
     msgStop();     
   }
 }
 function msgStop() {
   report('Creating file...');
   stopBtn.disabled = true;
   msgStream.oninactive = null;
   msgStream.stop();
   msgStreamRecorder.getRecordedData(msgSave);
 }
 function msgSave(blob) {
   report('Uploading file...');
   var x = new XMLHttpRequest();
   x.open('POST', 'uploadMessage');
   x.send(blob);
   x.onload = function () {
     report('Done! To record a new message, press the ⚫ button.');
     recBtn.disabled = false;
   };
   x.onerror = function () {
     report('Failed to upload message. To try recording a message again, press the ⚫ button.');
     recBtn.disabled = false;
   };
 }
 function noStream() {
   report('Could not obtain access to your microphone. To try again, press the ⚫ button.');
   recBtn.disabled = false;
 }
&lt;/script&gt;
</pre>
    </div>-->

    <div>
      <p>This example allows people to take photos of themselves from
      the local video camera.  Note that the forthcoming Image Capture
      specification may provide a simpler way to accomplish this.</p>
      <div class="example"><div class="example-title"><span>Example 2</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;article&gt;</span><span class="pln">
 </span><span class="tag">&lt;style</span><span class="pln"> </span><span class="atn">scoped</span><span class="tag">&gt;</span><span class="pln">
  video </span><span class="pun">{</span><span class="pln"> transform</span><span class="pun">:</span><span class="pln"> scaleX</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  p </span><span class="pun">{</span><span class="pln"> text</span><span class="pun">-</span><span class="pln">align</span><span class="pun">:</span><span class="pln"> center</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
 </span><span class="tag">&lt;/style&gt;</span><span class="pln">
 </span><span class="tag">&lt;h1&gt;</span><span class="pln">Snapshot Kiosk</span><span class="tag">&lt;/h1&gt;</span><span class="pln">
 </span><span class="tag">&lt;section</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"splash"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"errorMessage"</span><span class="tag">&gt;</span><span class="pln">Loading...</span><span class="tag">&lt;/p&gt;</span><span class="pln">
 </span><span class="tag">&lt;/section&gt;</span><span class="pln">
 </span><span class="tag">&lt;section</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"app"</span><span class="pln"> </span><span class="atn">hidden</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;p&gt;&lt;video</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"monitor"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="tag">&gt;&lt;/video&gt;</span><span class="pln"> </span><span class="tag">&lt;canvas</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"photo"</span><span class="tag">&gt;&lt;/canvas&gt;</span><span class="pln">
  </span><span class="tag">&lt;p&gt;&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">button</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"&amp;#x1F4F7;"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">snapshot</span><span class="pun">()</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
 </span><span class="tag">&lt;/section&gt;</span><span class="pln">
 </span><span class="tag">&lt;script&gt;</span><span class="pln">
  navigator</span><span class="pun">.</span><span class="pln">getUserMedia</span><span class="pun">({</span><span class="pln">video</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> gotStream</span><span class="pun">,</span><span class="pln"> noStream</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'monitor'</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> canvas </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'photo'</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> gotStream</span><span class="pun">(</span><span class="pln">stream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    video</span><span class="pun">.</span><span class="pln">srcObject </span><span class="pun">=</span><span class="pln"> stream</span><span class="pun">;</span><span class="pln">
    stream</span><span class="pun">.</span><span class="pln">oninactive </span><span class="pun">=</span><span class="pln"> noStream</span><span class="pun">;</span><span class="pln">
    video</span><span class="pun">.</span><span class="pln">onloadedmetadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      canvas</span><span class="pun">.</span><span class="pln">width </span><span class="pun">=</span><span class="pln"> video</span><span class="pun">.</span><span class="pln">videoWidth</span><span class="pun">;</span><span class="pln">
      canvas</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> video</span><span class="pun">.</span><span class="pln">videoHeight</span><span class="pun">;</span><span class="pln">
      document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'splash'</span><span class="pun">).</span><span class="pln">hidden </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
      document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'app'</span><span class="pun">).</span><span class="pln">hidden </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> noStream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">'errorMessage'</span><span class="pun">).</span><span class="pln">textContent </span><span class="pun">=</span><span class="pln"> </span><span class="str">'No camera available.'</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> snapshot</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    canvas</span><span class="pun">.</span><span class="pln">getContext</span><span class="pun">(</span><span class="str">'2d'</span><span class="pun">).</span><span class="pln">drawImage</span><span class="pun">(</span><span class="pln">video</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
 </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/article&gt;</span></pre></div>
    </div>
  </section>

  <section id="iana-registrations" rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter">
    <!--OddPage--><h2 role="heading" aria-level="1" id="sec-iana"><span class="secno">12. </span>IANA Registrations</h2>

    <section id="track-property-registrations" rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter">
      <h3 role="heading" aria-level="2" id="sec-track-properties"><span class="secno">12.1 </span>Track Property Registrations</h3>

      <p>IANA is requested to register the following properties as specified
      in [<cite><a href="#bib-RTCWEB-CONSTRAINTS" class="bibref">RTCWEB-CONSTRAINTS</a></cite>]:</p>

      <div class="note"><div id="h_note_13" role="heading" aria-level="3" class="note-title"><span>Note</span></div><div class="">

        <p><strong>Note: </strong>The definitions for "noaccess" and
        "peerIdentity" are proposals under discussion, which may result in
        considerable modification. The other constraints listed are thought to
        be stable.</p>
        
      </div></div>
 
      <p>The following constraint names are defined to apply to both <code><a class="idlType" href="#idl-def-VideoStreamTrack"><code>VideoStreamTrack</code></a></code> and <code><a class="idlType" href="#idl-def-AudioStreamTrack"><code>AudioStreamTrack</code></a></code> objects:</p>

      <table class="simple">
        <thead>
          <tr>
            <th>Property Name</th>
            <th>Values</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr id="def-constraint-sourceType">
            <td>sourceType</td>
            <td><a class="idlType" href="#idl-def-SourceTypeEnum"><code>SourceTypeEnum</code></a></td>
            <td>the type of the source of the <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a>.</td>
          </tr>
          <tr id="def-constraint-sourceId">
            <td>sourceId</td>
            <td>DOMString</td>
            <td>The application-unique identifier for this source.  The same identifier <em title="MUST" class="rfc2119">MUST</em> be valid between sessions of this application, but <em title="MUST" class="rfc2119">MUST</em> also be different for other applications.  Some sort of GUID is recommended for the identifier.</td>
          </tr>

          <tr id="def-constraint-noaccess">
            <td>noaccess</td>
            <td>boolean</td>
            <td>Whether the <a class="idlType" href="#idl-def-MediaStreamTrack"><code>MediaStreamTrack</code></a> can be applied to an element which is readable by the JS.</td>
          </tr>

          <tr id="def-constraint-peerIdentity">
            <td>peerIdentity</td>
            <td>DOMString</td>
            <td>Whether the stream can applied to an element which is readable by the JS. Require that any PeerConnections to which the stream is added match the provided identity.</td>
          </tr>

        </tbody>
      </table>

      <p>The following properties are defined to apply only to <code><a class="idlType" href="#idl-def-VideoStreamTrack"><code>VideoStreamTrack</code></a></code> objects:</p>

      <table class="simple">
        <thead>
          <tr>
            <th>Property Name</th>
            <th>Values</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr id="def-constraint-width">
            <td>width</td>
            <td><a class="idlType" href="#idl-def-PropertyValueRange"><code>PropertyValueRange</code></a> of unsigned longs.
            </td>
            <td>The width or width range, in pixels, of the video
            source.  As a capability, the range should span the video
            source's pre-set width values with min being the smallest
            width and max being the largest width.</td>
          </tr>
          <tr id="def-constraint-height">
            <td>height</td>
            <td><a class="idlType" href="#idl-def-PropertyValueRange"><code>PropertyValueRange</code></a> of unsigned longs</td>
            <td>The height or height range, in pixels, of the video
            source.  As a capability, the range should span the video
            source's pre-set height values with min being the smallest
            height and max being the largest height.</td>
          </tr>
          <tr id="def-constraint-frameRate">
            <td>frameRate</td>
            <td><a class="idlType" href="#idl-def-PropertyValueRange"><code>PropertyValueRange</code></a> of floats</td>
            <td>The exact desired frame rate (frames per second) or
            frameRate range of the video source.  If the source does
            not natively provide a frameRate, or the frameRate cannot
            be determined from the source stream, then this value <em title="MUST" class="rfc2119">MUST</em>
            refer to the user agent's vsync display rate.</td>
          </tr>
          <tr id="def-constraint-aspect">
            <td>aspectRatio</td>
            <td><a class="idlType" href="#idl-def-PropertyValueRange"><code>PropertyValueRange</code></a> of flotas</td>
            <td>The exact aspect ratio (width in pixels divided
            by height in pixels), represented as a floating point
            number rounded to the tenth decimal place.</td>
          </tr>
          <tr id="def-constraint-facingMode">
            <td>facingMode</td>
            <td><code>list of <a class="idlType" href="#idl-def-VideoFacingModeEnum"><code>VideoFacingModeEnum</code></a></code></td>
            <td>The members of the enum describe the directions that the camera can face, as seen from the user's perspective.</td>
          </tr>
        </tbody>
      </table>
      <pre class="idl"><span class="idlEnum" id="idl-def-VideoFacingModeEnum">enum <span class="idlEnumID">VideoFacingModeEnum</span> {
    "<a href="#idl-def-VideoFacingModeEnum.user" class="idlEnumItem">user</a>",
    "<a href="#idl-def-VideoFacingModeEnum.environment" class="idlEnumItem">environment</a>",
    "<a href="#idl-def-VideoFacingModeEnum.left" class="idlEnumItem">left</a>",
    "<a href="#idl-def-VideoFacingModeEnum.right" class="idlEnumItem">right</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-VideoFacingModeEnum.user">user</code></td><td>The source is facing toward the user (a self-view camera).</td></tr><tr><td><code id="idl-def-VideoFacingModeEnum.environment">environment</code></td><td>The source is facing away from the user (viewing the
          environment).</td></tr><tr><td><code id="idl-def-VideoFacingModeEnum.left">left</code></td><td>The source is facing to the left of the user.</td></tr><tr><td><code id="idl-def-VideoFacingModeEnum.right">right</code></td><td>The source is facing to the right of the user.</td></tr></tbody></table>
      <p>The following properties are defined to apply only to <code><a class="idlType" href="#idl-def-AudioStreamTrack"><code>AudioStreamTrack</code></a></code> objects:</p>
                
      <table class="simple">
        <thead>
          <tr>
            <th>Property Name</th>
            <th>Values</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr id="def-constraint-volume">
            <td>volume</td>
            <td> <a class="idlType" href="#idl-def-PropertyValueRange"><code>PropertyValueRange</code></a> of unsigned longs</td>
            <td>The volume or volume range of the audio source, as a percentage.  A volume of 0 is silence, while a volume of 100 is the maximum supported volume.</td>
          </tr>
        </tbody>
      </table>

 

      <dl>
                
                <!-- please leaves this just commented out in the file for now - Cullen

      <dt> EchoCancelation </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> When one or more audio streams is being played in the proceses of
        varios microphones, it is often desirable to attempt to remove the sound
        being played from the input signals recorded by the microphones. This is
        referred to echo cancelation. There are cases where it is not needed and
        it is desirable to turn it off so that no audio artifacts are
        introduced. This constraint allows the application to control this
        behavior. </p>
      </dd>

      <dt> CaptureAudio </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture audio input from a
        microphone. </p>
      </dd>

      <dt> CaptureVideo </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture video input from a
        camera. </p>
      </dd>

      <dt> CaptureImage </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "true". </p>

        <p> Indicates that application would like to capture an single image from a
        camera. </p>
      </dd>


        <dt> EnableSecureMedia </dt>

      <dd> <p> This is a enum type constraint that can take the values "true"
        and "false". The default is a non mandatory "false". </p>

        <p> Indicates that application would like the browser to keep the media
        secure. This means that the media will not be a available to JavaScript
        application but is useful for cases where other objects will operate on
        the media stream. For some trusted application environments, the browser
        may enforce that this constraint is a mandatory "true". </p> </dd>

      -->
      </dl>
    </section>
  </section>

  <section id="change-log">
    <!--OddPage--><h2 id="h2_change-log" role="heading" aria-level="1"><span class="secno">13. </span>Change Log</h2>

    <p>This section will be removed before publication.</p>


      <!--
    <h2>To Do Items</h2>

    <p>-</p>
    -->

    <h2 id="changes-since-october-17-2013">Changes since October 17, 2013</h2>

    <ol>
      <li>Bug 23263: Add output device enumeration to GetSources</li>

      <li>Introduced the Constrainable interface.</li>

      <li> Change consensus note on constraints in IANA section. </li>
      <li>Removed createObjectURL.</li>
     
      <li>Bug 22209: Should not use <em title="MUST" class="rfc2119">MUST</em> requirements on values provided by the
      developer.</li>
    </ol>

    <h2 id="changes-since-august-24-2013">Changes since August 24, 2013</h2>

    <ol>
      <li>Bug 22269: Renamed getSourceInfos() to getSources() and made the
      result async.</li>

      <li>Bug 22229: Editorial input</li>

      <li>Bug 22243: Clarify readonly track</li>

      <li>Bug 22259: Disabled mediastreamtrack and state of media element</li>

      <li>Bug 22226: Remove check of same source from MediaStream constructor
      algorithm</li>

      <li>Replaced ended with inactive for MediaStream (resolves bug 21618).
      </li>

      <li>Bug 22264: MediaStream.ended set to true on creation</li>

      <li>Bug 22272: Permission revokation via MediaStreamTrack.stop()</li>

      <li>Bug 22248: Relationship between MediaStreamTrack and HTML5
      VideoTrack/AudioTrack after MediaStream assignment</li>

      <li>Bug 22247: Setting loop attribute on a media element reading from a
      MediaStream</li>
    </ol>

    <h2 id="changes-since-july-4-2013">Changes since July 4, 2013</h2>

    <ol>
      <li>Bug 21967: Added paragraph on MediaStreamTrack enabled state and
      updated cloning algorithm.</li>

      <li>Bug 22210: Make getUserMedia() algorithm use all numbered items.</li>

      <li>Bug 22250: Fixed accidentally overridden error.</li>

      <li>Bug 22211: Added async error when no valid media type is requested.

      </li><li>Bug 22216: Made NavigatorUserMediaError extend DOMError.</li>

      <li>Bug 22249: Throw on attempts to set currentTime on media elements
      playing MediaStream objects.</li>

      <li>Bug 22246: Made media.buffered have length 0.</li>

      <li>Bug 22692: Updated media element to use HAVE_NOTHING state
      before media arrives on the played MediaStream and
      HAVE_ENOUGH_DATA as soon as media arrives.</li>
    </ol>

    <h2 id="may-29-2013">May 29, 2013</h2>

    <ol>
      <li>Bug 22252: fixed usage of <em title="MUST" class="rfc2119">MUST</em> in MediaStream() constructor
      description.</li>

      <li>Bug 22215: made MediaStream.ended readonly.</li>

      <li>Bug 21967: clarified MediaStreamTrack.enabled state initial value.
      </li>

      <li>Added aspectRatio constraint, capability, and state.</li>
      <li>Updated usage of MediaStreams in media elements.</li>
    </ol>

    <h2 id="may-15-2013">May 15, 2013</h2>

    <ol>
      <li>Added explanatory section for constraints, capabilities, and
      states.</li>
      <li>Added VideoFacingModeEnum (including left and right options).</li>
      <li>Added getSourceInfos() and SourceInfo dictionary.</li>
      <li>Added isolated streams.</li>
    </ol>

    <h2 id="april-29-2013">April 29, 2013</h2>

    <ol>
      <li>Removed remaining photo APIs and references (since we have a
      separate Image Capture Spec).</li>
    </ol>

    <h2 id="march-20-2013">March 20, 2013</h2>

    <ol>
      <li> Added readonly and remote attributes to MediaStreamTrack</li>
      <li> Removed getConstraint(), setConstraint(), appendConstraint(), and prependConstraint().</li>
      <li> Added source states.  Added states() method on tracks.  Moved sourceType and sourceId to be states.</li>
      <li> Added source capabilities.  Added capabilities() method on tracks.</li>
      <li>Added clarifying text about MediaStreamTrack lifecycle and mediaflow.</li>
      <li>Made MediaStreamTrack cloning explicit.</li>
      <li>Removed takePhoto() and friends from VideoStreamTrack (we have a
      separate Image Capture Spec).</li>
      <li>Made getUserMedia() error callback mandatory.</li>
    </ol>


    <h2 id="december-12-2012">December 12, 2012</h2>

    <ol>
      <li> Changed error code to be string instead of number.</li>
      <li> Added core of settings proposal allowing for constraint changes after stream/track creation.</li>
    </ol>

    
    <h2 id="november-15-2012">November 15 2012</h2>

    <ol>
      <li>Introduced new representation of tracks in a stream
      (removed MediaStreamTrackList).</li>

      <li>Updated MediaStreamTrack.readyState to use an enum type (instad of
      unsigned short constants).</li>

      <li>Renamed MediaStream.label to MediaStream.id (the definition needs
      some more work).</li>
    </ol>

    <h2 id="october-1-2012">October 1 2012</h2>

    <ol>
      <li>Limited the track kind values to "audio" and "video" only (could
      previously be user defined as well).</li>

      <li>Made MediaStream extend EventTarget.</li>

      <li>Simplified the MediaStream constructor.</li>
    </ol>

    <h2 id="june-23-2012">June 23 2012</h2>

    <ol>
      <li>Rename title to "Media Capture and Streams".</li>

      <li>Update document to comply with HTML5.</li>

      <li>Update image describing a MediaStream.</li>

      <li>Add known issues and various other editorial changes.</li>
    </ol>

    <h2 id="june-22-2012">June 22 2012</h2>

    <ol>
      <li>Update wording for constraints algorithm.</li>
    </ol>

    <h2 id="june-19-2012">June 19 2012</h2>

    <ol>
      <li>Added "Media Streams as Media Elements section".</li>
    </ol>

    <h2 id="june-12-2012">June 12 2012</h2>

    <ol>
      <li>Switch to respec v3.</li>
    </ol>

    <h2 id="june-5-2012">June 5 2012</h2>

    <ol>
      <li>Added non-normative section "Implementation Suggestions".</li>

      <li>Removed stray whitespace.</li>
    </ol>

    <h2 id="june-1-2012">June 1 2012</h2>

    <ol>
      <li>Added media constraint algorithm.</li>
    </ol>

    <h2 id="apr-23-2012">Apr 23 2012</h2>

    <ol>
      <li>Remove MediaStreamRecorder.</li>
    </ol>

    <h2 id="apr-20-2012">Apr 20 2012</h2>

    <ol>
      <li>Add definitions of MediaStreams and related objects.</li>
    </ol>

    <h2 id="dec-21-2011">Dec 21 2011</h2>

    <ol>
      <li>Changed to make wanted media opt in (rather than opt out). Minor
      edits.</li>
    </ol>

    <h2 id="nov-29-2011">Nov 29 2011</h2>

    <ol>
      <li>Changed examples to use MediaStreamOptions objects rather than
      strings. Minor edits.</li>
    </ol>

    <h2 id="nov-15-2011">Nov 15 2011</h2>

    <ol>
      <li>Removed MediaStream stuff. Refers to webrtc 1.0 spec for that part
      instead.</li>
    </ol>

    <h2 id="nov-9-2011">Nov 9 2011</h2>

    <ol>
      <li>Created first version by copying the webrtc spec and ripping out
      stuff. Put it on github.</li>
    </ol>
  </section>

  <section id="acknowledgements" class="appendix">
    <!--OddPage--><h2 id="h2_acknowledgements" role="heading" aria-level="1"><span class="secno">A. </span>Acknowledgements</h2>
  </section>
x

<section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="references" class="appendix"><!--OddPage--><h2 id="h2_references" role="heading" aria-level="1"><span class="secno">B. </span>References</h2><section rel="bibo:Chapter" resource="#ref" typeof="bibo:Chapter" id="normative-references"><h3 id="h3_normative-references" role="heading" aria-level="2"><span class="secno">B.1 </span>Normative references</h3><dl about="" class="bibliography"><dt id="bib-HTML5">[HTML5]</dt><dd rel="dcterms:requires">Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Edward O'Connor; Silvia Pfeiffer. <a href="http://www.w3.org/TR/html5/"><cite>HTML5</cite></a>. 6 August 2013. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a>
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd rel="dcterms:requires">S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a> 
</dd><dt id="bib-RTCWEB-CONSTRAINTS">[RTCWEB-CONSTRAINTS]</dt><dd rel="dcterms:requires">D. Burnett. <a href="http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/"><cite>IANA Registry for RTCWeb Media Constraints.</cite></a> URL: <a href="http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/">http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/</a> 
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd rel="dcterms:requires">Cameron McCormack. <a href="http://www.w3.org/TR/WebIDL/"><cite>Web IDL</cite></a>. 19 April 2012. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/WebIDL/">http://www.w3.org/TR/WebIDL/</a>
</dd><dt id="bib-WEBRTC10">[WEBRTC10]</dt><dd rel="dcterms:requires">Adam Bergkvist; Daniel Burnett; Cullen Jennings; Anant Narayanan. <a href="http://www.w3.org/TR/webrtc/"><cite>WebRTC 1.0: Real-time Communication Between Browsers</cite></a>. 10 September 2013. W3C Working Draft. URL: <a href="http://www.w3.org/TR/webrtc/">http://www.w3.org/TR/webrtc/</a>
</dd><dt id="bib-mediastream-imagecap">[mediastream-imagecap]</dt><dd rel="dcterms:requires">Giridhar Mandyam. <a href="http://www.w3.org/TR/image-capture/"><cite>MediaStream Image Capture</cite></a>. W3C Working Draft. URL: <a href="http://www.w3.org/TR/image-capture/">http://www.w3.org/TR/image-capture/</a>
</dd><dt id="bib-mediastream-rec">[mediastream-rec]</dt><dd rel="dcterms:requires">Jim Barnett; Travis Leithead. <a href="https://dvcs.w3.org/hg/dap/raw-file/tip/media-stream-capture/MediaRecorder.html"><cite>MediaStream Recording</cite></a>. W3C Working Draft. URL: <a href="https://dvcs.w3.org/hg/dap/raw-file/tip/media-stream-capture/MediaRecorder.html">https://dvcs.w3.org/hg/dap/raw-file/tip/media-stream-capture/MediaRecorder.html</a>
</dd></dl></section></section></body></html>